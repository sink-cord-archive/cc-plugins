(function(c,w,s,S,$,T,A,I){"use strict";function U(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var d=U(S),D=()=>cumcord.patcher.injectCSS(".ysink_palette_modal{position:absolute;top:5rem;left:0;width:100vw;display:flex;align-items:center;background:none!important;box-shadow:none!important}.ysink_palette_modal.ysink_palette_textentrymodal{min-height:0;height:4rem}.ysink_palette_palette{width:50rem;background-color:var(--background-secondary);color:#fff;padding:.75rem 0 0;border-radius:0;overflow:unset!important}.ysink_palette_item{padding:.3rem 1rem .3rem .5rem}.ysink_palette_icon{width:1.5rem;display:inline-block;text-align:center}.ysink_palette_iconseparator{border:solid 1px #ffffff55;margin:0 .5rem}.ysink_palette_item.ysink_palette_selected{background-color:#0005}.ysink_palette_input_wrapper{margin:0 .5rem 1rem;border:#ffffff33 solid 1px;display:flex;align-items:center;padding-left:.5rem}.ysink_palette_input{flex:1;margin-left:.5rem}.ysink_palette_input input{border:none!important;background:none!important;padding:0!important}.ysink_palette_source{text-transform:uppercase;font-style:italic;color:#aaa;float:right}.ysink_palette_scrollcontainer{overflow:hidden scroll;max-height:30rem;padding-bottom:.75rem}.ysink_palette_scrollcontainer::-webkit-scrollbar{width:1rem;background-color:#0003}.ysink_palette_scrollcontainer::-webkit-scrollbar-thumb{background-color:#fff3;min-height:40px}"),L=({entry:e,selected:t,id:n,icon:r})=>s.React.createElement("div",{className:t?"ysink_palette_item ysink_palette_selected":"ysink_palette_item",id:n},s.React.createElement("span",{className:"ysink_palette_icon"},r??""),s.React.createElement("span",{className:"ysink_palette_iconseparator"}),e.label,s.React.createElement("span",{className:"ysink_palette_source"},e.source));const P=(e,t)=>{let n=[];return t.forEach((r,a)=>{let o=e.findIndex(i=>i.id==a);a!=-1&&(n.push([e[o],r]),e.splice(o,1))}),n=n.sort((r,a)=>a[1]-r[1]).map(r=>r[0]),n.concat(e)};var j=(e,t,n)=>{if(!n||n=="")return P(e,t);let r=e.filter(a=>a.label.toLowerCase().includes(n.toLowerCase())||a.id.toLowerCase().includes(n.toLowerCase()));return P(r,t)};const K=s.React.useState,{openModal:F}=c.findByProps("openModal"),b=c.findByProps("ModalCloseButton"),G=c.findByDisplayName("TextInput"),O=({e,prompt:t,nest:n,defaultEntries:r,closeAction:a})=>{let[o,i]=K({selected:0,search:""});const h=j(n?r.concat(n.ghost.customEntries):r,n?n.ghost.usageCounts:new Map,o.search),se=l=>{let u=o.selected;i({selected:u,search:l})},_=l=>{let u=o.search;i({selected:l,search:u})},ie=l=>{switch(l.which){case 38:o.selected>0?_(o.selected-1):_(h.length-1);break;case 40:o.selected<h.length-1?_(o.selected+1):_(0);break;case 13:e.onClose();let u=h[o.selected];if(n){let E=n.ghost.usageCounts,le=E.get(u.id)??0;E.set(u.id,le+1),n.store.usageCounts=E}u.action();break;default:document.getElementsByClassName("ysink_palette_input")[0].children[0].focus();break}document.getElementById(`palette_item_${o.selected}`).scrollIntoView(!1)};return s.React.createElement(w.ErrorBoundary,null,s.React.createElement(b.ModalRoot,{transitionState:e.transitionState,size:"small",className:"ysink_palette_modal",onKeyDown:ie,onBlur:()=>{a&&a()}},s.React.createElement(b.ModalContent,{className:"ysink_palette_palette"},s.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",s.React.createElement(G,{className:"ysink_palette_input",placeholder:t??"Search Actions",type:"text",value:o.search,onChange:l=>se(l)})),s.React.createElement("div",{className:"ysink_palette_scrollcontainer"},h.filter(l=>!l.condition||l.condition()).map((l,u)=>s.React.createElement(L,{entry:l,id:`palette_item_${u}`,selected:u==o.selected,icon:l.icon}))))))};let p=(e,t,n,r)=>F(a=>s.React.createElement(O,{e:a,prompt:e,nest:t,defaultEntries:n,closeAction:r})),z=(e,t)=>new Promise((n,r)=>{p(e,null,t.map(a=>({label:a,action:()=>n(a)})),()=>r("user closed palette"))});var H=(e,t)=>{let n=r=>{(r.ctrlKey||r.metaKey)&&r.shiftKey&&r.which==80&&p(null,e,t)};return document.addEventListener("keyup",n),()=>{document.removeEventListener("keyup",n)}};const{getGuildPermissions:W}=c.findByProps("getGuildPermissions"),{getLastSelectedGuildId:m}=c.findByProps("getLastSelectedGuildId"),C=(e,t)=>{let n=W({id:e});return!!(n&&(n&t)!=0)},J=()=>C(m(),BigInt(4)),V=()=>C(m(),BigInt(2)),q=s.React.useState,{openModal:Q}=c.findByProps("openModal"),R=c.findByProps("ModalCloseButton"),X=c.findByDisplayName("TextInput"),Y=({e,prompt:t,finishAction:n,closeAction:r})=>{let[a,o]=q("");return s.React.createElement(w.ErrorBoundary,null,s.React.createElement(R.ModalRoot,{transitionState:e.transitionState,size:"small",className:"ysink_palette_modal ysink_palette_textentrymodal",onKeyDown:i=>{i.which==13&&(e.onClose(),n(a))}},s.React.createElement(R.ModalContent,{className:"ysink_palette_palette"},s.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",s.React.createElement(X,{className:"ysink_palette_input",placeholder:t,type:"text",value:a,onChange:i=>o(i),onBlur:()=>r()})))))},f=(e,t,n)=>Q(r=>s.React.createElement(Y,{e:r,prompt:e,finishAction:t,closeAction:n})),x=e=>new Promise((t,n)=>{f(e,t,()=>n("user closed textentry"))}),{getMembers:v}=c.findByProps("getMembers"),{getUser:B}=c.findByProps("getUser"),{banUser:Z,kickUser:ee}=c.findByProps("banUser"),M="Built In",N="\u{1F6E0}";var te=[{source:M,icon:N,id:"moderation_banuser",label:"Ban user from current guild",condition:J,action:()=>{p("Which user to ban?",null,v(m()).map(e=>{let t=B(e.userId),n=e.nick?`[${e.nick}]`:"";return{id:e.userId,label:`${t.username}#${t.discriminator} ${n} (${e.userId})`,action:()=>f("Enter ban reason",r=>{Z(m(),e.userId,null,r)})}}))}},{source:M,icon:N,id:"moderation_kickuser",label:"Kick user from current guild",condition:V,action:()=>{p("Which user to kick?",null,v(m()).map(e=>{let t=B(e.userId),n=e.nick?`[${e.nick}]`:"";return{id:e.userId,label:`${t.username}#${t.discriminator} ${n} (${e.userId})`,action:()=>f("Enter kick reason",r=>{ee(m(),e.userId,r)})}}))}}];const g="Built In",y="\u{1F4A7}";var ne=[{source:g,icon:y,id:"cumcord_installplug",label:"Install plugin from URL",action:async()=>{try{let e=await x("Enter URL");await d.default.importPlugin(e),$.showToast({title:"Installed plugin",duration:3e3})}catch{}}},{source:g,icon:y,id:"cumcord_removeplug",label:"Remove plugin",action:()=>{let e=Object.keys(d.default.installed.ghost).map(t=>[t,d.default.installed.ghost[t]]);p("Choose plugin to remove",null,e.map(t=>({id:t[0],label:t[1].manifest.name,action:()=>d.default.removePlugin(t[0])})))}},{source:g,icon:y,id:"cumcord_toggleplug",label:"Toggle plugin",action:()=>{let e=Object.keys(d.default.installed.ghost).map(t=>[t,d.default.installed.ghost[t]]);p("Choose plugin to toggle",null,e.map(t=>({id:t[0],label:(t[1].enabled?"\u{1F7E2} ":"\u{1F534} ")+t[1].manifest.name,action:()=>d.default.togglePlugin(t[0])})))}},{source:g,icon:y,id:"cumcord_uninject",label:"Uninject Cumcord",action:()=>setTimeout(async()=>{await T.showConfirmationModal({header:"Really uninject Cumcord?",content:"This will disable all of your plugins, and Cumcord will be completely removed",type:"danger",confirmText:"Uninject",cancelText:"Actually, never mind"})&&A.uninject()},500)}];const re="Built In",k=te.concat(ne);var ae=e=>(window.commandPalette={openPalette:(t,n)=>{p(t,null,n)},openPaletteAsync:z,openTextEntry:(t,n)=>f(t,n),openTextEntryAsync:t=>x(t),registerEntry(t,n,r,a){if(!t||t=="")throw"Register failed: Please supply an ID (string) for your entry";if(!n||n=="")throw"Register failed: Please identify a source (string) for your entry";if(!r||r=="")throw"Register failed: Please supply a label (string) for your entry";if(!a)throw"Register failed: Please supply an action (JS function) for your entry";if(n==re)throw"Register failed: That source is reserved for built in entries";if(k.find(i=>i.id==t)!=null)throw"Register failed: Entry ID taken by a built in entry";let o=e.ghost.customEntries.findIndex(i=>i.id==t);if(o!=-1)throw`Register failed: Entry ID taken by entry from source ${e.ghost.customEntries[o].source}`;e.ghost.customEntries.push({id:t,source:n,label:r,action:a})},unregisterEntry(t,n){if(!t||t=="")throw"Unregister failed: Please supply an ID (string) to deregister";if(!n||n=="")throw"Unregister failed: Please identify your source (string)";let r=e.ghost.customEntries,a=r.findIndex(i=>i.id==t);if(a==-1)throw"Unregister failed: No entry with that ID could be found";if(r[a].source!=n)throw"Unregister failed: An entry with that ID was found, but was not from your source";let o=r[a];return r.splice(a,1),e.store.customEntries=r,o},unregisterSource(t){let n=e.ghost.customEntries,r=n.filter(a=>a.source!=t);if(r.length==n.length)throw"Bulk unregister failed: No entries with that source were found";e.store.customEntries=r},getBuiltInEntries:()=>k,getAllCustomEntries:()=>e.ghost.customEntries,getCustomEntriesBySouce:t=>e.ghost.customEntries.filter(n=>n.source==t),getCustomEntryById:t=>e.ghost.customEntries.find(n=>n.id==t)},I.log("|| COMMAND PALETTE || Initialised window.commandPalette API"),()=>{window.commandPalette=void 0,delete window.commandPalette,I.log("|| COMMAND PALETTE || Disposed window.commandPalette API")}),oe=({persist:e,id:t})=>{Array.isArray(e.ghost.customEntries)||(e.store.customEntries=[]),e.ghost.usageCounts||(e.store.usageCounts=new Map);let n=[];return{onLoad:()=>n.push(D(),H(e,k),ae(e)),onUnload:()=>n.forEach(r=>r())}};return oe})(cumcord.modules.webpack,cumcord.ui.components,cumcord.modules.common,cumcord.plugins,cumcord.ui.toasts,cumcord.ui.modals,cumcord,cumcord.utils.logger);
