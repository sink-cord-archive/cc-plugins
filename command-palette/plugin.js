(function(c,E,i,D,T,U,A,b){"use strict";function L(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var u=L(D),j=()=>cumcord.patcher.injectCSS(".ysink_palette_modal{position:absolute;top:5rem;left:0;width:100vw;display:flex;align-items:center;background:none!important;box-shadow:none!important}.ysink_palette_modal.ysink_palette_textentrymodal{min-height:0;height:4rem}.ysink_palette_palette{width:50rem;background-color:var(--background-secondary);color:#fff;padding:.75rem 0 0;border-radius:0;overflow:unset!important}.ysink_palette_item{padding:.3rem 1rem .3rem .5rem}.ysink_palette_icon{width:1.5rem;display:inline-block;text-align:center}.ysink_palette_iconseparator{border:solid 1px #ffffff55;margin:0 .5rem}.ysink_palette_item.ysink_palette_selected{background-color:#0005}.ysink_palette_input_wrapper{margin:0 .5rem 1rem;border:#ffffff33 solid 1px;display:flex;align-items:center;padding-left:.5rem}.ysink_palette_input{flex:1;margin-left:.5rem}.ysink_palette_input input{border:none!important;background:none!important;padding:0!important}.ysink_palette_source{text-transform:uppercase;font-style:italic;color:#aaa;float:right}.ysink_palette_scrollcontainer{overflow:hidden scroll;max-height:30rem;padding-bottom:.75rem}.ysink_palette_scrollcontainer::-webkit-scrollbar{width:1rem;background-color:#0003}.ysink_palette_scrollcontainer::-webkit-scrollbar-thumb{background-color:#fff3;min-height:40px}"),K=({entry:e,selected:t,id:n,icon:o})=>i.React.createElement("div",{className:t?"ysink_palette_item ysink_palette_selected":"ysink_palette_item",id:n},i.React.createElement("span",{className:"ysink_palette_icon"},o??""),i.React.createElement("span",{className:"ysink_palette_iconseparator"}),e.label,i.React.createElement("span",{className:"ysink_palette_source"},e.source));const I=(e,t)=>{let n=[];return t.forEach((o,a)=>{let r=e.findIndex(s=>s.id==a);a!=-1&&(n.push([e[r],o]),e.splice(r,1))}),n=n.sort((o,a)=>a[1]-o[1]).map(o=>o[0]),n.concat(e)};var F=(e,t,n)=>{if(!n||n=="")return I(e,t);let o=e.filter(a=>a.label.toLowerCase().includes(n.toLowerCase())||a.id.toLowerCase().includes(n.toLowerCase()));return I(o,t)};const G=i.React.useState,{openModal:O}=c.findByProps("openModal"),P=c.findByProps("ModalCloseButton"),z=c.findByDisplayName("TextInput"),H=({e,prompt:t,nest:n,defaultEntries:o,closeAction:a})=>{let[r,s]=G({selected:0,search:""});const h=F(n?o.concat(n.ghost.customEntries):o,n?n.ghost.usageCounts:new Map,r.search),ce=l=>{let d=r.selected;s({selected:d,search:l})},_=l=>{let d=r.search;s({selected:l,search:d})},de=l=>{switch(l.which){case 38:r.selected>0?_(r.selected-1):_(h.length-1);break;case 40:r.selected<h.length-1?_(r.selected+1):_(0);break;case 13:e.onClose();let d=h[r.selected];if(n){let w=n.ghost.usageCounts,ue=w.get(d.id)??0;w.set(d.id,ue+1),n.store.usageCounts=w}d.action();break;default:document.getElementsByClassName("ysink_palette_input")[0].children[0].focus();break}document.getElementById(`palette_item_${r.selected}`).scrollIntoView(!1)};return i.React.createElement(E.ErrorBoundary,null,i.React.createElement(P.ModalRoot,{transitionState:e.transitionState,size:"small",className:"ysink_palette_modal",onKeyDown:de,onBlur:()=>{a&&a()}},i.React.createElement(P.ModalContent,{className:"ysink_palette_palette"},i.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",i.React.createElement(z,{className:"ysink_palette_input",placeholder:t??"Search Actions",type:"text",value:r.search,onChange:l=>ce(l)})),i.React.createElement("div",{className:"ysink_palette_scrollcontainer"},h.filter(l=>!l.condition||l.condition()).map((l,d)=>i.React.createElement(K,{entry:l,id:`palette_item_${d}`,selected:d==r.selected,icon:l.icon}))))))};let p=(e,t,n,o)=>O(a=>i.React.createElement(H,{e:a,prompt:e,nest:t,defaultEntries:n,closeAction:o})),W=(e,t)=>new Promise((n,o)=>{p(e,null,t.map(a=>({label:a,action:()=>n(a)})),()=>o("user closed palette"))});var J=(e,t)=>{let n=o=>{(o.ctrlKey||o.metaKey)&&o.shiftKey&&o.which==80&&p(null,e,t)};return document.addEventListener("keyup",n),()=>{document.removeEventListener("keyup",n)}};const{getGuildPermissions:V}=c.findByProps("getGuildPermissions"),{getLastSelectedGuildId:m}=c.findByProps("getLastSelectedGuildId"),R=(e,t)=>{let n=V({id:e});return!!(n&&(n&t)!=0)},q=()=>R(m(),BigInt(4)),Q=()=>R(m(),BigInt(2)),X=i.React.useState,{openModal:Y}=c.findByProps("openModal"),v=c.findByProps("ModalCloseButton"),Z=c.findByDisplayName("TextInput"),ee=({e,prompt:t,finishAction:n,closeAction:o})=>{let[a,r]=X("");return i.React.createElement(E.ErrorBoundary,null,i.React.createElement(v.ModalRoot,{transitionState:e.transitionState,size:"small",className:"ysink_palette_modal ysink_palette_textentrymodal",onKeyDown:s=>{s.which==13&&(e.onClose(),n(a))}},i.React.createElement(v.ModalContent,{className:"ysink_palette_palette"},i.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",i.React.createElement(Z,{className:"ysink_palette_input",placeholder:t,type:"text",value:a,onChange:s=>r(s),onBlur:()=>o()})))))},f=(e,t,n)=>Y(o=>i.React.createElement(ee,{e:o,prompt:e,finishAction:t,closeAction:n})),C=e=>new Promise((t,n)=>{f(e,t,()=>n("user closed textentry"))}),{getMembers:x}=c.findByProps("getMembers"),{getUser:B}=c.findByProps("getUser"),{banUser:te,kickUser:ne}=c.findByProps("banUser"),M="Built In",N="\u{1F6E0}";var oe=[{source:M,icon:N,id:"moderation_banuser",label:"Ban user from current guild",condition:q,action:()=>{p("Which user to ban?",null,x(m()).map(e=>{let t=B(e.userId),n=e.nick?`[${e.nick}]`:"";return{id:e.userId,label:`${t.username}#${t.discriminator} ${n} (${e.userId})`,action:()=>f("Enter ban reason",o=>{te(m(),e.userId,null,o)})}}))}},{source:M,icon:N,id:"moderation_kickuser",label:"Kick user from current guild",condition:Q,action:()=>{p("Which user to kick?",null,x(m()).map(e=>{let t=B(e.userId),n=e.nick?`[${e.nick}]`:"";return{id:e.userId,label:`${t.username}#${t.discriminator} ${n} (${e.userId})`,action:()=>f("Enter kick reason",o=>{ne(m(),e.userId,o)})}}))}}];const g="Built In",y="\u{1F4A7}";var ae=[{source:g,icon:y,id:"cumcord_installplug",label:"Install plugin from URL",action:async()=>{try{let e=await C("Enter URL");await u.default.importPlugin(e),T.showToast({title:"Installed plugin",duration:3e3})}catch{}}},{source:g,icon:y,id:"cumcord_removeplug",label:"Remove plugin",action:()=>{let e=Object.keys(u.default.installed.ghost).map(t=>[t,u.default.installed.ghost[t]]);p("Choose plugin to remove",null,e.map(t=>({id:t[0],label:t[1].manifest.name,action:()=>u.default.removePlugin(t[0])})))}},{source:g,icon:y,id:"cumcord_toggleplug",label:"Toggle plugin",action:()=>{let e=Object.keys(u.default.installed.ghost).map(t=>[t,u.default.installed.ghost[t]]);p("Choose plugin to toggle",null,e.map(t=>({id:t[0],label:(t[1].enabled?"\u{1F7E2} ":"\u{1F534} ")+t[1].manifest.name,action:()=>u.default.togglePlugin(t[0])})))}},{source:g,icon:y,id:"cumcord_uninject",label:"Uninject Cumcord",action:()=>setTimeout(async()=>{await U.showConfirmationModal({header:"Really uninject Cumcord?",content:"This will disable all of your plugins, and Cumcord will be completely removed",type:"danger",confirmText:"Uninject",cancelText:"Actually, never mind"})&&A.uninject()},500)}];const $="Built In",S="\u267B";var re=[{source:$,icon:S,id:"reboot_reload",label:"Reload Discord",action:()=>window.location.reload()},{source:$,icon:S,id:"reboot_relaunch",label:"Relaunch Discord to updater",condition:()=>window.DiscordNative,action:()=>window.DiscordNative.app.relaunch()}];const ie="Built In",k=oe.concat(ae).concat(re);var se=e=>(window.commandPalette={openPalette:(t,n)=>{p(t,null,n)},openPaletteAsync:W,openTextEntry:(t,n)=>f(t,n),openTextEntryAsync:t=>C(t),registerEntry(t,n,o,a){if(!t||t=="")throw"Register failed: Please supply an ID (string) for your entry";if(!n||n=="")throw"Register failed: Please identify a source (string) for your entry";if(!o||o=="")throw"Register failed: Please supply a label (string) for your entry";if(!a)throw"Register failed: Please supply an action (JS function) for your entry";if(n==ie)throw"Register failed: That source is reserved for built in entries";if(k.find(s=>s.id==t)!=null)throw"Register failed: Entry ID taken by a built in entry";let r=e.ghost.customEntries.findIndex(s=>s.id==t);if(r!=-1)throw`Register failed: Entry ID taken by entry from source ${e.ghost.customEntries[r].source}`;e.ghost.customEntries.push({id:t,source:n,label:o,action:a})},unregisterEntry(t,n){if(!t||t=="")throw"Unregister failed: Please supply an ID (string) to deregister";if(!n||n=="")throw"Unregister failed: Please identify your source (string)";let o=e.ghost.customEntries,a=o.findIndex(s=>s.id==t);if(a==-1)throw"Unregister failed: No entry with that ID could be found";if(o[a].source!=n)throw"Unregister failed: An entry with that ID was found, but was not from your source";let r=o[a];return o.splice(a,1),e.store.customEntries=o,r},unregisterSource(t){let n=e.ghost.customEntries,o=n.filter(a=>a.source!=t);if(o.length==n.length)throw"Bulk unregister failed: No entries with that source were found";e.store.customEntries=o},getBuiltInEntries:()=>k,getAllCustomEntries:()=>e.ghost.customEntries,getCustomEntriesBySouce:t=>e.ghost.customEntries.filter(n=>n.source==t),getCustomEntryById:t=>e.ghost.customEntries.find(n=>n.id==t)},b.log("|| COMMAND PALETTE || Initialised window.commandPalette API"),()=>{window.commandPalette=void 0,delete window.commandPalette,b.log("|| COMMAND PALETTE || Disposed window.commandPalette API")}),le=({persist:e,id:t})=>{e.store.customEntries=[],e.ghost.usageCounts||(e.store.usageCounts=new Map);let n=[j(),J(e,k),se(e)];return{onUnload:()=>{e.store.customEntries=[],n.forEach(o=>o())}}};return le})(cumcord.modules.webpack,cumcord.ui.components,cumcord.modules.common,cumcord.plugins,cumcord.ui.toasts,cumcord.ui.modals,cumcord,cumcord.utils.logger);
