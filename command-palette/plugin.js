(function(c,_,i){"use strict";var x=()=>cumcord.patcher.injectCSS(".ysink_palette_modal{position:absolute;top:5rem;left:0;width:100vw;display:flex;align-items:center;background:none!important;box-shadow:none!important}.ysink_palette_modal.ysink_palette_textentrymodal{min-height:0;height:4rem}.ysink_palette_palette{width:50rem;background-color:var(--background-secondary);color:#fff;padding:.75rem 0;border-radius:0;overflow:unset!important}.ysink_palette_item{padding:.3rem 1rem}.ysink_palette_item.ysink_palette_selected{background-color:#0005}.ysink_palette_input_wrapper{margin:0 .5rem 1rem;border:#ffffff33 solid 1px;display:flex;align-items:center;padding-left:.5rem}.ysink_palette_input{flex:1;margin-left:.5rem}.ysink_palette_input input{border:none!important;background:none!important;padding:0!important}.ysink_palette_source{text-transform:uppercase;font-style:italic;color:#aaa;float:right}.ysink_palette_scrollcontainer{overflow:hidden scroll;max-height:30rem}"),C=({entry:t,selected:n,id:e})=>i.React.createElement("div",{className:n?"ysink_palette_item ysink_palette_selected":"ysink_palette_item",id:e},t.label,i.React.createElement("span",{className:"ysink_palette_source"},t.source));const E=(t,n)=>{let e=[];return n.forEach((r,s)=>{let a=t.findIndex(o=>o.id==s);s!=-1&&(e.push([t[a],r]),t.splice(a,1))}),e=e.sort((r,s)=>s[1]-r[1]).map(r=>r[0]),e.concat(t)};var v=(t,n,e)=>{if(!e||e=="")return E(t,n);let r=t.filter(s=>s.label.toLowerCase().includes(e.toLowerCase()));return E(r,n)};const M=i.React.useState,{openModal:N}=c.findByProps("openModal"),k=c.findByProps("ModalCloseButton"),S=c.findByDisplayName("TextInput"),$=({e:t,prompt:n,nest:e,defaultEntries:r,closeAction:s})=>{let[a,o]=M({selected:0,search:""});const f=v(e?r.concat(e.ghost.customEntries):r,e?e.ghost.usageCounts:new Map,a.search),F=l=>{let d=a.selected;o({selected:d,search:l})},g=l=>{let d=a.search;o({selected:l,search:d})},Q=l=>{switch(l.which){case 38:a.selected>0?g(a.selected-1):g(f.length-1);break;case 40:a.selected<f.length-1?g(a.selected+1):g(0);break;case 13:t.onClose();let d=f[a.selected];if(e){let h=e.ghost.usageCounts,X=h.get(d.id)??0;h.set(d.id,X+1),e.store.usageCounts=h}d.action();break;default:document.getElementsByClassName("ysink_palette_input")[0].children[0].focus();break}document.getElementById(`palette_item_${a.selected}`).scrollIntoView(!1)};return i.React.createElement(_.ErrorBoundary,null,i.React.createElement(k.ModalRoot,{transitionState:t.transitionState,size:"small",className:"ysink_palette_modal",onKeyDown:Q,onBlur:()=>{s&&s()}},i.React.createElement(k.ModalContent,{className:"ysink_palette_palette"},i.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",i.React.createElement(S,{className:"ysink_palette_input",placeholder:n??"Search Actions",type:"text",value:a.search,onChange:l=>F(l)})),i.React.createElement("div",{className:"ysink_palette_scrollcontainer"},f.filter(l=>!l.condition||l.condition()).map((l,d)=>i.React.createElement(C,{entry:l,id:`palette_item_${d}`,selected:d==a.selected}))))))};let p=(t,n,e,r)=>N(s=>i.React.createElement($,{e:s,prompt:t,nest:n,defaultEntries:e,closeAction:r})),b=(t,n)=>new Promise((e,r)=>{p(t,null,n.map(s=>({label:s,action:()=>e(s)})),()=>r("user closed palette"))});var A=(t,n)=>{let e=r=>{(r.ctrlKey||r.metaKey)&&r.shiftKey&&r.which==80&&p(null,t,n)};return document.addEventListener("keyup",e),()=>{document.removeEventListener("keyup",e)}};const{getGuildPermissions:D}=c.findByProps("getGuildPermissions"),{getLastSelectedGuildId:u}=c.findByProps("getLastSelectedGuildId"),w=(t,n)=>{let e=D({id:t});return!!(e&&(e&n)!=0)},T=()=>w(u(),BigInt(4)),U=()=>w(u(),BigInt(2)),L=i.React.useState,{openModal:K}=c.findByProps("openModal"),I=c.findByProps("ModalCloseButton"),O=c.findByDisplayName("TextInput"),G=({e:t,prompt:n,finishAction:e,closeAction:r})=>{let[s,a]=L("");return i.React.createElement(_.ErrorBoundary,null,i.React.createElement(I.ModalRoot,{transitionState:t.transitionState,size:"small",className:"ysink_palette_modal ysink_palette_textentrymodal",onKeyDown:o=>{o.which==13&&(t.onClose(),e(s))}},i.React.createElement(I.ModalContent,{className:"ysink_palette_palette"},i.React.createElement("div",{className:"ysink_palette_input_wrapper"},">",i.React.createElement(O,{className:"ysink_palette_input",placeholder:n,type:"text",value:s,onChange:o=>a(o),onBlur:()=>r()})))))},y=(t,n,e)=>K(r=>i.React.createElement(G,{e:r,prompt:t,finishAction:n,closeAction:e})),j=t=>new Promise((n,e)=>{y(t,n,()=>e("user closed textentry"))}),{getMembers:P}=c.findByProps("getMembers"),{getUser:R}=c.findByProps("getUser"),{banUser:z,kickUser:H}=c.findByProps("banUser"),B="Built In";var W=[{source:B,id:"moderation_banuser",label:"[MODERATION] Ban user from current guild",condition:T,action:()=>{p("Which user to ban?",null,P(u()).map(t=>{let n=R(t.userId),e=t.nick?`[${t.nick}]`:"";return{id:t.userId,label:`${n.username}#${n.discriminator} ${e} (${t.userId})`,action:()=>y("Enter ban reason",r=>{z(u(),t.userId,null,r)})}}))}},{source:B,id:"moderation_kickuser",label:"[MODERATION] Kick user from current guild",condition:U,action:()=>{p("Which user to kick?",null,P(u()).map(t=>{let n=R(t.userId),e=t.nick?`[${t.nick}]`:"";return{id:t.userId,label:`${n.username}#${n.discriminator} ${e} (${t.userId})`,action:()=>y("Enter kick reason",r=>{H(u(),t.userId,r)})}}))}}];const J="Built In",m=W;var V=t=>(window.commandPalette={openPalette:(n,e)=>{p(n,null,e)},openPaletteAsync:b,openTextEntry:(n,e)=>y(n,e),openTextEntryAsync:n=>j(n),registerEntry(n,e,r,s){if(!n||n=="")throw"Register failed: Please supply an ID (string) for your entry";if(!e||e=="")throw"Register failed: Please identify a source (string) for your entry";if(!r||r=="")throw"Register failed: Please supply a label (string) for your entry";if(!s)throw"Register failed: Please supply an action (JS function) for your entry";if(e==J)throw"Register failed: That source is reserved for built in entries";if(m.find(o=>o.id==n)!=null)throw"Register failed: Entry ID taken by a built in entry";let a=t.ghost.customEntries.findIndex(o=>o.id==n);if(a!=-1)throw`Register failed: Entry ID taken by entry from source ${t.ghost.customEntries[a].source}`;t.ghost.customEntries.push({id:n,source:e,label:r,action:s})},unregisterEntry(n,e){if(!n||n=="")throw"Unregister failed: Please supply an ID (string) to deregister";if(!e||e=="")throw"Unregister failed: Please identify your source (string)";let r=t.ghost.customEntries,s=r.findIndex(o=>o.id==n);if(s==-1)throw"Unregister failed: No entry with that ID could be found";if(r[s].source!=e)throw"Unregister failed: An entry with that ID was found, but was not from your source";let a=r[s];return r.splice(s,1),t.store.customEntries=r,a},unregisterSource(n){let e=t.ghost.customEntries,r=e.filter(s=>s.source!=n);if(r.length==e.length)throw"Bulk unregister failed: No entries with that source were found";t.store.customEntries=r},getBuiltInEntries:()=>m,getAllCustomEntries:()=>t.ghost.customEntries,getCustomEntriesBySouce:n=>t.ghost.customEntries.filter(e=>e.source==n),getCustomEntryById:n=>t.ghost.customEntries.find(e=>e.id==n)},console.log("|| COMMAND PALETTE || Initialised window.commandPalette API"),()=>{window.commandPalette=void 0,delete window.commandPalette,console.log("|| COMMAND PALETTE || Disposed window.commandPalette API")}),q=({persist:t,id:n})=>{Array.isArray(t.ghost.customEntries)||(t.store.customEntries=[]),t.ghost.usageCounts||(t.store.usageCounts=new Map);let e=[];return{onLoad:()=>e.push(x(),A(t,m),V(t)),onUnload:()=>e.forEach(r=>r())}};return q})(cumcord.modules.webpack,cumcord.ui.components,cumcord.modules.common);
