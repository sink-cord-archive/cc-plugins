(function(Ae,d,je,dr,st,re,H,fr,Ne,$e,W,Le,it,at){"use strict";function mr(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function pr(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var o=pr(st),w=mr($e);const gr=/[^\S\r\n]*?\r?\n[^\S\r\n]*?\*[^\S\r\n]?/,vr=/^\\@/;function yr(e){try{return JSON.parse(e)}catch{}}function _r(e){const t=e.split(`
`)[0],r=t.substring(t.lastIndexOf("//META")+6,t.lastIndexOf("*//")),n=yr(r);if(!n)throw new Error("META could not be parsed.");if(!n.name)throw new Error("META missing name data.");return n}function Er(e){const t=e.split("/**",2)[1].split("*/",1)[0],r={};let n="",s="";for(const i of t.split(gr))if(i.length!==0)if(i.charAt(0)==="@"&&i.charAt(1)!==" "){n!==""&&(r[n]=s);const a=i.indexOf(" ");n=i.substr(1,a-1),s=i.substr(a+1)}else s+=` ${i.replace("\\n",`
`).replace(vr,"@")}`;return r[n]=s.trim(),r}var wr=e=>{const t=e.split(`
`)[0];if(t.includes("//META"))return _r(e);if(t.includes("/**"))return Er(e);throw new Error("META was not found.")};const ne={},J={};async function ze(e){return ne[e]||(J[e]||(J[e]=[fetch(e).then(async t=>{ne[e]=[t.status,t.status===200?await t.text():void 0]}),0]),J[e][1]++,await J[e][0],J[e][1]--,J[e][1]===0&&delete J[e]),ne[e]}async function ot(e){const[t,r]=await ze(e);return[t,r?JSON.parse(r):void 0]}const br=()=>Object.keys(ne).forEach(e=>delete ne[e]);async function Sr(e,t){const r=new URL(e,t).href,[n,s]=await ze(r);if(n!==200)throw new Error(`BD theme existed in cache with non-200 status ${n}`);return{url:r,CSS:()=>Promise.resolve(s),compat:!0,repoUrl:t,...wr(s)}}async function kr(e,t){const r=new URL(e,t).href;let n=new URL(e,t).pathname.split("/");n.splice(n.length-1,1,"cumcord_theme.json");const s=new URL(n.join("/"),new URL(e,t).origin).href,[i,a]=await ot(s);if(i!==200)throw new Error(`CC manifest existed in cache with non-200 status ${i}`);return{url:r,compat:!1,...a,repoUrl:t,CSS:async()=>{const[c,l]=await ze(r);if(c!==200)throw new Error(`CC CSS existed in cache with non-200 status ${c}`);return l}}}var se=async(e,t)=>{try{return await kr(e,t)}catch(r){try{return await Sr(e,t)}catch(n){console.error(r,n);let s=new Error("Failed to fetch theme - both CC and BD either failed to fetch or failed to parse");throw s.e1=r,s.e2=n,s}}};const ie=new Map;async function ue(e){if(!e?.url||!await e.CSS())throw new Error("theme was missing either id or css.");const t=je.injectCSS(await e.CSS());ie.set(e.url,t);const r=d.persist.ghost.themes.findIndex(s=>s.url===e.url);let n={...e};delete n.CSS,n.enabled=!0,r===-1?d.persist.ghost.themes.push(n):d.persist.ghost.themes[r]=n,d.persist.store.themes=d.persist.ghost.themes}function Pe(e){if(!e?.url)throw new Error("theme was missing id.");ie.get(e.url)?.(),ie.delete(e.url);const r=d.persist.ghost.themes.findIndex(s=>s.url===e.url);let n={...e};n.enabled=!1,r===-1?d.persist.ghost.themes.push(n):d.persist.ghost.themes[r]=n,d.persist.store.themes=d.persist.ghost.themes}function ct(e){try{Pe(e)}catch(t){if(t.message!=="theme was not loaded.")throw t}d.persist.store.themes=d.persist.ghost.themes.filter(t=>t.url!==e.url)}async function xr(e){ie.get(e.url)?.(await e.CSS());let r={...e};r.enabled=!0;const n=d.persist.ghost.themes.findIndex(s=>s.url===e.url);n!==-1&&(d.persist.ghost.themes[n]=r,d.persist.store.themes=d.persist.ghost.themes)}function Mr(){ie.forEach(e=>e?.()),ie.clear()}var Or=()=>{let e=!1;return d.persist.ghost.themes&&d.persist.ghost.themes.filter(t=>t.enabled).forEach(t=>se(t.url,t.repoUrl).then(r=>e||ue(r))),()=>{Mr(),e=!0}};const lt=(e,t)=>()=>o.createElement("img",{src:e,className:`ysink_stain_badge ysink_stain_${t}`}),Cr=lt("https://betterdiscord.app/resources/branding/logo_small.svg","bd"),Ir=lt("https://raw.githubusercontent.com/Cumcord/assets/main/logo/filled.svg","cc"),[ut,he,Fe,K,Rr,Tr,Ar,jr,ht,dt,ft,{thin:Nr},_e,{openModal:$r}]=fr.batchFind(({findByProps:e,findByDisplayName:t})=>{t("FormTitle"),t("FormText"),t("FormSection"),e("BorderColors"),t("Switch"),e("BadgeShapes"),t("Flex"),t("Select",!1),t("TextInput"),t("SmallMediaCarousel"),t("SearchBar"),e("scrollerBase","thin"),e("ModalCloseButton"),e("openModalLazy")});var Lr=({media:e})=>o.createElement("div",{class:"ysink_stain_carousel"},e?o.createElement(dt,{items:(typeof e=="string"?[e]:e).map(t=>({type:1,src:t})),autoplayInterval:5e3}):o.createElement("div",{className:"ysink_stain_noimg"},o.createElement(he,{className:"ysink_stain_noimgtxt"},"No Image"),o.createElement(dt,{items:[{type:1,src:""}]})));const zr=({e,media:t})=>o.createElement(H.ErrorBoundary,null,o.createElement(_e.ModalRoot,{transitionState:e.transitionState,size:"large"},o.createElement(_e.ModalHeader,{separator:!1},o.createElement("div",{style:{flex:1}}),o.createElement(_e.ModalCloseButton,{onClick:e.onClose})),o.createElement(_e.ModalContent,null,o.createElement("div",{style:{marginBottom:"1rem"}},o.createElement(Lr,{media:t})))));var Pr=e=>$r(t=>o.createElement(zr,{e:t,media:e})),Fr=e=>o.createElement("svg",{...e,xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},o.createElement("path",{d:"M 3.9999998,21.333333 C 3.9999998,22.8 5.1999998,24 6.6666665,24 H 17.333334 C 18.799999,24 20,22.8 20,21.333333 V 5.3333333 H 3.9999998 Z M 7.2799998,11.84 9.1599995,9.96 12,12.786667 14.826667,9.96 l 1.879999,1.88 -2.826667,2.826667 2.826667,2.826666 -1.879999,1.88 L 12,16.546667 l -2.8266665,2.826666 -1.8800003,-1.88 2.8266658,-2.826666 z M 16.666666,1.3333333 15.333334,0 H 8.6666665 L 7.3333332,1.3333333 H 2.6666665 V 4 H 21.333334 V 1.3333333 Z"})),Br=e=>o.createElement("svg",{...e,xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},o.createElement("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}));function mt(e){for(const t of d.persist.ghost.themes)if(t.url===e&&t.enabled)return!0;return!1}const Ur=e=>d.persist.ghost.themes.some(t=>t.url===e);var pt=({theme:e,deleteHook:t,gap:r})=>(re.useNest(d.persist,!1,(n,{path:s})=>s[0]==="themes"),o.createElement("div",{className:"ysink_stain_card ysink_stain_tcard",style:{marginBottom:r}},o.createElement("div",{className:"ysink_stain_tmedia",style:{backgroundImage:e.media&&`url(${Array.isArray(e.media)?e.media[0]:e.media})`},onClick:()=>e.media&&Pr(e.media)},e.media?o.createElement("div",{className:"ysink_stain_tview"},"VIEW MEDIA"):o.createElement("div",null,"NO MEDIA")),o.createElement("div",{className:"ysink_stain_title"},e.compat?o.createElement(Cr,null):o.createElement(Ir,null),e.name),o.createElement("div",{className:"ysink_stain_tdesc"},e.description),o.createElement("div",{className:"ysink_stain_tacts"},o.createElement(Br,{className:"ysink_stain_iconbtn",onClick:()=>re.copyText(e.url)}),Ur(e.url)?o.createElement(Fr,{className:"ysink_stain_iconbtn",onClick:()=>{ct(e),t?.()}}):[],o.createElement(Rr,{checked:mt(e.url),onChange:async()=>mt(e.url)?Pe(e):ue(await se(e.url))})),o.createElement("div",{className:"ysink_stain_taulic"},e.author?`by ${e.author} `:"",e.license?`under ${e.license}`:""))),Hr=()=>{re.useNest(d.persist);let[e,t]=o.useState("");return o.createElement(H.ErrorBoundary,null,o.createElement("div",{className:"ysink_stain_row"},o.createElement(ht,{className:"ysink_stain_input",placeholder:"Theme import URL",type:"text",value:e,onChange:r=>t(r)}),o.createElement(K,{className:"ysink_stain_button",onClick:()=>{se(e).then(async r=>{await ue(r),Ne.showToast({title:`Loaded theme ${r.name}`,duration:5e3}),t("")},()=>Ne.showToast({title:"Failed to fetch theme - check URL",duration:5e3}))}},"Install")))};function z(e){return Array.isArray?Array.isArray(e):yt(e)==="[object Array]"}const Wr=1/0;function Kr(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-Wr?"-0":t}function Vr(e){return e==null?"":Kr(e)}function A(e){return typeof e=="string"}function gt(e){return typeof e=="number"}function Yr(e){return e===!0||e===!1||qr(e)&&yt(e)=="[object Boolean]"}function vt(e){return typeof e=="object"}function qr(e){return vt(e)&&e!==null}function O(e){return e!=null}function Be(e){return!e.trim().length}function yt(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const mi="Extended search is not available",Gr="Incorrect 'index' type",Jr=e=>`Invalid value for key ${e}`,Qr=e=>`Pattern length exceeds max of ${e}.`,Xr=e=>`Missing ${e} property in key`,Zr=e=>`Property 'weight' in key '${e}' must be a positive integer`,_t=Object.prototype.hasOwnProperty;class Dr{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(n=>{let s=Et(n);r+=s.weight,this._keys.push(s),this._keyMap[s.id]=s,r+=s.weight}),this._keys.forEach(n=>{n.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Et(e){let t=null,r=null,n=null,s=1,i=null;if(A(e)||z(e))n=e,t=wt(e),r=Ue(e);else{if(!_t.call(e,"name"))throw new Error(Xr("name"));const a=e.name;if(n=a,_t.call(e,"weight")&&(s=e.weight,s<=0))throw new Error(Zr(a));t=wt(a),r=Ue(a),i=e.getFn}return{path:t,id:r,weight:s,src:n,getFn:i}}function wt(e){return z(e)?e:e.split(".")}function Ue(e){return z(e)?e.join("."):e}function en(e,t){let r=[],n=!1;const s=(i,a,c)=>{if(!!O(i))if(!a[c])r.push(i);else{let l=a[c];const u=i[l];if(!O(u))return;if(c===a.length-1&&(A(u)||gt(u)||Yr(u)))r.push(Vr(u));else if(z(u)){n=!0;for(let h=0,m=u.length;h<m;h+=1)s(u[h],a,c+1)}else a.length&&s(u,a,c+1)}};return s(e,A(t)?t.split("."):t,0),n?r:r[0]}var f={...{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},...{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},...{location:0,threshold:.6,distance:100},...{useExtendedSearch:!1,getFn:en,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}};const tn=/[^ ]+/g;function rn(e=1,t=3){const r=new Map,n=Math.pow(10,t);return{get(s){const i=s.match(tn).length;if(r.has(i))return r.get(i);const a=1/Math.pow(i,.5*e),c=parseFloat(Math.round(a*n)/n);return r.set(i,c),c},clear(){r.clear()}}}class He{constructor({getFn:t=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){this.norm=rn(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,n)=>{this._keysMap[r.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,A(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();A(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,n=this.size();r<n;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!O(t)||Be(t))return;let n={v:t,i:r,n:this.norm.get(t)};this.records.push(n)}_addObject(t,r){let n={i:r,$:{}};this.keys.forEach((s,i)=>{let a=s.getFn?s.getFn(t):this.getFn(t,s.path);if(!!O(a)){if(z(a)){let c=[];const l=[{nestedArrIndex:-1,value:a}];for(;l.length;){const{nestedArrIndex:u,value:h}=l.pop();if(!!O(h))if(A(h)&&!Be(h)){let m={v:h,i:u,n:this.norm.get(h)};c.push(m)}else z(h)&&h.forEach((m,p)=>{l.push({nestedArrIndex:p,value:m})})}n.$[i]=c}else if(A(a)&&!Be(a)){let c={v:a,n:this.norm.get(a)};n.$[i]=c}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function bt(e,t,{getFn:r=f.getFn,fieldNormWeight:n=f.fieldNormWeight}={}){const s=new He({getFn:r,fieldNormWeight:n});return s.setKeys(e.map(Et)),s.setSources(t),s.create(),s}function nn(e,{getFn:t=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){const{keys:n,records:s}=e,i=new He({getFn:t,fieldNormWeight:r});return i.setKeys(n),i.setIndexRecords(s),i}function Ee(e,{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:s=f.distance,ignoreLocation:i=f.ignoreLocation}={}){const a=t/e.length;if(i)return a;const c=Math.abs(n-r);return s?a+c/s:c?1:a}function sn(e=[],t=f.minMatchCharLength){let r=[],n=-1,s=-1,i=0;for(let a=e.length;i<a;i+=1){let c=e[i];c&&n===-1?n=i:!c&&n!==-1&&(s=i-1,s-n+1>=t&&r.push([n,s]),n=-1)}return e[i-1]&&i-n>=t&&r.push([n,i-1]),r}const Q=32;function an(e,t,r,{location:n=f.location,distance:s=f.distance,threshold:i=f.threshold,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,includeMatches:l=f.includeMatches,ignoreLocation:u=f.ignoreLocation}={}){if(t.length>Q)throw new Error(Qr(Q));const h=t.length,m=e.length,p=Math.max(0,Math.min(n,m));let g=i,v=p;const x=c>1||l,P=x?Array(m):[];let I;for(;(I=e.indexOf(t,v))>-1;){let k=Ee(t,{currentLocation:I,expectedLocation:p,distance:s,ignoreLocation:u});if(g=Math.min(k,g),v=I+h,x){let T=0;for(;T<h;)P[I+T]=1,T+=1}}v=-1;let F=[],j=1,D=h+m;const Oe=1<<h-1;for(let k=0;k<h;k+=1){let T=0,N=D;for(;T<N;)Ee(t,{errors:k,currentLocation:p+N,expectedLocation:p,distance:s,ignoreLocation:u})<=g?T=N:D=N,N=Math.floor((D-T)/2+T);D=N;let ee=Math.max(1,p-N+1),C=a?m:Math.min(p+N,m)+h,B=Array(C+2);B[C+1]=(1<<k)-1;for(let M=C;M>=ee;M-=1){let ce=M-1,Ce=r[e.charAt(ce)];if(x&&(P[ce]=+!!Ce),B[M]=(B[M+1]<<1|1)&Ce,k&&(B[M]|=(F[M+1]|F[M])<<1|1|F[M+1]),B[M]&Oe&&(j=Ee(t,{errors:k,currentLocation:ce,expectedLocation:p,distance:s,ignoreLocation:u}),j<=g)){if(g=j,v=ce,v<=p)break;ee=Math.max(1,2*p-v)}}if(Ee(t,{errors:k+1,currentLocation:p,expectedLocation:p,distance:s,ignoreLocation:u})>g)break;F=B}const oe={isMatch:v>=0,score:Math.max(.001,j)};if(x){const k=sn(P,c);k.length?l&&(oe.indices=k):oe.isMatch=!1}return oe}function on(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const s=e.charAt(r);t[s]=(t[s]||0)|1<<n-r-1}return t}class St{constructor(t,{location:r=f.location,threshold:n=f.threshold,distance:s=f.distance,includeMatches:i=f.includeMatches,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreLocation:u=f.ignoreLocation}={}){if(this.options={location:r,threshold:n,distance:s,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreLocation:u},this.pattern=l?t:t.toLowerCase(),this.chunks=[],!this.pattern.length)return;const h=(p,g)=>{this.chunks.push({pattern:p,alphabet:on(p),startIndex:g})},m=this.pattern.length;if(m>Q){let p=0;const g=m%Q,v=m-g;for(;p<v;)h(this.pattern.substr(p,Q),p),p+=Q;if(g){const x=m-Q;h(this.pattern.substr(x),x)}}else h(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,includeMatches:n}=this.options;if(r||(t=t.toLowerCase()),this.pattern===t){let v={isMatch:!0,score:0};return n&&(v.indices=[[0,t.length-1]]),v}const{location:s,distance:i,threshold:a,findAllMatches:c,minMatchCharLength:l,ignoreLocation:u}=this.options;let h=[],m=0,p=!1;this.chunks.forEach(({pattern:v,alphabet:x,startIndex:P})=>{const{isMatch:I,score:F,indices:j}=an(t,v,x,{location:s+P,distance:i,threshold:a,findAllMatches:c,minMatchCharLength:l,includeMatches:n,ignoreLocation:u});I&&(p=!0),m+=F,I&&j&&(h=[...h,...j])});let g={isMatch:p,score:p?m/this.chunks.length:1};return p&&n&&(g.indices=h),g}}class V{constructor(t){this.pattern=t}static isMultiMatch(t){return kt(t,this.multiRegex)}static isSingleMatch(t){return kt(t,this.singleRegex)}search(){}}function kt(e,t){const r=e.match(t);return r?r[1]:null}class cn extends V{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class ln extends V{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}}class un extends V{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class hn extends V{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class dn extends V{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class fn extends V{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class xt extends V{constructor(t,{location:r=f.location,threshold:n=f.threshold,distance:s=f.distance,includeMatches:i=f.includeMatches,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreLocation:u=f.ignoreLocation}={}){super(t),this._bitapSearch=new St(t,{location:r,threshold:n,distance:s,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Mt extends V{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,n;const s=[],i=this.pattern.length;for(;(n=t.indexOf(this.pattern,r))>-1;)r=n+i,s.push([n,r-1]);const a=!!s.length;return{isMatch:a,score:a?0:1,indices:s}}}const We=[cn,Mt,un,hn,fn,dn,ln,xt],Ot=We.length,mn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,pn="|";function gn(e,t={}){return e.split(pn).map(r=>{let n=r.trim().split(mn).filter(i=>i&&!!i.trim()),s=[];for(let i=0,a=n.length;i<a;i+=1){const c=n[i];let l=!1,u=-1;for(;!l&&++u<Ot;){const h=We[u];let m=h.isMultiMatch(c);m&&(s.push(new h(m,t)),l=!0)}if(!l)for(u=-1;++u<Ot;){const h=We[u];let m=h.isSingleMatch(c);if(m){s.push(new h(m,t));break}}}return s})}const vn=new Set([xt.type,Mt.type]);class yn{constructor(t,{isCaseSensitive:r=f.isCaseSensitive,includeMatches:n=f.includeMatches,minMatchCharLength:s=f.minMatchCharLength,ignoreLocation:i=f.ignoreLocation,findAllMatches:a=f.findAllMatches,location:c=f.location,threshold:l=f.threshold,distance:u=f.distance}={}){this.query=null,this.options={isCaseSensitive:r,includeMatches:n,minMatchCharLength:s,findAllMatches:a,ignoreLocation:i,location:c,threshold:l,distance:u},this.pattern=r?t:t.toLowerCase(),this.query=gn(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:s}=this.options;t=s?t:t.toLowerCase();let i=0,a=[],c=0;for(let l=0,u=r.length;l<u;l+=1){const h=r[l];a.length=0,i=0;for(let m=0,p=h.length;m<p;m+=1){const g=h[m],{isMatch:v,indices:x,score:P}=g.search(t);if(v){if(i+=1,c+=P,n){const I=g.constructor.type;vn.has(I)?a=[...a,...x]:a.push(x)}}else{c=0,i=0,a.length=0;break}}if(i){let m={isMatch:!0,score:c/i};return n&&(m.indices=a),m}}return{isMatch:!1,score:1}}}const Ke=[];function _n(...e){Ke.push(...e)}function Ve(e,t){for(let r=0,n=Ke.length;r<n;r+=1){let s=Ke[r];if(s.condition(e,t))return new s(e,t)}return new St(e,t)}const we={AND:"$and",OR:"$or"},Ye={PATH:"$path",PATTERN:"$val"},qe=e=>!!(e[we.AND]||e[we.OR]),En=e=>!!e[Ye.PATH],wn=e=>!z(e)&&vt(e)&&!qe(e),Ct=e=>({[we.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function It(e,t,{auto:r=!0}={}){const n=s=>{let i=Object.keys(s);const a=En(s);if(!a&&i.length>1&&!qe(s))return n(Ct(s));if(wn(s)){const l=a?s[Ye.PATH]:i[0],u=a?s[Ye.PATTERN]:s[l];if(!A(u))throw new Error(Jr(l));const h={keyId:Ue(l),pattern:u};return r&&(h.searcher=Ve(u,t)),h}let c={children:[],operator:i[0]};return i.forEach(l=>{const u=s[l];z(u)&&u.forEach(h=>{c.children.push(n(h))})}),c};return qe(e)||(e=Ct(e)),n(e)}function bn(e,{ignoreFieldNorm:t=f.ignoreFieldNorm}){e.forEach(r=>{let n=1;r.matches.forEach(({key:s,norm:i,score:a})=>{const c=s?s.weight:null;n*=Math.pow(a===0&&c?Number.EPSILON:a,(c||1)*(t?1:i))}),r.score=n})}function Sn(e,t){const r=e.matches;t.matches=[],O(r)&&r.forEach(n=>{if(!O(n.indices)||!n.indices.length)return;const{indices:s,value:i}=n;let a={indices:s,value:i};n.key&&(a.key=n.key.src),n.idx>-1&&(a.refIndex=n.idx),t.matches.push(a)})}function kn(e,t){t.score=e.score}function xn(e,t,{includeMatches:r=f.includeMatches,includeScore:n=f.includeScore}={}){const s=[];return r&&s.push(Sn),n&&s.push(kn),e.map(i=>{const{idx:a}=i,c={item:t[a],refIndex:a};return s.length&&s.forEach(l=>{l(i,c)}),c})}class ae{constructor(t,r={},n){this.options={...f,...r},this.options.useExtendedSearch,this._keyStore=new Dr(this.options.keys),this.setCollection(t,n)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof He))throw new Error(Gr);this._myIndex=r||bt(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){!O(t)||(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let n=0,s=this._docs.length;n<s;n+=1){const i=this._docs[n];t(i,n)&&(this.removeAt(n),n-=1,s-=1,r.push(i))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:n,includeScore:s,shouldSort:i,sortFn:a,ignoreFieldNorm:c}=this.options;let l=A(t)?A(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return bn(l,{ignoreFieldNorm:c}),i&&l.sort(a),gt(r)&&r>-1&&(l=l.slice(0,r)),xn(l,this._docs,{includeMatches:n,includeScore:s})}_searchStringList(t){const r=Ve(t,this.options),{records:n}=this._myIndex,s=[];return n.forEach(({v:i,i:a,n:c})=>{if(!O(i))return;const{isMatch:l,score:u,indices:h}=r.searchIn(i);l&&s.push({item:i,idx:a,matches:[{score:u,value:i,norm:c,indices:h}]})}),s}_searchLogical(t){const r=It(t,this.options),n=(c,l,u)=>{if(!c.children){const{keyId:m,searcher:p}=c,g=this._findMatches({key:this._keyStore.get(m),value:this._myIndex.getValueForItemAtKeyId(l,m),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const h=[];for(let m=0,p=c.children.length;m<p;m+=1){const g=c.children[m],v=n(g,l,u);if(v.length)h.push(...v);else if(c.operator===we.AND)return[]}return h},s=this._myIndex.records,i={},a=[];return s.forEach(({$:c,i:l})=>{if(O(c)){let u=n(r,c,l);u.length&&(i[l]||(i[l]={idx:l,item:c,matches:[]},a.push(i[l])),u.forEach(({matches:h})=>{i[l].matches.push(...h)}))}}),a}_searchObjectList(t){const r=Ve(t,this.options),{keys:n,records:s}=this._myIndex,i=[];return s.forEach(({$:a,i:c})=>{if(!O(a))return;let l=[];n.forEach((u,h)=>{l.push(...this._findMatches({key:u,value:a[h],searcher:r}))}),l.length&&i.push({idx:c,item:a,matches:l})}),i}_findMatches({key:t,value:r,searcher:n}){if(!O(r))return[];let s=[];if(z(r))r.forEach(({v:i,i:a,n:c})=>{if(!O(i))return;const{isMatch:l,score:u,indices:h}=n.searchIn(i);l&&s.push({score:u,key:t,value:i,idx:a,norm:c,indices:h})});else{const{v:i,n:a}=r,{isMatch:c,score:l,indices:u}=n.searchIn(i);c&&s.push({score:l,key:t,value:i,norm:a,indices:u})}return s}}ae.version="6.6.2",ae.createIndex=bt,ae.parseIndex=nn,ae.config=f,ae.parseQuery=It,_n(yn);const Mn={threshold:.5,useExtendedSearch:!0,keys:["name","author","description"]};var Rt=(e,t)=>!t||t==""?e:new ae(e,Mn).search(t).map(r=>r.item),Tt=({query:e,onChange:t})=>o.createElement(ft,{className:"ysink_stain_searchbar",query:e,onQueryChange:t,placeholder:"Search themes...",size:ft.Sizes.MEDIUM}),At=({filterMode:e,setFilterMode:t})=>o.createElement(jr.SingleSelect,{options:[{value:0,label:"Show All"},{value:1,label:"CC Only"},{value:2,label:"BD Only"}],value:e,onChange:t,isDisabled:!1,className:"ysink_stain_dropdown"});const jt=({title:e,subtitle:t,onClick:r,btnText:n})=>o.createElement(Fe,{className:"ysink_stain_nosplash"},o.createElement(ut,{tag:"h2"},e),o.createElement(he,null,t),o.createElement(K,{className:"ysink_stain_button",color:K.Colors.GREEN,sizes:K.Sizes.LARGE,onClick:r},n)),On=({goToRepos:e})=>o.createElement(jt,{title:"No Repos",subtitle:"Add one in the repo manager!",onClick:e,btnText:"Open repo manager"}),Cn=({goToStore:e})=>o.createElement(jt,{title:"No Themes",subtitle:"Paste a link in above, or head over to the store",onClick:e,btnText:"Get some themes"});var Nt=()=>{const[e,t]=st.useState(0);return()=>t(-e)},In=({goTo:e})=>{re.useNest(d.persist,!1,(a,{path:c})=>c[0]==="themes");const[t,r]=o.useState("");let[n,s]=o.useState(0);const i=Nt();return o.createElement(H.ErrorBoundary,null,o.createElement(Hr,null),o.createElement("div",{className:"ysink_stain_search_row"},o.createElement(Tt,{query:t,onChange:r}),o.createElement(At,{filterMode:n,setFilterMode:s})),d.persist.ghost.themes.length===0?o.createElement(Cn,{goToStore:()=>e(1)}):o.createElement("div",{className:"ysink_stain_cardcontainer"},Rt(d.persist.ghost.themes,t).filter(a=>n===0||n===1&&!a.compat||n===2&&a.compat).map(a=>o.createElement(pt,{key:a.url,theme:a,deleteHook:i}))))};function Rn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$t(Object(r),!0).forEach(function(n){Rn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$t(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tn(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function An(e,t){if(e==null)return{};var r=Tn(e,t),n,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function jn(e,t){return Nn(e)||$n(e,t)||Ln(e,t)||zn()}function Nn(e){if(Array.isArray(e))return e}function $n(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,i=void 0;try{for(var a=e[Symbol.iterator](),c;!(n=(c=a.next()).done)&&(r.push(c.value),!(t&&r.length===t));n=!0);}catch(l){s=!0,i=l}finally{try{!n&&a.return!=null&&a.return()}finally{if(s)throw i}}return r}}function Ln(e,t){if(!!e){if(typeof e=="string")return zt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zt(e,t)}}function zt(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function zn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Ft(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Pt(Object(r),!0).forEach(function(n){Pn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(s,i){return i(s)},n)}}function de(e){return function t(){for(var r=this,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.length>=e.length?e.apply(this,s):function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return t.apply(r,[].concat(s,c))}}}function be(e){return{}.toString.call(e).includes("Object")}function Bn(e){return!Object.keys(e).length}function fe(e){return typeof e=="function"}function Un(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Hn(e,t){return be(t)||Y("changeType"),Object.keys(t).some(function(r){return!Un(e,r)})&&Y("changeField"),t}function Wn(e){fe(e)||Y("selectorType")}function Kn(e){fe(e)||be(e)||Y("handlerType"),be(e)&&Object.values(e).some(function(t){return!fe(t)})&&Y("handlersType")}function Vn(e){e||Y("initialIsRequired"),be(e)||Y("initialType"),Bn(e)&&Y("initialContent")}function Yn(e,t){throw new Error(e[t]||e.default)}var qn={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},Y=de(Yn)(qn),Se={changes:Hn,selector:Wn,handler:Kn,initial:Vn};function Gn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Se.initial(e),Se.handler(t);var r={current:e},n=de(Xn)(r,t),s=de(Qn)(r),i=de(Se.changes)(e),a=de(Jn)(r);function c(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(h){return h};return Se.selector(u),u(r.current)}function l(u){Fn(n,s,i,a)(u)}return[c,l]}function Jn(e,t){return fe(t)?t(e.current):t}function Qn(e,t){return e.current=Ft(Ft({},e.current),t),t}function Xn(e,t,r){return fe(t)?t(e.current):Object.keys(r).forEach(function(n){var s;return(s=t[n])===null||s===void 0?void 0:s.call(t,e.current[n])}),r}var Zn={create:Gn},Dn={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function es(e){return function t(){for(var r=this,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.length>=e.length?e.apply(this,s):function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return t.apply(r,[].concat(s,c))}}}function ts(e){return{}.toString.call(e).includes("Object")}function rs(e){return e||Ut("configIsRequired"),ts(e)||Ut("configType"),e.urls?(ns(),{paths:{vs:e.urls.monacoBase}}):e}function ns(){console.warn(Bt.deprecation)}function ss(e,t){throw new Error(e[t]||e.default)}var Bt={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Ut=es(ss)(Bt),is={config:rs},as=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(s){return r.reduceRight(function(i,a){return a(i)},s)}};function Ht(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],Ht(e[r],t[r]))}),Lt(Lt({},e),t)}var os={type:"cancelation",msg:"operation is manually canceled"};function Ge(e){var t=!1,r=new Promise(function(n,s){e.then(function(i){return t?s(os):n(i)}),e.catch(s)});return r.cancel=function(){return t=!0},r}var cs=Zn.create({config:Dn,isInitialized:!1,resolve:null,reject:null,monaco:null}),Wt=jn(cs,2),me=Wt[0],ke=Wt[1];function ls(e){var t=is.config(e),r=t.monaco,n=An(t,["monaco"]);ke(function(s){return{config:Ht(s.config,n),monaco:r}})}function us(){var e=me(function(t){var r=t.monaco,n=t.isInitialized,s=t.resolve;return{monaco:r,isInitialized:n,resolve:s}});if(!e.isInitialized){if(ke({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Ge(Je);if(window.monaco&&window.monaco.editor)return Kt(window.monaco),e.resolve(window.monaco),Ge(Je);as(hs,fs)(ms)}return Ge(Je)}function hs(e){return document.body.appendChild(e)}function ds(e){var t=document.createElement("script");return e&&(t.src=e),t}function fs(e){var t=me(function(n){var s=n.config,i=n.reject;return{config:s,reject:i}}),r=ds("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function ms(){var e=me(function(r){var n=r.config,s=r.resolve,i=r.reject;return{config:n,resolve:s,reject:i}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){Kt(r),e.resolve(r)},function(r){e.reject(r)})}function Kt(e){me().monaco||ke({monaco:e})}function ps(){return me(function(e){var t=e.monaco;return t})}var Je=new Promise(function(e,t){return ke({resolve:e,reject:t})}),Vt={config:ls,init:us,__getMonacoInstance:ps};let pe,Qe;const Yt=new Set;async function qt(e){if(!e||!e.trim()||Yt.has(e))return;Yt.add(e);const t=`https://cdn.esm.sh/monaco-themes@0.4.2/themes/${e}.json`,r=await fetch(t).then(n=>n.json());pe.editor.defineTheme(e,r)}async function gs(e){pe||(e&&Vt.config({monaco:e}),Qe||(Qe=Vt.init().then(t=>{pe=t})),await Qe)}class vs extends $e.PureComponent{ref=$e.createRef();ed;elems;initState=0;async initMonaco(){await gs(this.props.noCDN),await qt(this.props.theme),this.initState=2,this.ed=pe.editor.create(this.ref.current,{language:this.props.lang,value:this.props.value,readOnly:this.props.readonly??!1,theme:this.props.theme,...this.props.otherCfg}),this.ed.onDidChangeModelContent(()=>this.props.valOut?.(this.ed.getValue()))}componentDidMount(){this.initState!==1&&this.initMonaco(),this.initState=1,this.elems&&this.initState!==2&&(this.ref.current.innerHTML="",this.ref.current.append(...this.elems))}componentWillUnmount(){this.initState!==2?this.elems=Array.from(this.ref.current.children):this.ed?.dispose()}componentDidUpdate(t){if(this.initState===2){if(this.props.readonly!==t.readonly&&this.ed.updateOptions({readOnly:this.props.readonly}),this.props.value!==this.ed.getValue()&&this.ed.setValue(this.props.value),this.props.theme!==t.theme&&qt(this.props.theme).then(()=>this.ed.updateOptions({theme:this.props.theme})),this.props.lang!==t.lang){const r=this.ed.getModel();r&&(pe.editor.setModelLanguage(r,this.props.lang),this.ed.setModel(r))}this.props.otherCfg!==t.otherCfg&&this.props.otherCfg&&this.ed.updateOptions(this.props.otherCfg)}}render(){return w.default.createElement("div",{ref:this.ref,style:{width:this.props.width??"30rem",height:this.props.height??"10rem"}})}}const ys=e=>d.persist.store.quickCSS=e,_s=_.debounce(ys,250);var Es=()=>{const[e,t]=o.useState(d.persist.ghost.quickCSS);return o.createElement(H.ErrorBoundary,null,o.createElement("div",{style:{maxWidth:"60vw"}},o.createElement(vs,{value:e??"",valOut:r=>{t(r),_s(r)},lang:"css",theme:"Dracula",width:"",height:"20rem",otherCfg:{automaticLayout:!0}})))};async function ws(e){const t=new URL("repo.json",e).href,[r,n]=await ot(t);if(r!==200)throw new Error(`Repo manifest existed in cache with non-200 status ${r}`);if(!n.themes||n.themes?.length===0)throw new Error("No themes found in repo");if(!n.meta)throw new Error("No repo metadata");if(!n?.meta.name)throw new Error("Repo did not have a name");return n}var xe=async e=>{const t=await ws(e),r=await Promise.all(t.themes.map(n=>se(n,e)));return{manifest:t,themes:r}};const Gt=["https://cumcordthemes.github.io/Cumsock/"],bs=Gt;var Ss=async()=>{Array.isArray(d.persist.ghost.repos)||(d.persist.ghost.repos=[]);for(const e of Gt)if(!d.persist.ghost.repos.find(t=>t.url===e.url)){try{await xe(e)}catch{continue}d.persist.ghost.repos.push(e)}d.persist.set({path:["repos"],value:d.persist.ghost.repos})},ks=({repo:e})=>{const[t,r]=o.useState(void 0);return o.useEffect(async()=>{t||r(await xe(e))}),o.createElement("div",{className:"ysink_stain_card ysink_stain_row"},o.createElement("div",null,o.createElement("div",{className:"ysink_stain_title"},t?.manifest.meta.name,bs.includes(e)?o.createElement(Tr.TextBadge,{className:"ysink_stain_officialbadge",text:"official repo",color:"var(--info-positive-foreground)"}):[]),o.createElement(he,null,e)),o.createElement(K,{color:K.Colors.RED,className:"ysink_stain_button",onClick:()=>d.persist.store.repos=d.persist.ghost.repos.filter(n=>n!=e)},"Remove Repo"))};async function xs(e){try{return await xe(e),!0}catch{return!1}}async function Jt(e,t,r){return e.endsWith("/")||(e+="/"),d.persist.ghost.repos.includes(e)?(r("You already have this repo!"),!1):await xs(e)?(d.persist.ghost.repos.push(e),d.persist.set({path:["repos"]}),t("Added repo"),!0):(r("Repo was invalid"),!1)}const Ms=e=>d.persist.ghost.themes.some(t=>t.url===e);async function Os(e,t,r){if(Ms(e))return r("Theme is already installed!");const n=await se(e).catch(r);!n||ue(n).then(t,r)}const Qt=e=>Ne.showToast({title:e,duration:5e3});var Cs=()=>{const[e,t]=o.useState("");return re.useNest(d.persist),o.createElement(H.ErrorBoundary,null,o.createElement(Fe,null,o.createElement(Ar,{basis:"auto",grow:1,shrink:1,className:"ysink_stain_row"},o.createElement(ht,{placeholder:"https://example.com/repo",type:"text",value:e,onChange:r=>t(r)}),o.createElement(K,{className:"ysink_stain_button",onClick:async()=>{await Jt(e,Qt,Qt)&&t("")}},"Add")),o.createElement("div",{className:"ysink_stain_divide"}),o.createElement("div",{className:"ysink_stain_cardcontainer"},d.persist.ghost.repos.map(r=>o.createElement(ks,{repo:r})))))};function X(){return X=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},X.apply(this,arguments)}function Is(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}var Rs=["bottom","height","left","right","top","width"],Ts=function(t,r){return t===void 0&&(t={}),r===void 0&&(r={}),Rs.some(function(n){return t[n]!==r[n]})},q=new Map,Xt,As=function e(){var t=[];q.forEach(function(r,n){var s=n.getBoundingClientRect();Ts(s,r.rect)&&(r.rect=s,t.push(r))}),t.forEach(function(r){r.callbacks.forEach(function(n){return n(r.rect)})}),Xt=window.requestAnimationFrame(e)};function js(e,t){return{observe:function(){var n=q.size===0;q.has(e)?q.get(e).callbacks.push(t):q.set(e,{rect:void 0,hasRectChanged:!1,callbacks:[t]}),n&&As()},unobserve:function(){var n=q.get(e);if(n){var s=n.callbacks.indexOf(t);s>=0&&n.callbacks.splice(s,1),n.callbacks.length||q.delete(e),q.size||cancelAnimationFrame(Xt)}}}}var Me=typeof window<"u"?w.default.useLayoutEffect:w.default.useEffect;function Ns(e,t){t===void 0&&(t={width:0,height:0});var r=w.default.useState(e.current),n=r[0],s=r[1],i=w.default.useReducer($s,t),a=i[0],c=i[1],l=w.default.useRef(!1);return Me(function(){e.current!==n&&s(e.current)}),Me(function(){if(n&&!l.current){l.current=!0;var u=n.getBoundingClientRect();c({rect:u})}},[n]),w.default.useEffect(function(){if(!!n){var u=js(n,function(h){c({rect:h})});return u.observe(),function(){u.unobserve()}}},[n]),a}function $s(e,t){var r=t.rect;return e.height!==r.height||e.width!==r.width?r:e}var Ls=function(){return 50},zs=function(t){return t},Ps=function(t,r){var n=r?"offsetWidth":"offsetHeight";return t[n]},Fs=function(t){for(var r=Math.max(t.start-t.overscan,0),n=Math.min(t.end+t.overscan,t.size-1),s=[],i=r;i<=n;i++)s.push(i);return s};function Bs(e){var t,r=e.size,n=r===void 0?0:r,s=e.estimateSize,i=s===void 0?Ls:s,a=e.overscan,c=a===void 0?1:a,l=e.paddingStart,u=l===void 0?0:l,h=e.paddingEnd,m=h===void 0?0:h,p=e.parentRef,g=e.horizontal,v=e.scrollToFn,x=e.useObserver,P=e.initialRect,I=e.onScrollElement,F=e.scrollOffsetFn,j=e.keyExtractor,D=j===void 0?zs:j,Oe=e.measureSize,oe=Oe===void 0?Ps:Oe,k=e.rangeExtractor,T=k===void 0?Fs:k,N=g?"width":"height",ee=g?"scrollLeft":"scrollTop",C=w.default.useRef({scrollOffset:0,measurements:[]}),B=w.default.useState(0),tr=B[0],M=B[1];C.current.scrollOffset=tr;var ce=x||Ns,Ce=ce(p,P),li=Ce[N];C.current.outerSize=li;var ve=w.default.useCallback(function(y){p.current&&(p.current[ee]=y)},[p,ee]),rr=v||ve;v=w.default.useCallback(function(y){rr(y,ve)},[ve,rr]);var nr=w.default.useState({}),sr=nr[0],Xe=nr[1],ui=w.default.useCallback(function(){return Xe({})},[]),Ie=w.default.useRef([]),le=w.default.useMemo(function(){var y=Ie.current.length>0?Math.min.apply(Math,Ie.current):0;Ie.current=[];for(var S=C.current.measurements.slice(0,y),E=y;E<n;E++){var R=D(E),b=sr[R],U=S[E-1]?S[E-1].end:u,$=typeof b=="number"?b:i(E),L=U+$;S[E]={index:E,start:U,size:$,end:L,key:R}}return S},[i,sr,u,n,D]),ir=(((t=le[n-1])==null?void 0:t.end)||u)+m;C.current.measurements=le,C.current.totalSize=ir;var ye=I?I.current:p.current,Ze=w.default.useRef(F);Ze.current=F,Me(function(){if(!ye){M(0);return}var y=function(E){var R=Ze.current?Ze.current(E):ye[ee];M(R)};return y(),ye.addEventListener("scroll",y,{capture:!1,passive:!0}),function(){ye.removeEventListener("scroll",y)}},[ye,ee]);var ar=Hs(C.current),or=ar.start,cr=ar.end,De=w.default.useMemo(function(){return T({start:or,end:cr,overscan:c,size:le.length})},[or,cr,c,le.length,T]),lr=w.default.useRef(oe);lr.current=oe;var hi=w.default.useMemo(function(){for(var y=[],S=function(U,$){var L=De[U],Re=le[L],te=X(X({},Re),{},{measureRef:function(Te){if(Te){var rt=lr.current(Te,g);if(rt!==te.size){var hr=C.current.scrollOffset;te.start<hr&&ve(hr+(rt-te.size)),Ie.current.push(L),Xe(function(fi){var nt;return X(X({},fi),{},(nt={},nt[te.key]=rt,nt))})}}}});y.push(te)},E=0,R=De.length;E<R;E++)S(E);return y},[De,ve,g,le]),ur=w.default.useRef(!1);Me(function(){ur.current&&Xe({}),ur.current=!0},[i]);var et=w.default.useCallback(function(y,S){var E=S===void 0?{}:S,R=E.align,b=R===void 0?"start":R,U=C.current,$=U.scrollOffset,L=U.outerSize;b==="auto"&&(y<=$?b="start":y>=$+L?b="end":b="start"),b==="start"?v(y):b==="end"?v(y-L):b==="center"&&v(y-L/2)},[v]),tt=w.default.useCallback(function(y,S){var E=S===void 0?{}:S,R=E.align,b=R===void 0?"auto":R,U=Is(E,["align"]),$=C.current,L=$.measurements,Re=$.scrollOffset,te=$.outerSize,G=L[Math.max(0,Math.min(y,n-1))];if(!!G){if(b==="auto")if(G.end>=Re+te)b="end";else if(G.start<=Re)b="start";else return;var Te=b==="center"?G.start+G.size/2:b==="end"?G.end:G.start;et(Te,X({align:b},U))}},[et,n]),di=w.default.useCallback(function(){for(var y=arguments.length,S=new Array(y),E=0;E<y;E++)S[E]=arguments[E];tt.apply(void 0,S),requestAnimationFrame(function(){tt.apply(void 0,S)})},[tt]);return{virtualItems:hi,totalSize:ir,scrollToOffset:et,scrollToIndex:di,measure:ui}}var Us=function(t,r,n,s){for(;t<=r;){var i=(t+r)/2|0,a=n(i);if(a<s)t=i+1;else if(a>s)r=i-1;else return i}return t>0?t-1:0};function Hs(e){for(var t=e.measurements,r=e.outerSize,n=e.scrollOffset,s=t.length-1,i=function(u){return t[u].start},a=Us(0,s,i,n),c=a;c<s&&t[c].end<n+r;)c++;return{start:a,end:c}}var Ws=({items:e,children:t,keySel:r,height:n,className:s})=>{const i=o.useRef(),a=Bs({parentRef:i,size:e.length,keyExtractor:c=>r(e[c])});return o.createElement("div",{ref:i,style:{overflow:"auto",height:n},className:s},o.createElement("div",{style:{height:a.totalSize,width:"100%",position:"relative"}},a.virtualItems.map(c=>o.createElement("div",{ref:c.measureRef,key:c.key,style:{position:"absolute",top:0,left:0,width:"100%",height:c.height,transform:`translateY(${c.start}px)`}},t(e[c.index])))))};const Ks=()=>Promise.all(d.persist.ghost.repos.map(xe)),Vs=async()=>(await Ks()).flatMap(e=>e.themes),Ys=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((r,n)=>r===t[n]);var qs=({goTo:e})=>{re.useNest(d.persist,!1,(h,{path:m})=>m[0]==="repos");const[t,r]=o.useState(""),[n,s]=o.useState([]),[i,a]=o.useState(void 0),[c,l]=o.useState(0);o.useEffect(()=>{(!Ys(n,d.persist.ghost.repos)||!i)&&(s(d.persist.ghost.repos),Vs().then(a))});const u=Nt();return o.createElement(H.ErrorBoundary,null,o.createElement("div",{className:"ysink_stain_search_row"},o.createElement(Tt,{query:t,onChange:r}),o.createElement(At,{filterMode:c,setFilterMode:l})),d.persist.ghost.repos.length===0?o.createElement(On,{goToRepos:()=>e(2)}):o.createElement(Ws,{className:Nr,height:"50rem",keySel:h=>h.url,items:Rt(_.uniqBy(i??[],h=>h.url),t).filter(h=>c===0||c===1&&!h.compat||c===2&&h.compat)},h=>o.createElement(pt,{theme:h,deleteHook:u,gap:".5rem"})))},Gs=()=>o.createElement(H.ErrorBoundary,null,o.createElement(K,{className:"ysink_stain_button",onClick:br},"Clear fetch cache"),o.createElement(he,null,"@ me if you need other things for debug purposes :)")),Js=({items:e})=>{let[t,r]=o.useState(0);return o.createElement("div",{className:"ysink_stain_tabbar_root"},o.createElement("div",{className:"ysink_stain_tabbar"},e.map((n,s)=>o.createElement("button",{className:"ysink_stain_button"+(s===t?" ysink_stain_selected":""),onClick:()=>r(s)},o.createElement(he,null,n.text)))),o.createElement("div",{className:"ysink_stain_divide"}),o.createElement("div",{className:"ysink_stain_tabbar_content"},o.createElement(e[t].component,{goTo:r})))},Qs=()=>o.createElement(H.ErrorBoundary,null,o.createElement(Fe,null,o.createElement(ut,{tag:"h1"},"Cumstain Settings"),o.createElement(Js,{items:[{text:"Installed",component:In},{text:"Store",component:qs},{text:"Repos",component:Cs},{text:"Quick CSS",component:Es},{text:"Debug",component:Gs}]}))),Xs=()=>dr.registerSection("ysink_stain","Themes",Qs),Zs=()=>{const e=je.injectCSS(d.persist.ghost.quickCSS),t=(r,{path:[n]})=>{n==="quickCSS"&&e(d.persist.ghost.quickCSS)};return d.persist.on("SET",t),()=>{e(),d.persist.off("SET",t)}};const ge=e=>d.persist.ghost.themes.find(t=>t.url===e),Zt=e=>!!ge(e)?.enabled,Dt=e=>Zt(e.url)?xr(e):ue(e),Ds=async e=>await Dt(await se(e)),ei=e=>ct(ge(e)),ti=async e=>{if(!ge(e))throw new Error(`Theme with ID ${e} was not installed`);Zt(e)?Pe(ge(e)):await Dt(ge(e))},Z=async()=>{if(!window.cumstain){Le.error("|| CUMSTAIN || API was not found, so nests could not be updated.");return}for(const e in cumstain.installed.ghost)delete cumstain.installed.ghost[e],cumstain.installed.delete(e);for(const e of d.persist.ghost.themes)cumstain.installed.store[e.url]={enabled:e.enabled,manifest:e};for(const[e,t]of Object.entries(cumstain.installed.ghost))t.enabled?cumstain.enabled.store[e]=t:(delete cumstain.enabled.ghost[e],cumstain.installed.delete(e))};var ri=()=>(window.cumstain={installed:W.nests.make({}),enabled:W.nests.make({}),importTheme:Ds,removeTheme:ei,toggleTheme:ti},Z(),d.persist.on(W.nests.Events.UPDATE,Z),d.persist.on(W.nests.Events.SET,Z),d.persist.on(W.nests.Events.DELETE,Z),Le.log("|| CUMSTAIN || Initialised window.cumstain API"),()=>{d.persist.off(W.nests.Events.UPDATE,Z),d.persist.off(W.nests.Events.SET,Z),d.persist.off(W.nests.Events.DELETE,Z),window.cumstain=void 0,delete window.cumstain,Le.log("|| CUMSTAIN || Disposed window.cumstain API")});const er="User confirmation declined";function ni(e,{ok:t,error:r}){if(typeof e?.repo!="string")return r("You must supply a repo");at.showConfirmationModal({type:"confirm",confirmText:"Add Repo",header:"[Cumstain] Add Repo?",content:`A web page or another app on your PC just tried to add the following theme repo: \`${e.repo}\`. Allow this?`}).then(n=>{n?Jt(e.repo,t,r).catch(s=>r("Unhandled error: "+s)):r(er)})}function si(e,{ok:t,error:r}){if(typeof e?.url!="string")return r("You must supply a theme url");at.showConfirmationModal({type:"confirm",confirmText:"Install Theme",header:"[Cumstain] Install theme?",content:`A web page or another app on your PC just tried to install the following theme: \`${e.url}\`. Allow this?`}).then(n=>{n?Os(e.url,t,r).catch(s=>r("Unhandled error: "+s)):r(er)})}var ii=()=>[it.addHandler("ysink_stain_addrepo",ni),it.addHandler("ysink_stain_addtheme",si)],ai=()=>je.injectCSS(".ysink_stain_card{background:var(--background-secondary-alt);padding:1rem;border:1px solid var(--background-modifier-accent);border-radius:.5rem;width:100%!important;color:var(--text-normal)}.ysink_stain_title{display:flex;align-items:center;font-size:1rem;color:var(--interactive-active)}.ysink_stain_cardcontainer>*{margin-bottom:.5rem}.ysink_stain_divide{margin:.5rem 0;width:100%;height:1px;border-top:thin solid var(--background-modifier-accent)}.ysink_stain_row{display:flex;gap:1rem}.ysink_stain_row>:not(:last-child){flex:1}.ysink_stain_tabbar{padding:.5rem 1rem;display:grid;grid-auto-flow:column;grid-auto-columns:7rem}.ysink_stain_tabbar .ysink_stain_button *{cursor:pointer}.ysink_stain_tabbar>*{margin-right:1rem;padding:.2rem;border-radius:.3rem;min-width:5rem;text-align:center;background:none}.theme-dark .ysink_stain_tabbar>*.ysink_stain_selected{background:rgba(255,255,255,.2666666667)}.theme-light .ysink_stain_tabbar>*.ysink_stain_selected{background:rgba(0,0,0,.2)}.ysink_stain_tabbar>*:last-child{margin-right:0}.ysink_stain_searchbar{margin:.75rem 0}.ysink_stain_search_row{display:flex;gap:.75rem;margin:.75rem 0}.ysink_stain_search_row .ysink_stain_dropdown{height:2.25rem;flex-basis:10rem;padding-top:.3rem}.ysink_stain_search_row .ysink_stain_searchbar{margin:unset;flex:1}.ysink_stain_tcard{display:grid;grid-template-columns:auto 1fr min-content;grid-template-rows:auto 1fr;align-items:center}.ysink_stain_tcard .ysink_stain_tmedia{grid-row:1/3;height:4rem;width:7rem;margin-right:1rem;background-size:cover}.ysink_stain_tcard .ysink_stain_tmedia *{display:flex;justify-content:center;align-items:center;height:100%}.ysink_stain_tcard .ysink_stain_tmedia .ysink_stain_tview{z-index:1;transition:opacity .25s ease;backdrop-filter:brightness(.3);cursor:pointer}.ysink_stain_tcard .ysink_stain_tmedia .ysink_stain_tview:not(:hover){opacity:0}.ysink_stain_tcard .ysink_stain_tdesc{grid-area:2/2}.ysink_stain_tcard .ysink_stain_tacts{grid-column:3;justify-self:right}.ysink_stain_tcard .ysink_stain_tacts>:last-child{margin-left:.25rem}.ysink_stain_tcard .ysink_stain_tacts>*{display:inline-block}.ysink_stain_tcard .ysink_stain_taulic{text-align:right;min-width:8rem}.ysink_stain_iconbtn{margin-right:.25rem;fill:var(--interactive-normal);cursor:pointer;height:22px;width:22px}.ysink_stain_badge{width:1.5rem;height:1.5rem;margin-right:.5rem;border-radius:50%}.ysink_stain_badge.ysink_stain_bd{padding:.25rem;background:#040405}.ysink_stain_badge.ysink_stain_cc{padding:.1rem;background:#7289DA}.ysink_stain_cssedit{background:#1d1f21;color:#c5c8c6;border-radius:.3rem;font-family:var(--font-code);font-size:.9rem;line-height:1.1rem}.ysink_stain_nosplash{display:flex;flex-direction:column;align-items:center;margin-top:15rem;gap:.5rem}.ysink_stain_nosplash h2{margin-bottom:0}.ysink_stain_nosplash>*{flex:0}.ysink_stain_nosplash .ysink_stain_button{margin-top:2rem}.ysink_stain_officialbadge{display:inline;margin-left:.5rem}#ysink_stain_cumstain-tab{padding-bottom:0}");Array.isArray(d.persist.ghost.repos)||Ss(),Array.isArray(d.persist.ghost.themes)||(d.persist.store.themes=[]);const oi=[Zs(),Or(),ri(),...ii(),Xs(),ai()],ci=()=>_.forEachRight(oi,e=>e());return Ae.onUnload=ci,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae})({},cumcord.pluginData,cumcord.patcher,cumcord.ui.userSettings,cumcord.modules.common.React,cumcord.utils,cumcord.ui.components,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.modules.common.React,cumcord.modules.internal,cumcord.utils.logger,cumcord.websocket,cumcord.ui.modals);
