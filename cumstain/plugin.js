(function(c,p,w,d,u,a,f){"use strict";function m(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var i=m(c),b=m(w);const S=/[^\S\r\n]*?\r?\n[^\S\r\n]*?\*[^\S\r\n]?/,N=/^\\@/;function x(e){try{return JSON.parse(e)}catch{}}function T(e){const t=e.split(`
`)[0];if(t.includes("//META"))return M(e);if(t.includes("/**"))return C(e);throw new Error("META was not found.")}function M(e){const t=e.split(`
`)[0],s=t.substring(t.lastIndexOf("//META")+6,t.lastIndexOf("*//")),n=x(s);if(!n)throw new Error("META could not be parsed.");if(!n.name)throw new Error("META missing name data.");return n}function C(e){const t=e.split("/**",2)[1].split("*/",1)[0],s={};let n="",r="";for(const l of t.split(S))if(l.length!==0)if(l.charAt(0)==="@"&&l.charAt(1)!==" "){s[n]=r;const o=l.indexOf(" ");n=l.substr(1,o-1),r=l.substr(o+1)}else r+=" "+l.replace("\\n",`
`).replace(N,"@");return s[n]=r.trim(),delete s[""],s}var D=async(e,t)=>{const s=await(await fetch(new URL(e,t).href)).text();return{id:`${t}___${e}`,CSS:s,...T(s)}};async function B(e){const t=new URL("repo.json",e).href,s=await(await fetch(t)).json();if(!s.themes||s.themes?.length===0)throw new Error("No themes found in repo");if(!s.meta)throw new Error("No repo metadata");if(!s?.meta.name)throw new Error("Repo did not have a name");return s}var h=async e=>{const t=await B(e),s=await Promise.all(t.themes.map(n=>D(n,e)));return{manifest:t,themes:s}};function _(e){if(!e?.id||!e.CSS)throw new Error("theme was missing either id or css.");const t=p.injectCSS(e.CSS);i.default.state.ghost.unpatchCache.set(e.id,t),i.default.persist.store.themes=i.default.persist.ghost.themes.filter(s=>s.id!==e.id),i.default.persist.store.themes.push({id:e.id,enabled:!0})}function y(e){if(!e?.id)throw new Error("theme was missing id.");const t=i.default.state.ghost.unpatchCache.get(e.id);if(!t)throw new Error("theme was not loaded.");t(),i.default.state.ghost.unpatchCache.delete(e.id),i.default.persist.store.themes=i.default.persist.ghost.themes.filter(s=>s.id!==e.id),i.default.persist.store.themes.push({id:e.id,enabled:!1})}function F(e){try{y(e)}catch(t){if(t.message!=="theme was not loaded.")throw t}i.default.persist.store.themes=i.default.persist.ghost.themes.filter(t=>t.id!==e.id)}function g(){i.default.state.ghost.unpatchCache.forEach(e=>e?.()),i.default.state.ghost.unpatchCache.clear(),i.default.state.store.unpatchCache=i.default.state.ghost.unpatchCache}var L=async()=>{if(!c.persist.ghost.repos||!c.persist.ghost.themes)return g;const e=c.persist.ghost.repos,s=(await Promise.all(e.map(async r=>[r,await h(r)]))).flatMap(([r,l])=>l.themes.map(o=>({...o,repoUrl:r}))),n=c.persist.ghost.themes.filter(r=>r.enabled);return s.filter(r=>n.some(l=>r.id===l.id)).forEach(_),g},$=()=>(i.default.persist.ghost.repos||(i.default.persist.store.repos=[]),i.default.persist.ghost.themes||(i.default.persist.store.themes=[]),i.default.state=b.default.make({unpatchCache:new Map}),()=>{i.default.state=void 0,delete i.default.state});const A=a.React.useState,I=a.React.createElement,U=d.findByDisplayName("FormText"),z=d.findByDisplayName("FormDivider");var O=({items:e})=>{let[t,s]=A(0);return a.React.createElement("div",{className:"ysink_stain_tabbar_root"},a.React.createElement("div",{className:"ysink_stain_tabbar"},e.map((n,r)=>a.React.createElement("button",{className:"ysink_stain_button"+(r===t?" ysink_stain_selected":""),onClick:()=>s(r)},a.React.createElement(U,null,n.text)))),a.React.createElement(z,{className:"ysink_stain_divide"}),a.React.createElement("div",{className:"ysink_stain_tabbar_content"},I(e[t].component)))},j=({theme:e,onClick:t})=>a.React.createElement("svg",{onClick:t,className:"ysink_stain_delete",xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},a.React.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),a.React.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),a.React.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12l1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}));const P=a.React.useReducer,H=d.findByDisplayName("FormTitle"),E=d.findByDisplayName("FormText"),V=d.findByDisplayName("FormSection"),J=d.findByDisplayName("FormDivider"),G=d.findByDisplayName("Switch"),R=e=>{for(const t of c.persist.ghost.themes)if(t.id===e&&t.enabled)return!0;return!1},q=e=>c.persist.ghost.themes.some(t=>t.id===e);var k=({theme:e})=>{f.useNest(c.persist,!1,(s,n)=>n?.[0]==="themes");const[,t]=P(s=>~s,0);return a.React.createElement("div",{className:"ysink_stain_card"},a.React.createElement(V,null,a.React.createElement("div",{className:"ysink_stain_row"},a.React.createElement(H,{tag:"p",className:"ysink_stain_title"},e.name),q(e.id)?a.React.createElement(j,{theme:e,onClick:()=>{F(e),t()}}):[],a.React.createElement(G,{checked:R(e.id),onChange:()=>{R(e.id)?y(e):_(e),t()}})),a.React.createElement(E,{className:"ysink_stain_desc"},e.description),a.React.createElement(J,{className:"ysink_stain_divide"}),a.React.createElement(E,{className:"ysink_stain_author_licence"},e.author?`by ${e.author} `:"",e.license?`under ${e.license}`:"")))};const K=a.React.useState,Q=a.React.useEffect,W=()=>Promise.all(c.persist.ghost.repos.map(h)),X=async()=>(await W()).flatMap(e=>e.themes).filter(e=>c.persist.ghost.themes.some(t=>e.id===t.id));var Y=()=>{f.useNest(c.persist,!1,(s,n)=>n?.[0]==="themes");let[e,t]=K(void 0);return Q(()=>{e||X().then(t)}),a.React.createElement(u.ErrorBoundary,null,a.React.createElement("div",{className:"ysink_stain_cardcontainer"},(e??[]).map(s=>a.React.createElement(k,{theme:s}))))};const v=a.React.useState,Z=a.React.useEffect,ee=()=>Promise.all(c.persist.ghost.repos.map(h)),te=e=>e.flatMap(t=>t.themes);async function se(){let e=await ee();return{repos:e,themes:te(e)}}var ae=()=>{f.useNest(c.persist);let[e,t]=v(void 0),[s,n]=v(void 0);return Z(()=>{(!e||!s)&&se().then(({repos:r,themes:l})=>{t(r),n(l)})}),a.React.createElement(u.ErrorBoundary,null,a.React.createElement("div",{className:"ysink_stain_cardcontainer"},(s??[]).map(r=>a.React.createElement(k,{theme:r}))))};const ne=d.findByDisplayName("FormTitle"),ie=d.findByDisplayName("FormSection");var re=()=>a.React.createElement(u.ErrorBoundary,null,a.React.createElement(ie,null,a.React.createElement(ne,{tag:"h1"},"Cumstain"),a.React.createElement(O,{items:[{text:"Store",component:ae},{text:"Installed",component:Y}]}))),ce=()=>p.after("getPredicateSections",d.findByDisplayName("SettingsView").prototype,(e,t)=>{if(t[1]?.section!="My Account")return;let s=t.findIndex(n=>n.section=="CUMCORD_PLUGINS")+1;return t.splice(s,0,{section:"ysink_stain_CUMSTAIN",label:"Themes",element:re}),t}),le=()=>cumcord.patcher.injectCSS(".ysink_stain_tabbar{padding:.5rem 1rem;display:grid;grid-auto-flow:column;grid-auto-columns:7rem}.ysink_stain_tabbar .ysink_stain_button *{cursor:pointer}.ysink_stain_tabbar>*{margin-right:1rem;padding:.2rem;border-radius:.3rem;min-width:5rem;text-align:center;background:none}.theme-dark .ysink_stain_tabbar>*.ysink_stain_selected{background:#fff4}.theme-light .ysink_stain_tabbar>*.ysink_stain_selected{background:#0003}.ysink_stain_tabbar>*:last-child{margin-right:0}.ysink_stain_cardcontainer{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}.ysink_stain_card{padding:1rem;border:1px solid var(--background-modifier-accent);border-radius:.25rem;display:flex;flex-direction:column;z-index:1;background-color:var(--deprecated-card-bg)}.ysink_stain_card .ysink_stain_title{font-size:1rem;padding-bottom:.25rem;display:inline;flex:1;margin:0}.ysink_stain_card .ysink_stain_button{display:inline;padding:0}.ysink_stain_card .ysink_stain_button>div{padding:2px 16px}.ysink_stain_card .ysink_stain_row{display:flex}.ysink_stain_card .ysink_stain_row>:first-child{flex:1}.ysink_stain_card .ysink_stain_row>*{flex:unset}.ysink_stain_card .ysink_stain_author_licence{font-style:italic}.ysink_stain_card .ysink_stain_desc{flex:1}.ysink_stain_divide{margin:0 0 1rem}.ysink_stain_card .ysink_stain_divide{margin:.2rem 0}.ysink_stain_delete{margin-left:.5rem;fill:var(--interactive-normal)}"),de=({persist:e})=>{let t=[];return{onLoad:async()=>{e.store.repos=["http://127.0.0.1:8080/"],t.push(le(),$(),await L(),ce())},onUnload:()=>t.reduceRight((s,n)=>n?.(),null)}};return de})(cumcord.pluginData,cumcord.patcher,cumcord.modules.internal.nests,cumcord.modules.webpack,cumcord.ui.components,cumcord.modules.common,cumcord.utils);
