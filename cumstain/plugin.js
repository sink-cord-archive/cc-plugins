var pi=Object.defineProperty;var gi=(z,h,P)=>h in z?pi(z,h,{enumerable:!0,configurable:!0,writable:!0,value:P}):z[h]=P;var we=(z,h,P)=>(gi(z,typeof h!="symbol"?h+"":h,P),P);(function(z,h,P,fr,it,se,W,mr,je,Le,V,ze,at,ot){"use strict";function pr(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function gr(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var o=gr(it),w=pr(Le);const vr=/[^\S\r\n]*?\r?\n[^\S\r\n]*?\*[^\S\r\n]?/,yr=/^\\@/;function _r(e){try{return JSON.parse(e)}catch{}}function Er(e){const t=e.split(`
`)[0],r=t.substring(t.lastIndexOf("//META")+6,t.lastIndexOf("*//")),n=_r(r);if(!n)throw new Error("META could not be parsed.");if(!n.name)throw new Error("META missing name data.");return n}function wr(e){const t=e.split("/**",2)[1].split("*/",1)[0],r={};let n="",s="";for(const i of t.split(vr))if(i.length!==0)if(i.charAt(0)==="@"&&i.charAt(1)!==" "){n!==""&&(r[n]=s);const a=i.indexOf(" ");n=i.substr(1,a-1),s=i.substr(a+1)}else s+=` ${i.replace("\\n",`
`).replace(yr,"@")}`;return r[n]=s.trim(),r}var br=e=>{const t=e.split(`
`)[0];if(t.includes("//META"))return Er(e);if(t.includes("/**"))return wr(e);throw new Error("META was not found.")};const he={},X={};async function Pe(e){return he[e]||(X[e]||(X[e]=[fetch(e).then(async t=>{he[e]=[t.status,t.status===200?await t.text():void 0]}),0]),X[e][1]++,await X[e][0],X[e][1]--,X[e][1]===0&&delete X[e]),he[e]}async function ct(e){const[t,r]=await Pe(e);return[t,r?JSON.parse(r):void 0]}const Sr=()=>Object.keys(he).forEach(e=>delete he[e]);async function kr(e,t){const r=new URL(e,t).href,[n,s]=await Pe(r);if(n!==200)throw new Error(`BD theme existed in cache with non-200 status ${n}`);return{url:r,CSS:()=>Promise.resolve(s),compat:!0,repoUrl:t,...br(s)}}async function xr(e,t){const r=new URL(e,t).href;let n=new URL(e,t).pathname.split("/");n.splice(n.length-1,1,"cumcord_theme.json");const s=new URL(n.join("/"),new URL(e,t).origin).href,[i,a]=await ct(s);if(i!==200)throw new Error(`CC manifest existed in cache with non-200 status ${i}`);return{url:r,compat:!1,...a,repoUrl:t,CSS:async()=>{const[c,l]=await Pe(r);if(c!==200)throw new Error(`CC CSS existed in cache with non-200 status ${c}`);return l}}}var ie=async(e,t)=>{try{return await xr(e,t)}catch(r){try{return await kr(e,t)}catch(n){console.error(r,n);let s=new Error("Failed to fetch theme - both CC and BD either failed to fetch or failed to parse");throw s.e1=r,s.e2=n,s}}};const ae=new Map;async function de(e){if(!e?.url||!await e.CSS())throw new Error("theme was missing either id or css.");const t=P.injectCSS(await e.CSS());ae.set(e.url,t);const r=h.persist.ghost.themes.findIndex(s=>s.url===e.url);let n={...e};delete n.CSS,n.enabled=!0,r===-1?h.persist.ghost.themes.push(n):h.persist.ghost.themes[r]=n,h.persist.store.themes=h.persist.ghost.themes}function Fe(e){if(!e?.url)throw new Error("theme was missing id.");ae.get(e.url)?.(),ae.delete(e.url);const t=h.persist.ghost.themes.findIndex(n=>n.url===e.url);let r={...e};r.enabled=!1,t===-1?h.persist.ghost.themes.push(r):h.persist.ghost.themes[t]=r,h.persist.store.themes=h.persist.ghost.themes}function lt(e){try{Fe(e)}catch(t){if(t.message!=="theme was not loaded.")throw t}h.persist.store.themes=h.persist.ghost.themes.filter(t=>t.url!==e.url)}async function Mr(e){ae.get(e.url)?.(await e.CSS());let t={...e};t.enabled=!0;const r=h.persist.ghost.themes.findIndex(n=>n.url===e.url);r!==-1&&(h.persist.ghost.themes[r]=t,h.persist.store.themes=h.persist.ghost.themes)}function Or(){ae.forEach(e=>e?.()),ae.clear()}var Cr=()=>{let e=!1;return h.persist.ghost.themes&&h.persist.ghost.themes.filter(t=>t.enabled).forEach(t=>ie(t.url,t.repoUrl).then(r=>e||de(r))),()=>{Or(),e=!0}};const ut=(e,t)=>()=>o.createElement("img",{src:e,className:`ysink_stain_badge ysink_stain_${t}`}),Ir=ut("https://betterdiscord.app/resources/branding/logo_small.svg","bd"),Ar=ut("https://raw.githubusercontent.com/Cumcord/assets/main/logo/filled.svg","cc"),[ht,fe,Be,Y,$r,Tr,Rr,Nr,dt,ft,mt,{thin:jr},be,{openModal:Lr}]=mr.batchFind(({findByProps:e,findByDisplayName:t})=>{t("FormTitle"),t("FormText"),t("FormSection"),e("BorderColors"),t("Switch"),e("BadgeShapes"),t("Flex"),t("Select",!1),t("TextInput"),t("SmallMediaCarousel"),t("SearchBar"),e("scrollerBase","thin"),e("ModalCloseButton"),e("openModalLazy")});var zr=({media:e})=>o.createElement("div",{class:"ysink_stain_carousel"},e?o.createElement(ft,{items:(typeof e=="string"?[e]:e).map(t=>({type:1,src:t})),autoplayInterval:5e3}):o.createElement("div",{className:"ysink_stain_noimg"},o.createElement(fe,{className:"ysink_stain_noimgtxt"},"No Image"),o.createElement(ft,{items:[{type:1,src:""}]})));const Pr=({e,media:t})=>o.createElement(W.ErrorBoundary,null,o.createElement(be.ModalRoot,{transitionState:e.transitionState,size:"large"},o.createElement(be.ModalHeader,{separator:!1},o.createElement("div",{style:{flex:1}}),o.createElement(be.ModalCloseButton,{onClick:e.onClose})),o.createElement(be.ModalContent,null,o.createElement("div",{style:{marginBottom:"1rem"}},o.createElement(zr,{media:t})))));var Fr=e=>Lr(t=>o.createElement(Pr,{e:t,media:e})),Br=e=>o.createElement("svg",{...e,xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},o.createElement("path",{d:"M 3.9999998,21.333333 C 3.9999998,22.8 5.1999998,24 6.6666665,24 H 17.333334 C 18.799999,24 20,22.8 20,21.333333 V 5.3333333 H 3.9999998 Z M 7.2799998,11.84 9.1599995,9.96 12,12.786667 14.826667,9.96 l 1.879999,1.88 -2.826667,2.826667 2.826667,2.826666 -1.879999,1.88 L 12,16.546667 l -2.8266665,2.826666 -1.8800003,-1.88 2.8266658,-2.826666 z M 16.666666,1.3333333 15.333334,0 H 8.6666665 L 7.3333332,1.3333333 H 2.6666665 V 4 H 21.333334 V 1.3333333 Z"})),Ur=e=>o.createElement("svg",{...e,xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px"},o.createElement("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}));function pt(e){for(const t of h.persist.ghost.themes)if(t.url===e&&t.enabled)return!0;return!1}const Hr=e=>h.persist.ghost.themes.some(t=>t.url===e);var gt=({theme:e,deleteHook:t,gap:r})=>(se.useNest(h.persist,!1,(n,{path:s})=>s[0]==="themes"),o.createElement("div",{className:"ysink_stain_card ysink_stain_tcard",style:{marginBottom:r}},o.createElement("div",{className:"ysink_stain_tmedia",style:{backgroundImage:e.media&&`url(${Array.isArray(e.media)?e.media[0]:e.media})`},onClick:()=>e.media&&Fr(e.media)},e.media?o.createElement("div",{className:"ysink_stain_tview"},"VIEW MEDIA"):o.createElement("div",null,"NO MEDIA")),o.createElement("div",{className:"ysink_stain_title"},e.compat?o.createElement(Ir,null):o.createElement(Ar,null),e.name),o.createElement("div",{className:"ysink_stain_tdesc"},e.description),o.createElement("div",{className:"ysink_stain_tacts"},o.createElement(Ur,{className:"ysink_stain_iconbtn",onClick:()=>se.copyText(e.url)}),Hr(e.url)?o.createElement(Br,{className:"ysink_stain_iconbtn",onClick:()=>{lt(e),t?.()}}):[],o.createElement($r,{checked:pt(e.url),onChange:async()=>pt(e.url)?Fe(e):de(await ie(e.url))})),o.createElement("div",{className:"ysink_stain_taulic"},e.author?`by ${e.author} `:"",e.license?`under ${e.license}`:""))),Kr=()=>{se.useNest(h.persist);let[e,t]=o.useState("");return o.createElement(W.ErrorBoundary,null,o.createElement("div",{className:"ysink_stain_row"},o.createElement(dt,{className:"ysink_stain_input",placeholder:"Theme import URL",type:"text",value:e,onChange:r=>t(r)}),o.createElement(Y,{className:"ysink_stain_button",onClick:()=>{ie(e).then(async r=>{await de(r),je.showToast({title:`Loaded theme ${r.name}`,duration:5e3}),t("")},()=>je.showToast({title:"Failed to fetch theme - check URL",duration:5e3}))}},"Install")))};function F(e){return Array.isArray?Array.isArray(e):_t(e)==="[object Array]"}const Wr=1/0;function Vr(e){if(typeof e=="string")return e;let t=e+"";return t=="0"&&1/e==-Wr?"-0":t}function Yr(e){return e==null?"":Vr(e)}function T(e){return typeof e=="string"}function vt(e){return typeof e=="number"}function Gr(e){return e===!0||e===!1||qr(e)&&_t(e)=="[object Boolean]"}function yt(e){return typeof e=="object"}function qr(e){return yt(e)&&e!==null}function O(e){return e!=null}function Ue(e){return!e.trim().length}function _t(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const vi="Extended search is not available",Jr="Incorrect 'index' type",Qr=e=>`Invalid value for key ${e}`,Xr=e=>`Pattern length exceeds max of ${e}.`,Zr=e=>`Missing ${e} property in key`,Dr=e=>`Property 'weight' in key '${e}' must be a positive integer`,Et=Object.prototype.hasOwnProperty;class en{constructor(t){this._keys=[],this._keyMap={};let r=0;t.forEach(n=>{let s=wt(n);r+=s.weight,this._keys.push(s),this._keyMap[s.id]=s,r+=s.weight}),this._keys.forEach(n=>{n.weight/=r})}get(t){return this._keyMap[t]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function wt(e){let t=null,r=null,n=null,s=1,i=null;if(T(e)||F(e))n=e,t=bt(e),r=He(e);else{if(!Et.call(e,"name"))throw new Error(Zr("name"));const a=e.name;if(n=a,Et.call(e,"weight")&&(s=e.weight,s<=0))throw new Error(Dr(a));t=bt(a),r=He(a),i=e.getFn}return{path:t,id:r,weight:s,src:n,getFn:i}}function bt(e){return F(e)?e:e.split(".")}function He(e){return F(e)?e.join("."):e}function tn(e,t){let r=[],n=!1;const s=(i,a,c)=>{if(!!O(i))if(!a[c])r.push(i);else{let l=a[c];const u=i[l];if(!O(u))return;if(c===a.length-1&&(T(u)||vt(u)||Gr(u)))r.push(Yr(u));else if(F(u)){n=!0;for(let d=0,m=u.length;d<m;d+=1)s(u[d],a,c+1)}else a.length&&s(u,a,c+1)}};return s(e,T(t)?t.split("."):t,0),n?r:r[0]}var f={...{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,t)=>e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1},...{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},...{location:0,threshold:.6,distance:100},...{useExtendedSearch:!1,getFn:tn,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1}};const rn=/[^ ]+/g;function nn(e=1,t=3){const r=new Map,n=Math.pow(10,t);return{get(s){const i=s.match(rn).length;if(r.has(i))return r.get(i);const a=1/Math.pow(i,.5*e),c=parseFloat(Math.round(a*n)/n);return r.set(i,c),c},clear(){r.clear()}}}class Ke{constructor({getFn:t=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){this.norm=nn(r,3),this.getFn=t,this.isCreated=!1,this.setIndexRecords()}setSources(t=[]){this.docs=t}setIndexRecords(t=[]){this.records=t}setKeys(t=[]){this.keys=t,this._keysMap={},t.forEach((r,n)=>{this._keysMap[r.id]=n})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,T(this.docs[0])?this.docs.forEach((t,r)=>{this._addString(t,r)}):this.docs.forEach((t,r)=>{this._addObject(t,r)}),this.norm.clear())}add(t){const r=this.size();T(t)?this._addString(t,r):this._addObject(t,r)}removeAt(t){this.records.splice(t,1);for(let r=t,n=this.size();r<n;r+=1)this.records[r].i-=1}getValueForItemAtKeyId(t,r){return t[this._keysMap[r]]}size(){return this.records.length}_addString(t,r){if(!O(t)||Ue(t))return;let n={v:t,i:r,n:this.norm.get(t)};this.records.push(n)}_addObject(t,r){let n={i:r,$:{}};this.keys.forEach((s,i)=>{let a=s.getFn?s.getFn(t):this.getFn(t,s.path);if(!!O(a)){if(F(a)){let c=[];const l=[{nestedArrIndex:-1,value:a}];for(;l.length;){const{nestedArrIndex:u,value:d}=l.pop();if(!!O(d))if(T(d)&&!Ue(d)){let m={v:d,i:u,n:this.norm.get(d)};c.push(m)}else F(d)&&d.forEach((m,p)=>{l.push({nestedArrIndex:p,value:m})})}n.$[i]=c}else if(T(a)&&!Ue(a)){let c={v:a,n:this.norm.get(a)};n.$[i]=c}}}),this.records.push(n)}toJSON(){return{keys:this.keys,records:this.records}}}function St(e,t,{getFn:r=f.getFn,fieldNormWeight:n=f.fieldNormWeight}={}){const s=new Ke({getFn:r,fieldNormWeight:n});return s.setKeys(e.map(wt)),s.setSources(t),s.create(),s}function sn(e,{getFn:t=f.getFn,fieldNormWeight:r=f.fieldNormWeight}={}){const{keys:n,records:s}=e,i=new Ke({getFn:t,fieldNormWeight:r});return i.setKeys(n),i.setIndexRecords(s),i}function Se(e,{errors:t=0,currentLocation:r=0,expectedLocation:n=0,distance:s=f.distance,ignoreLocation:i=f.ignoreLocation}={}){const a=t/e.length;if(i)return a;const c=Math.abs(n-r);return s?a+c/s:c?1:a}function an(e=[],t=f.minMatchCharLength){let r=[],n=-1,s=-1,i=0;for(let a=e.length;i<a;i+=1){let c=e[i];c&&n===-1?n=i:!c&&n!==-1&&(s=i-1,s-n+1>=t&&r.push([n,s]),n=-1)}return e[i-1]&&i-n>=t&&r.push([n,i-1]),r}const Z=32;function on(e,t,r,{location:n=f.location,distance:s=f.distance,threshold:i=f.threshold,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,includeMatches:l=f.includeMatches,ignoreLocation:u=f.ignoreLocation}={}){if(t.length>Z)throw new Error(Xr(Z));const d=t.length,m=e.length,p=Math.max(0,Math.min(n,m));let g=i,v=p;const x=c>1||l,B=x?Array(m):[];let I;for(;(I=e.indexOf(t,v))>-1;){let k=Se(t,{currentLocation:I,expectedLocation:p,distance:s,ignoreLocation:u});if(g=Math.min(k,g),v=I+d,x){let $=0;for(;$<d;)B[I+$]=1,$+=1}}v=-1;let U=[],R=1,te=d+m;const Ae=1<<d-1;for(let k=0;k<d;k+=1){let $=0,N=te;for(;$<N;)Se(t,{errors:k,currentLocation:p+N,expectedLocation:p,distance:s,ignoreLocation:u})<=g?$=N:te=N,N=Math.floor((te-$)/2+$);te=N;let re=Math.max(1,p-N+1),C=a?m:Math.min(p+N,m)+d,H=Array(C+2);H[C+1]=(1<<k)-1;for(let M=C;M>=re;M-=1){let le=M-1,$e=r[e.charAt(le)];if(x&&(B[le]=+!!$e),H[M]=(H[M+1]<<1|1)&$e,k&&(H[M]|=(U[M+1]|U[M])<<1|1|U[M+1]),H[M]&Ae&&(R=Se(t,{errors:k,currentLocation:le,expectedLocation:p,distance:s,ignoreLocation:u}),R<=g)){if(g=R,v=le,v<=p)break;re=Math.max(1,2*p-v)}}if(Se(t,{errors:k+1,currentLocation:p,expectedLocation:p,distance:s,ignoreLocation:u})>g)break;U=H}const ce={isMatch:v>=0,score:Math.max(.001,R)};if(x){const k=an(B,c);k.length?l&&(ce.indices=k):ce.isMatch=!1}return ce}function cn(e){let t={};for(let r=0,n=e.length;r<n;r+=1){const s=e.charAt(r);t[s]=(t[s]||0)|1<<n-r-1}return t}class kt{constructor(t,{location:r=f.location,threshold:n=f.threshold,distance:s=f.distance,includeMatches:i=f.includeMatches,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreLocation:u=f.ignoreLocation}={}){if(this.options={location:r,threshold:n,distance:s,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreLocation:u},this.pattern=l?t:t.toLowerCase(),this.chunks=[],!this.pattern.length)return;const d=(p,g)=>{this.chunks.push({pattern:p,alphabet:cn(p),startIndex:g})},m=this.pattern.length;if(m>Z){let p=0;const g=m%Z,v=m-g;for(;p<v;)d(this.pattern.substr(p,Z),p),p+=Z;if(g){const x=m-Z;d(this.pattern.substr(x),x)}}else d(this.pattern,0)}searchIn(t){const{isCaseSensitive:r,includeMatches:n}=this.options;if(r||(t=t.toLowerCase()),this.pattern===t){let v={isMatch:!0,score:0};return n&&(v.indices=[[0,t.length-1]]),v}const{location:s,distance:i,threshold:a,findAllMatches:c,minMatchCharLength:l,ignoreLocation:u}=this.options;let d=[],m=0,p=!1;this.chunks.forEach(({pattern:v,alphabet:x,startIndex:B})=>{const{isMatch:I,score:U,indices:R}=on(t,v,x,{location:s+B,distance:i,threshold:a,findAllMatches:c,minMatchCharLength:l,includeMatches:n,ignoreLocation:u});I&&(p=!0),m+=U,I&&R&&(d=[...d,...R])});let g={isMatch:p,score:p?m/this.chunks.length:1};return p&&n&&(g.indices=d),g}}class G{constructor(t){this.pattern=t}static isMultiMatch(t){return xt(t,this.multiRegex)}static isSingleMatch(t){return xt(t,this.singleRegex)}search(){}}function xt(e,t){const r=e.match(t);return r?r[1]:null}class ln extends G{constructor(t){super(t)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(t){const r=t===this.pattern;return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class un extends G{constructor(t){super(t)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(t){const n=t.indexOf(this.pattern)===-1;return{isMatch:n,score:n?0:1,indices:[0,t.length-1]}}}class hn extends G{constructor(t){super(t)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(t){const r=t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,this.pattern.length-1]}}}class dn extends G{constructor(t){super(t)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(t){const r=!t.startsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class fn extends G{constructor(t){super(t)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(t){const r=t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[t.length-this.pattern.length,t.length-1]}}}class mn extends G{constructor(t){super(t)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(t){const r=!t.endsWith(this.pattern);return{isMatch:r,score:r?0:1,indices:[0,t.length-1]}}}class Mt extends G{constructor(t,{location:r=f.location,threshold:n=f.threshold,distance:s=f.distance,includeMatches:i=f.includeMatches,findAllMatches:a=f.findAllMatches,minMatchCharLength:c=f.minMatchCharLength,isCaseSensitive:l=f.isCaseSensitive,ignoreLocation:u=f.ignoreLocation}={}){super(t);this._bitapSearch=new kt(t,{location:r,threshold:n,distance:s,includeMatches:i,findAllMatches:a,minMatchCharLength:c,isCaseSensitive:l,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(t){return this._bitapSearch.searchIn(t)}}class Ot extends G{constructor(t){super(t)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(t){let r=0,n;const s=[],i=this.pattern.length;for(;(n=t.indexOf(this.pattern,r))>-1;)r=n+i,s.push([n,r-1]);const a=!!s.length;return{isMatch:a,score:a?0:1,indices:s}}}const We=[ln,Ot,hn,dn,mn,fn,un,Mt],Ct=We.length,pn=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,gn="|";function vn(e,t={}){return e.split(gn).map(r=>{let n=r.trim().split(pn).filter(i=>i&&!!i.trim()),s=[];for(let i=0,a=n.length;i<a;i+=1){const c=n[i];let l=!1,u=-1;for(;!l&&++u<Ct;){const d=We[u];let m=d.isMultiMatch(c);m&&(s.push(new d(m,t)),l=!0)}if(!l)for(u=-1;++u<Ct;){const d=We[u];let m=d.isSingleMatch(c);if(m){s.push(new d(m,t));break}}}return s})}const yn=new Set([Mt.type,Ot.type]);class _n{constructor(t,{isCaseSensitive:r=f.isCaseSensitive,includeMatches:n=f.includeMatches,minMatchCharLength:s=f.minMatchCharLength,ignoreLocation:i=f.ignoreLocation,findAllMatches:a=f.findAllMatches,location:c=f.location,threshold:l=f.threshold,distance:u=f.distance}={}){this.query=null,this.options={isCaseSensitive:r,includeMatches:n,minMatchCharLength:s,findAllMatches:a,ignoreLocation:i,location:c,threshold:l,distance:u},this.pattern=r?t:t.toLowerCase(),this.query=vn(this.pattern,this.options)}static condition(t,r){return r.useExtendedSearch}searchIn(t){const r=this.query;if(!r)return{isMatch:!1,score:1};const{includeMatches:n,isCaseSensitive:s}=this.options;t=s?t:t.toLowerCase();let i=0,a=[],c=0;for(let l=0,u=r.length;l<u;l+=1){const d=r[l];a.length=0,i=0;for(let m=0,p=d.length;m<p;m+=1){const g=d[m],{isMatch:v,indices:x,score:B}=g.search(t);if(v){if(i+=1,c+=B,n){const I=g.constructor.type;yn.has(I)?a=[...a,...x]:a.push(x)}}else{c=0,i=0,a.length=0;break}}if(i){let m={isMatch:!0,score:c/i};return n&&(m.indices=a),m}}return{isMatch:!1,score:1}}}const Ve=[];function En(...e){Ve.push(...e)}function Ye(e,t){for(let r=0,n=Ve.length;r<n;r+=1){let s=Ve[r];if(s.condition(e,t))return new s(e,t)}return new kt(e,t)}const ke={AND:"$and",OR:"$or"},Ge={PATH:"$path",PATTERN:"$val"},qe=e=>!!(e[ke.AND]||e[ke.OR]),wn=e=>!!e[Ge.PATH],bn=e=>!F(e)&&yt(e)&&!qe(e),It=e=>({[ke.AND]:Object.keys(e).map(t=>({[t]:e[t]}))});function At(e,t,{auto:r=!0}={}){const n=s=>{let i=Object.keys(s);const a=wn(s);if(!a&&i.length>1&&!qe(s))return n(It(s));if(bn(s)){const l=a?s[Ge.PATH]:i[0],u=a?s[Ge.PATTERN]:s[l];if(!T(u))throw new Error(Qr(l));const d={keyId:He(l),pattern:u};return r&&(d.searcher=Ye(u,t)),d}let c={children:[],operator:i[0]};return i.forEach(l=>{const u=s[l];F(u)&&u.forEach(d=>{c.children.push(n(d))})}),c};return qe(e)||(e=It(e)),n(e)}function Sn(e,{ignoreFieldNorm:t=f.ignoreFieldNorm}){e.forEach(r=>{let n=1;r.matches.forEach(({key:s,norm:i,score:a})=>{const c=s?s.weight:null;n*=Math.pow(a===0&&c?Number.EPSILON:a,(c||1)*(t?1:i))}),r.score=n})}function kn(e,t){const r=e.matches;t.matches=[],!!O(r)&&r.forEach(n=>{if(!O(n.indices)||!n.indices.length)return;const{indices:s,value:i}=n;let a={indices:s,value:i};n.key&&(a.key=n.key.src),n.idx>-1&&(a.refIndex=n.idx),t.matches.push(a)})}function xn(e,t){t.score=e.score}function Mn(e,t,{includeMatches:r=f.includeMatches,includeScore:n=f.includeScore}={}){const s=[];return r&&s.push(kn),n&&s.push(xn),e.map(i=>{const{idx:a}=i,c={item:t[a],refIndex:a};return s.length&&s.forEach(l=>{l(i,c)}),c})}class oe{constructor(t,r={},n){this.options={...f,...r},this.options.useExtendedSearch,this._keyStore=new en(this.options.keys),this.setCollection(t,n)}setCollection(t,r){if(this._docs=t,r&&!(r instanceof Ke))throw new Error(Jr);this._myIndex=r||St(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(t){!O(t)||(this._docs.push(t),this._myIndex.add(t))}remove(t=()=>!1){const r=[];for(let n=0,s=this._docs.length;n<s;n+=1){const i=this._docs[n];t(i,n)&&(this.removeAt(n),n-=1,s-=1,r.push(i))}return r}removeAt(t){this._docs.splice(t,1),this._myIndex.removeAt(t)}getIndex(){return this._myIndex}search(t,{limit:r=-1}={}){const{includeMatches:n,includeScore:s,shouldSort:i,sortFn:a,ignoreFieldNorm:c}=this.options;let l=T(t)?T(this._docs[0])?this._searchStringList(t):this._searchObjectList(t):this._searchLogical(t);return Sn(l,{ignoreFieldNorm:c}),i&&l.sort(a),vt(r)&&r>-1&&(l=l.slice(0,r)),Mn(l,this._docs,{includeMatches:n,includeScore:s})}_searchStringList(t){const r=Ye(t,this.options),{records:n}=this._myIndex,s=[];return n.forEach(({v:i,i:a,n:c})=>{if(!O(i))return;const{isMatch:l,score:u,indices:d}=r.searchIn(i);l&&s.push({item:i,idx:a,matches:[{score:u,value:i,norm:c,indices:d}]})}),s}_searchLogical(t){const r=At(t,this.options),n=(c,l,u)=>{if(!c.children){const{keyId:m,searcher:p}=c,g=this._findMatches({key:this._keyStore.get(m),value:this._myIndex.getValueForItemAtKeyId(l,m),searcher:p});return g&&g.length?[{idx:u,item:l,matches:g}]:[]}const d=[];for(let m=0,p=c.children.length;m<p;m+=1){const g=c.children[m],v=n(g,l,u);if(v.length)d.push(...v);else if(c.operator===ke.AND)return[]}return d},s=this._myIndex.records,i={},a=[];return s.forEach(({$:c,i:l})=>{if(O(c)){let u=n(r,c,l);u.length&&(i[l]||(i[l]={idx:l,item:c,matches:[]},a.push(i[l])),u.forEach(({matches:d})=>{i[l].matches.push(...d)}))}}),a}_searchObjectList(t){const r=Ye(t,this.options),{keys:n,records:s}=this._myIndex,i=[];return s.forEach(({$:a,i:c})=>{if(!O(a))return;let l=[];n.forEach((u,d)=>{l.push(...this._findMatches({key:u,value:a[d],searcher:r}))}),l.length&&i.push({idx:c,item:a,matches:l})}),i}_findMatches({key:t,value:r,searcher:n}){if(!O(r))return[];let s=[];if(F(r))r.forEach(({v:i,i:a,n:c})=>{if(!O(i))return;const{isMatch:l,score:u,indices:d}=n.searchIn(i);l&&s.push({score:u,key:t,value:i,idx:a,norm:c,indices:d})});else{const{v:i,n:a}=r,{isMatch:c,score:l,indices:u}=n.searchIn(i);c&&s.push({score:l,key:t,value:i,norm:a,indices:u})}return s}}oe.version="6.6.2",oe.createIndex=St,oe.parseIndex=sn,oe.config=f,oe.parseQuery=At,En(_n);const On={threshold:.5,useExtendedSearch:!0,keys:["name","author","description"]};var $t=(e,t)=>!t||t==""?e:new oe(e,On).search(t).map(r=>r.item),Tt=({query:e,onChange:t})=>o.createElement(mt,{className:"ysink_stain_searchbar",query:e,onQueryChange:t,placeholder:"Search themes...",size:mt.Sizes.MEDIUM}),Rt=({filterMode:e,setFilterMode:t})=>o.createElement(Nr.SingleSelect,{options:[{value:0,label:"Show All"},{value:1,label:"CC Only"},{value:2,label:"BD Only"}],value:e,onChange:t,isDisabled:!1,className:"ysink_stain_dropdown"});const Nt=({title:e,subtitle:t,onClick:r,btnText:n})=>o.createElement(Be,{className:"ysink_stain_nosplash"},o.createElement(ht,{tag:"h2"},e),o.createElement(fe,null,t),o.createElement(Y,{className:"ysink_stain_button",color:Y.Colors.GREEN,sizes:Y.Sizes.LARGE,onClick:r},n)),Cn=({goToRepos:e})=>o.createElement(Nt,{title:"No Repos",subtitle:"Add one in the repo manager!",onClick:e,btnText:"Open repo manager"}),In=({goToStore:e})=>o.createElement(Nt,{title:"No Themes",subtitle:"Paste a link in above, or head over to the store",onClick:e,btnText:"Get some themes"});var jt=()=>{const[e,t]=it.useState(0);return()=>t(-e)},An=({goTo:e})=>{se.useNest(h.persist,!1,(a,{path:c})=>c[0]==="themes");const[t,r]=o.useState("");let[n,s]=o.useState(0);const i=jt();return o.createElement(W.ErrorBoundary,null,o.createElement(Kr,null),o.createElement("div",{className:"ysink_stain_search_row"},o.createElement(Tt,{query:t,onChange:r}),o.createElement(Rt,{filterMode:n,setFilterMode:s})),h.persist.ghost.themes.length===0?o.createElement(In,{goToStore:()=>e(1)}):o.createElement("div",{className:"ysink_stain_cardcontainer"},$t(h.persist.ghost.themes,t).filter(a=>n===0||n===1&&!a.compat||n===2&&a.compat).map(a=>o.createElement(gt,{key:a.url,theme:a,deleteHook:i}))))};function $n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Lt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function zt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Lt(Object(r),!0).forEach(function(n){$n(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tn(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}function Rn(e,t){if(e==null)return{};var r=Tn(e,t),n,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(s=0;s<i.length;s++)n=i[s],!(t.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function Nn(e,t){return jn(e)||Ln(e,t)||zn(e,t)||Pn()}function jn(e){if(Array.isArray(e))return e}function Ln(e,t){if(!(typeof Symbol=="undefined"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,s=!1,i=void 0;try{for(var a=e[Symbol.iterator](),c;!(n=(c=a.next()).done)&&(r.push(c.value),!(t&&r.length===t));n=!0);}catch(l){s=!0,i=l}finally{try{!n&&a.return!=null&&a.return()}finally{if(s)throw i}}return r}}function zn(e,t){if(!!e){if(typeof e=="string")return Pt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pt(e,t)}}function Pt(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Pn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),r.push.apply(r,n)}return r}function Bt(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ft(Object(r),!0).forEach(function(n){Fn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ft(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(n){return t.reduceRight(function(s,i){return i(s)},n)}}function me(e){return function t(){for(var r=this,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.length>=e.length?e.apply(this,s):function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return t.apply(r,[].concat(s,c))}}}function xe(e){return{}.toString.call(e).includes("Object")}function Un(e){return!Object.keys(e).length}function pe(e){return typeof e=="function"}function Hn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Kn(e,t){return xe(t)||q("changeType"),Object.keys(t).some(function(r){return!Hn(e,r)})&&q("changeField"),t}function Wn(e){pe(e)||q("selectorType")}function Vn(e){pe(e)||xe(e)||q("handlerType"),xe(e)&&Object.values(e).some(function(t){return!pe(t)})&&q("handlersType")}function Yn(e){e||q("initialIsRequired"),xe(e)||q("initialType"),Un(e)&&q("initialContent")}function Gn(e,t){throw new Error(e[t]||e.default)}var qn={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},q=me(Gn)(qn),Me={changes:Kn,selector:Wn,handler:Vn,initial:Yn};function Jn(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Me.initial(e),Me.handler(t);var r={current:e},n=me(Zn)(r,t),s=me(Xn)(r),i=me(Me.changes)(e),a=me(Qn)(r);function c(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(d){return d};return Me.selector(u),u(r.current)}function l(u){Bn(n,s,i,a)(u)}return[c,l]}function Qn(e,t){return pe(t)?t(e.current):t}function Xn(e,t){return e.current=Bt(Bt({},e.current),t),t}function Zn(e,t,r){return pe(t)?t(e.current):Object.keys(r).forEach(function(n){var s;return(s=t[n])===null||s===void 0?void 0:s.call(t,e.current[n])}),r}var Dn={create:Jn},es={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function ts(e){return function t(){for(var r=this,n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return s.length>=e.length?e.apply(this,s):function(){for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];return t.apply(r,[].concat(s,c))}}}function rs(e){return{}.toString.call(e).includes("Object")}function ns(e){return e||Ht("configIsRequired"),rs(e)||Ht("configType"),e.urls?(ss(),{paths:{vs:e.urls.monacoBase}}):e}function ss(){console.warn(Ut.deprecation)}function is(e,t){throw new Error(e[t]||e.default)}var Ut={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},Ht=ts(is)(Ut),as={config:ns},os=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return function(s){return r.reduceRight(function(i,a){return a(i)},s)}};function Kt(e,t){return Object.keys(t).forEach(function(r){t[r]instanceof Object&&e[r]&&Object.assign(t[r],Kt(e[r],t[r]))}),zt(zt({},e),t)}var cs={type:"cancelation",msg:"operation is manually canceled"};function Je(e){var t=!1,r=new Promise(function(n,s){e.then(function(i){return t?s(cs):n(i)}),e.catch(s)});return r.cancel=function(){return t=!0},r}var ls=Dn.create({config:es,isInitialized:!1,resolve:null,reject:null,monaco:null}),Wt=Nn(ls,2),ge=Wt[0],Oe=Wt[1];function us(e){var t=as.config(e),r=t.monaco,n=Rn(t,["monaco"]);Oe(function(s){return{config:Kt(s.config,n),monaco:r}})}function hs(){var e=ge(function(t){var r=t.monaco,n=t.isInitialized,s=t.resolve;return{monaco:r,isInitialized:n,resolve:s}});if(!e.isInitialized){if(Oe({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),Je(Qe);if(window.monaco&&window.monaco.editor)return Vt(window.monaco),e.resolve(window.monaco),Je(Qe);os(ds,ms)(ps)}return Je(Qe)}function ds(e){return document.body.appendChild(e)}function fs(e){var t=document.createElement("script");return e&&(t.src=e),t}function ms(e){var t=ge(function(n){var s=n.config,i=n.reject;return{config:s,reject:i}}),r=fs("".concat(t.config.paths.vs,"/loader.js"));return r.onload=function(){return e()},r.onerror=t.reject,r}function ps(){var e=ge(function(r){var n=r.config,s=r.resolve,i=r.reject;return{config:n,resolve:s,reject:i}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(r){Vt(r),e.resolve(r)},function(r){e.reject(r)})}function Vt(e){ge().monaco||Oe({monaco:e})}function gs(){return ge(function(e){var t=e.monaco;return t})}var Qe=new Promise(function(e,t){return Oe({resolve:e,reject:t})}),Yt={config:us,init:hs,__getMonacoInstance:gs};let ve,Xe;const Gt=new Set;async function qt(e){if(!e||!e.trim()||Gt.has(e))return;Gt.add(e);const t=`https://cdn.esm.sh/monaco-themes@0.4.2/themes/${e}.json`,r=await fetch(t).then(n=>n.json());ve.editor.defineTheme(e,r)}async function vs(e){ve||(e&&Yt.config({monaco:e}),Xe||(Xe=Yt.init().then(t=>{ve=t})),await Xe)}class ys extends Le.PureComponent{constructor(){super(...arguments);we(this,"ref",Le.createRef());we(this,"ed");we(this,"elems");we(this,"initState",0)}async initMonaco(){await vs(this.props.noCDN),await qt(this.props.theme),this.initState=2,this.ed=ve.editor.create(this.ref.current,{language:this.props.lang,value:this.props.value,readOnly:this.props.readonly??!1,theme:this.props.theme,...this.props.otherCfg}),this.ed.onDidChangeModelContent(()=>this.props.valOut?.(this.ed.getValue()))}componentDidMount(){this.initState!==1&&this.initMonaco(),this.initState=1,this.elems&&this.initState!==2&&(this.ref.current.innerHTML="",this.ref.current.append(...this.elems))}componentWillUnmount(){this.initState!==2?this.elems=Array.from(this.ref.current.children):this.ed?.dispose()}componentDidUpdate(t){if(this.initState===2){if(this.props.readonly!==t.readonly&&this.ed.updateOptions({readOnly:this.props.readonly}),this.props.value!==this.ed.getValue()&&this.ed.setValue(this.props.value),this.props.theme!==t.theme&&qt(this.props.theme).then(()=>this.ed.updateOptions({theme:this.props.theme})),this.props.lang!==t.lang){const r=this.ed.getModel();r&&(ve.editor.setModelLanguage(r,this.props.lang),this.ed.setModel(r))}this.props.otherCfg!==t.otherCfg&&this.props.otherCfg&&this.ed.updateOptions(this.props.otherCfg)}}render(){return w.default.createElement("div",{ref:this.ref,style:{width:this.props.width??"30rem",height:this.props.height??"10rem"}})}}const _s=e=>h.persist.store.quickCSS=e,Es=_.debounce(_s,250);var ws=()=>{const[e,t]=o.useState(h.persist.ghost.quickCSS);return o.createElement(W.ErrorBoundary,null,o.createElement("div",{style:{maxWidth:"60vw"}},o.createElement(ys,{value:e??"",valOut:r=>{t(r),Es(r)},lang:"css",theme:"Dracula",width:"",height:"20rem",otherCfg:{automaticLayout:!0}})))};async function bs(e){const t=new URL("repo.json",e).href,[r,n]=await ct(t);if(r!==200)throw new Error(`Repo manifest existed in cache with non-200 status ${r}`);if(!n.themes||n.themes?.length===0)throw new Error("No themes found in repo");if(!n.meta)throw new Error("No repo metadata");if(!n?.meta.name)throw new Error("Repo did not have a name");return n}var Ce=async e=>{const t=await bs(e),r=await Promise.all(t.themes.map(n=>ie(n,e)));return{manifest:t,themes:r}};const Jt=["https://cumcordthemes.github.io/Cumsock/"],Ss=Jt;var ks=async()=>{Array.isArray(h.persist.ghost.repos)||(h.persist.ghost.repos=[]);for(const e of Jt)if(!h.persist.ghost.repos.find(t=>t.url===e.url)){try{await Ce(e)}catch{continue}h.persist.ghost.repos.push(e)}h.persist.set({path:["repos"],value:h.persist.ghost.repos})},xs=({repo:e})=>{const[t,r]=o.useState(void 0);return o.useEffect(async()=>{t||r(await Ce(e))}),o.createElement("div",{className:"ysink_stain_card ysink_stain_row"},o.createElement("div",null,o.createElement("div",{className:"ysink_stain_title"},t?.manifest.meta.name,Ss.includes(e)?o.createElement(Tr.TextBadge,{className:"ysink_stain_officialbadge",text:"official repo",color:"var(--info-positive-foreground)"}):[]),o.createElement(fe,null,e)),o.createElement(Y,{color:Y.Colors.RED,className:"ysink_stain_button",onClick:()=>h.persist.store.repos=h.persist.ghost.repos.filter(n=>n!=e)},"Remove Repo"))};async function Ms(e){try{return await Ce(e),!0}catch{return!1}}async function Qt(e,t,r){return e.endsWith("/")||(e+="/"),h.persist.ghost.repos.includes(e)?(r("You already have this repo!"),!1):await Ms(e)?(h.persist.ghost.repos.push(e),h.persist.set({path:["repos"]}),t("Added repo"),!0):(r("Repo was invalid"),!1)}const Os=e=>h.persist.ghost.themes.some(t=>t.url===e);async function Cs(e,t,r){if(Os(e))return r("Theme is already installed!");const n=await ie(e).catch(r);!n||de(n).then(t,r)}const Xt=e=>je.showToast({title:e,duration:5e3});var Is=()=>{const[e,t]=o.useState("");return se.useNest(h.persist),o.createElement(W.ErrorBoundary,null,o.createElement(Be,null,o.createElement(Rr,{basis:"auto",grow:1,shrink:1,className:"ysink_stain_row"},o.createElement(dt,{placeholder:"https://example.com/repo",type:"text",value:e,onChange:r=>t(r)}),o.createElement(Y,{className:"ysink_stain_button",onClick:async()=>{await Qt(e,Xt,Xt)&&t("")}},"Add")),o.createElement("div",{className:"ysink_stain_divide"}),o.createElement("div",{className:"ysink_stain_cardcontainer"},h.persist.ghost.repos.map(r=>o.createElement(xs,{repo:r})))))};function D(){return D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},D.apply(this,arguments)}function As(e,t){if(e==null)return{};var r={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}var $s=["bottom","height","left","right","top","width"],Ts=function(t,r){return t===void 0&&(t={}),r===void 0&&(r={}),$s.some(function(n){return t[n]!==r[n]})},J=new Map,Zt,Rs=function e(){var t=[];J.forEach(function(r,n){var s=n.getBoundingClientRect();Ts(s,r.rect)&&(r.rect=s,t.push(r))}),t.forEach(function(r){r.callbacks.forEach(function(n){return n(r.rect)})}),Zt=window.requestAnimationFrame(e)};function Ns(e,t){return{observe:function(){var n=J.size===0;J.has(e)?J.get(e).callbacks.push(t):J.set(e,{rect:void 0,hasRectChanged:!1,callbacks:[t]}),n&&Rs()},unobserve:function(){var n=J.get(e);if(n){var s=n.callbacks.indexOf(t);s>=0&&n.callbacks.splice(s,1),n.callbacks.length||J.delete(e),J.size||cancelAnimationFrame(Zt)}}}}var Ie=typeof window!="undefined"?w.default.useLayoutEffect:w.default.useEffect;function js(e,t){t===void 0&&(t={width:0,height:0});var r=w.default.useState(e.current),n=r[0],s=r[1],i=w.default.useReducer(Ls,t),a=i[0],c=i[1],l=w.default.useRef(!1);return Ie(function(){e.current!==n&&s(e.current)}),Ie(function(){if(n&&!l.current){l.current=!0;var u=n.getBoundingClientRect();c({rect:u})}},[n]),w.default.useEffect(function(){if(!!n){var u=Ns(n,function(d){c({rect:d})});return u.observe(),function(){u.unobserve()}}},[n]),a}function Ls(e,t){var r=t.rect;return e.height!==r.height||e.width!==r.width?r:e}var zs=function(){return 50},Ps=function(t){return t},Fs=function(t,r){var n=r?"offsetWidth":"offsetHeight";return t[n]},Bs=function(t){for(var r=Math.max(t.start-t.overscan,0),n=Math.min(t.end+t.overscan,t.size-1),s=[],i=r;i<=n;i++)s.push(i);return s};function Us(e){var t,r=e.size,n=r===void 0?0:r,s=e.estimateSize,i=s===void 0?zs:s,a=e.overscan,c=a===void 0?1:a,l=e.paddingStart,u=l===void 0?0:l,d=e.paddingEnd,m=d===void 0?0:d,p=e.parentRef,g=e.horizontal,v=e.scrollToFn,x=e.useObserver,B=e.initialRect,I=e.onScrollElement,U=e.scrollOffsetFn,R=e.keyExtractor,te=R===void 0?Ps:R,Ae=e.measureSize,ce=Ae===void 0?Fs:Ae,k=e.rangeExtractor,$=k===void 0?Bs:k,N=g?"width":"height",re=g?"scrollLeft":"scrollTop",C=w.default.useRef({scrollOffset:0,measurements:[]}),H=w.default.useState(0),rr=H[0],M=H[1];C.current.scrollOffset=rr;var le=x||js,$e=le(p,B),ui=$e[N];C.current.outerSize=ui;var _e=w.default.useCallback(function(y){p.current&&(p.current[re]=y)},[p,re]),nr=v||_e;v=w.default.useCallback(function(y){nr(y,_e)},[_e,nr]);var sr=w.default.useState({}),ir=sr[0],Ze=sr[1],hi=w.default.useCallback(function(){return Ze({})},[]),Te=w.default.useRef([]),ue=w.default.useMemo(function(){var y=Te.current.length>0?Math.min.apply(Math,Te.current):0;Te.current=[];for(var S=C.current.measurements.slice(0,y),E=y;E<n;E++){var A=te(E),b=ir[A],K=S[E-1]?S[E-1].end:u,j=typeof b=="number"?b:i(E),L=K+j;S[E]={index:E,start:K,size:j,end:L,key:A}}return S},[i,ir,u,n,te]),ar=(((t=ue[n-1])==null?void 0:t.end)||u)+m;C.current.measurements=ue,C.current.totalSize=ar;var Ee=I?I.current:p.current,De=w.default.useRef(U);De.current=U,Ie(function(){if(!Ee){M(0);return}var y=function(E){var A=De.current?De.current(E):Ee[re];M(A)};return y(),Ee.addEventListener("scroll",y,{capture:!1,passive:!0}),function(){Ee.removeEventListener("scroll",y)}},[Ee,re]);var or=Ks(C.current),cr=or.start,lr=or.end,et=w.default.useMemo(function(){return $({start:cr,end:lr,overscan:c,size:ue.length})},[cr,lr,c,ue.length,$]),ur=w.default.useRef(ce);ur.current=ce;var di=w.default.useMemo(function(){for(var y=[],S=function(K,j){var L=et[K],Re=ue[L],ne=D(D({},Re),{},{measureRef:function(Ne){if(Ne){var nt=ur.current(Ne,g);if(nt!==ne.size){var dr=C.current.scrollOffset;ne.start<dr&&_e(dr+(nt-ne.size)),Te.current.push(L),Ze(function(mi){var st;return D(D({},mi),{},(st={},st[ne.key]=nt,st))})}}}});y.push(ne)},E=0,A=et.length;E<A;E++)S(E);return y},[et,_e,g,ue]),hr=w.default.useRef(!1);Ie(function(){hr.current&&Ze({}),hr.current=!0},[i]);var tt=w.default.useCallback(function(y,S){var E=S===void 0?{}:S,A=E.align,b=A===void 0?"start":A,K=C.current,j=K.scrollOffset,L=K.outerSize;b==="auto"&&(y<=j?b="start":y>=j+L?b="end":b="start"),b==="start"?v(y):b==="end"?v(y-L):b==="center"&&v(y-L/2)},[v]),rt=w.default.useCallback(function(y,S){var E=S===void 0?{}:S,A=E.align,b=A===void 0?"auto":A,K=As(E,["align"]),j=C.current,L=j.measurements,Re=j.scrollOffset,ne=j.outerSize,Q=L[Math.max(0,Math.min(y,n-1))];if(!!Q){if(b==="auto")if(Q.end>=Re+ne)b="end";else if(Q.start<=Re)b="start";else return;var Ne=b==="center"?Q.start+Q.size/2:b==="end"?Q.end:Q.start;tt(Ne,D({align:b},K))}},[tt,n]),fi=w.default.useCallback(function(){for(var y=arguments.length,S=new Array(y),E=0;E<y;E++)S[E]=arguments[E];rt.apply(void 0,S),requestAnimationFrame(function(){rt.apply(void 0,S)})},[rt]);return{virtualItems:di,totalSize:ar,scrollToOffset:tt,scrollToIndex:fi,measure:hi}}var Hs=function(t,r,n,s){for(;t<=r;){var i=(t+r)/2|0,a=n(i);if(a<s)t=i+1;else if(a>s)r=i-1;else return i}return t>0?t-1:0};function Ks(e){for(var t=e.measurements,r=e.outerSize,n=e.scrollOffset,s=t.length-1,i=function(u){return t[u].start},a=Hs(0,s,i,n),c=a;c<s&&t[c].end<n+r;)c++;return{start:a,end:c}}var Ws=({items:e,children:t,keySel:r,height:n,className:s})=>{const i=o.useRef(),a=Us({parentRef:i,size:e.length,keyExtractor:c=>r(e[c])});return o.createElement("div",{ref:i,style:{overflow:"auto",height:n},className:s},o.createElement("div",{style:{height:a.totalSize,width:"100%",position:"relative"}},a.virtualItems.map(c=>o.createElement("div",{ref:c.measureRef,key:c.key,style:{position:"absolute",top:0,left:0,width:"100%",height:c.height,transform:`translateY(${c.start}px)`}},t(e[c.index])))))};const Vs=()=>Promise.all(h.persist.ghost.repos.map(Ce)),Ys=async()=>(await Vs()).flatMap(e=>e.themes),Gs=(e,t)=>Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((r,n)=>r===t[n]);var qs=({goTo:e})=>{se.useNest(h.persist,!1,(d,{path:m})=>m[0]==="repos");const[t,r]=o.useState(""),[n,s]=o.useState([]),[i,a]=o.useState(void 0),[c,l]=o.useState(0);o.useEffect(()=>{(!Gs(n,h.persist.ghost.repos)||!i)&&(s(h.persist.ghost.repos),Ys().then(a))});const u=jt();return o.createElement(W.ErrorBoundary,null,o.createElement("div",{className:"ysink_stain_search_row"},o.createElement(Tt,{query:t,onChange:r}),o.createElement(Rt,{filterMode:c,setFilterMode:l})),h.persist.ghost.repos.length===0?o.createElement(Cn,{goToRepos:()=>e(2)}):o.createElement(Ws,{className:jr,height:"50rem",keySel:d=>d.url,items:$t(_.uniqBy(i??[],d=>d.url),t).filter(d=>c===0||c===1&&!d.compat||c===2&&d.compat)},d=>o.createElement(gt,{theme:d,deleteHook:u,gap:".5rem"})))},Js=()=>o.createElement(W.ErrorBoundary,null,o.createElement(Y,{className:"ysink_stain_button",onClick:Sr},"Clear fetch cache"),o.createElement(fe,null,"@ me if you need other things for debug purposes :)")),Qs=({items:e})=>{let[t,r]=o.useState(0);return o.createElement("div",{className:"ysink_stain_tabbar_root"},o.createElement("div",{className:"ysink_stain_tabbar"},e.map((n,s)=>o.createElement("button",{className:"ysink_stain_button"+(s===t?" ysink_stain_selected":""),onClick:()=>r(s)},o.createElement(fe,null,n.text)))),o.createElement("div",{className:"ysink_stain_divide"}),o.createElement("div",{className:"ysink_stain_tabbar_content"},o.createElement(e[t].component,{goTo:r})))},Xs=()=>o.createElement(W.ErrorBoundary,null,o.createElement(Be,null,o.createElement(ht,{tag:"h1"},"Cumstain Settings"),o.createElement(Qs,{items:[{text:"Installed",component:An},{text:"Store",component:qs},{text:"Repos",component:Is},{text:"Quick CSS",component:ws},{text:"Debug",component:Js}]}))),Zs=()=>fr.registerSection("ysink_stain","Themes",Xs),Ds=()=>{const e=P.injectCSS(h.persist.ghost.quickCSS),t=(r,{path:[n]})=>{n==="quickCSS"&&e(h.persist.ghost.quickCSS)};return h.persist.on("SET",t),()=>{e(),h.persist.off("SET",t)}};const ye=e=>h.persist.ghost.themes.find(t=>t.url===e),Dt=e=>!!ye(e)?.enabled,er=e=>Dt(e.url)?Mr(e):de(e),ei=async e=>await er(await ie(e)),ti=e=>lt(ye(e)),ri=async e=>{if(!ye(e))throw new Error(`Theme with ID ${e} was not installed`);Dt(e)?Fe(ye(e)):await er(ye(e))},ee=async()=>{if(!window.cumstain){ze.error("|| CUMSTAIN || API was not found, so nests could not be updated.");return}for(const e in cumstain.installed.ghost)delete cumstain.installed.ghost[e],cumstain.installed.delete(e);for(const e of h.persist.ghost.themes)cumstain.installed.store[e.url]={enabled:e.enabled,manifest:e};for(const[e,t]of Object.entries(cumstain.installed.ghost))t.enabled?cumstain.enabled.store[e]=t:(delete cumstain.enabled.ghost[e],cumstain.installed.delete(e))};var ni=()=>(window.cumstain={installed:V.nests.make({}),enabled:V.nests.make({}),importTheme:ei,removeTheme:ti,toggleTheme:ri},ee(),h.persist.on(V.nests.Events.UPDATE,ee),h.persist.on(V.nests.Events.SET,ee),h.persist.on(V.nests.Events.DELETE,ee),ze.log("|| CUMSTAIN || Initialised window.cumstain API"),()=>{h.persist.off(V.nests.Events.UPDATE,ee),h.persist.off(V.nests.Events.SET,ee),h.persist.off(V.nests.Events.DELETE,ee),window.cumstain=void 0,delete window.cumstain,ze.log("|| CUMSTAIN || Disposed window.cumstain API")});const tr="User confirmation declined";function si(e,{ok:t,error:r}){if(typeof e?.repo!="string")return r("You must supply a repo");ot.showConfirmationModal({type:"confirm",confirmText:"Add Repo",header:"[Cumstain] Add Repo?",content:`A web page or another app on your PC just tried to add the following theme repo: \`${e.repo}\`. Allow this?`}).then(n=>{n?Qt(e.repo,t,r).catch(s=>r("Unhandled error: "+s)):r(tr)})}function ii(e,{ok:t,error:r}){if(typeof e?.url!="string")return r("You must supply a theme url");ot.showConfirmationModal({type:"confirm",confirmText:"Install Theme",header:"[Cumstain] Install theme?",content:`A web page or another app on your PC just tried to install the following theme: \`${e.url}\`. Allow this?`}).then(n=>{n?Cs(e.url,t,r).catch(s=>r("Unhandled error: "+s)):r(tr)})}var ai=()=>[at.addHandler("ysink_stain_addrepo",si),at.addHandler("ysink_stain_addtheme",ii)],oi=()=>P.injectCSS(".ysink_stain_card{background:var(--background-secondary-alt);padding:1rem;border:1px solid var(--background-modifier-accent);border-radius:.5rem;width:100%!important;color:var(--text-normal)}.ysink_stain_title{display:flex;align-items:center;font-size:1rem;color:var(--interactive-active)}.ysink_stain_cardcontainer>*{margin-bottom:.5rem}.ysink_stain_divide{margin:.5rem 0;width:100%;height:1px;border-top:thin solid var(--background-modifier-accent)}.ysink_stain_row{display:flex;gap:1rem}.ysink_stain_row>:not(:last-child){flex:1}.ysink_stain_tabbar{padding:.5rem 1rem;display:grid;grid-auto-flow:column;grid-auto-columns:7rem}.ysink_stain_tabbar .ysink_stain_button *{cursor:pointer}.ysink_stain_tabbar>*{margin-right:1rem;padding:.2rem;border-radius:.3rem;min-width:5rem;text-align:center;background:none}.theme-dark .ysink_stain_tabbar>*.ysink_stain_selected{background:rgba(255,255,255,.2666666667)}.theme-light .ysink_stain_tabbar>*.ysink_stain_selected{background:rgba(0,0,0,.2)}.ysink_stain_tabbar>*:last-child{margin-right:0}.ysink_stain_searchbar{margin:.75rem 0}.ysink_stain_search_row{display:flex;gap:.75rem;margin:.75rem 0}.ysink_stain_search_row .ysink_stain_dropdown{height:2.25rem;flex-basis:10rem;padding-top:.3rem}.ysink_stain_search_row .ysink_stain_searchbar{margin:unset;flex:1}.ysink_stain_tcard{display:grid;grid-template-columns:auto 1fr min-content;grid-template-rows:auto 1fr;align-items:center}.ysink_stain_tcard .ysink_stain_tmedia{grid-row:1/3;height:4rem;width:7rem;margin-right:1rem;background-size:cover}.ysink_stain_tcard .ysink_stain_tmedia *{display:flex;justify-content:center;align-items:center;height:100%}.ysink_stain_tcard .ysink_stain_tmedia .ysink_stain_tview{z-index:1;transition:opacity .25s ease;backdrop-filter:brightness(.3);cursor:pointer}.ysink_stain_tcard .ysink_stain_tmedia .ysink_stain_tview:not(:hover){opacity:0}.ysink_stain_tcard .ysink_stain_tdesc{grid-area:2/2}.ysink_stain_tcard .ysink_stain_tacts{grid-column:3;justify-self:right}.ysink_stain_tcard .ysink_stain_tacts>:last-child{margin-left:.25rem}.ysink_stain_tcard .ysink_stain_tacts>*{display:inline-block}.ysink_stain_tcard .ysink_stain_taulic{text-align:right;min-width:8rem}.ysink_stain_iconbtn{margin-right:.25rem;fill:var(--interactive-normal);cursor:pointer;height:22px;width:22px}.ysink_stain_badge{width:1.5rem;height:1.5rem;margin-right:.5rem;border-radius:50%}.ysink_stain_badge.ysink_stain_bd{padding:.25rem;background:#040405}.ysink_stain_badge.ysink_stain_cc{padding:.1rem;background:#7289DA}.ysink_stain_cssedit{background:#1d1f21;color:#c5c8c6;border-radius:.3rem;font-family:var(--font-code);font-size:.9rem;line-height:1.1rem}.ysink_stain_nosplash{display:flex;flex-direction:column;align-items:center;margin-top:15rem;gap:.5rem}.ysink_stain_nosplash h2{margin-bottom:0}.ysink_stain_nosplash>*{flex:0}.ysink_stain_nosplash .ysink_stain_button{margin-top:2rem}.ysink_stain_officialbadge{display:inline;margin-left:.5rem}#ysink_stain_cumstain-tab{padding-bottom:0}");Array.isArray(h.persist.ghost.repos)||ks(),Array.isArray(h.persist.ghost.themes)||(h.persist.store.themes=[]);const ci=[Ds(),Cr(),ni(),...ai(),Zs(),oi()],li=()=>_.forEachRight(ci,e=>e());return z.onUnload=li,Object.defineProperty(z,"__esModule",{value:!0}),z})({},cumcord.pluginData,cumcord.patcher,cumcord.ui.userSettings,cumcord.modules.common.React,cumcord.utils,cumcord.ui.components,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.modules.common.React,cumcord.modules.internal,cumcord.utils.logger,cumcord.websocket,cumcord.ui.modals);
