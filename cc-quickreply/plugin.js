(function(c,o,i,d,l,N,u,P,I,q,C){"use strict";function T(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function A(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var a=A(P),f=T(C);const L=d.findByDisplayName("FormText"),w=d.findByDisplayName("Switch");d.findByDisplayName("TextInput"),d.findByDisplayName("Select",!1).SingleSelect;const F=e=>({display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:e!==void 0?"1rem":0}),p=({k:e,depends:t,children:n})=>f.default.createElement("div",{style:F(t)},f.default.createElement(w,{checked:o.persist.ghost[e],disabled:t!==void 0&&!o.persist.ghost[t],onChange:r=>o.persist.store[e]=r}),f.default.createElement(L,{children:n})),v=e=>t=>(I.useNest(o.persist),e(t));((e,t=o.persist)=>{for(const n in e)t.ghost[n]===void 0&&(t.store[n]=e[n])})({scroll:!0,scrollSmooth:!0});var x=v(()=>a.createElement(a.Fragment,null,a.createElement(p,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),a.createElement(p,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly")));const[{getChannel:M},{getMessages:k},j]=d.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")}),O=()=>M(u.getChannelId()),y=new Set;let s=-1,g=u.getChannelId(),m,h=Symbol("quickreply_deletePendingReply_int");function G(){if(!o.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(n=>n.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:o.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function Y(e,t,n,r){typeof r>"u"&&(r=e.guild_id!==null),l.FluxDispatcher._dispatch({type:i.ActionTypes.CREATE_PENDING_REPLY,channel:e,message:t,shouldMention:n,showMentionToggle:r}),setTimeout(G,100)}function E(e){l.FluxDispatcher._dispatch({type:i.ActionTypes.DELETE_PENDING_REPLY,channelId:u.getChannelId(),...e})}function _(e){g!==e.channelId&&(g=e.channelId,s=-1)}function D(e){m=e.message.id}function R(e){m=void 0,e[h]||(s=-1)}async function b(e){if(!e.ctrlKey&&!e.metaKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;const t=(await k(u.getChannelId())).toArray().reverse(),n=t.findIndex(r=>r.id===m)||0;if(e.key==="ArrowUp"?s=n+1:e.key==="ArrowDown"&&(s=n-1),s>t.length&&(s=t.length),s<0)return E();E({[h]:!0}),Y(O(),t[s],!y.has(u.getChannelId()))}let S;function U(){l.FluxDispatcher.subscribe(i.ActionTypes.CHANNEL_SELECT,_),l.FluxDispatcher.subscribe(i.ActionTypes.CREATE_PENDING_REPLY,D),l.FluxDispatcher.subscribe(i.ActionTypes.DELETE_PENDING_REPLY,R),window.addEventListener("keydown",b),S=N.before("setPendingReplyShouldMention",j,e=>{e[1]?y.delete(e[0]):y.add(e[0])})}function B(){l.FluxDispatcher.unsubscribe(i.ActionTypes.CHANNEL_SELECT,_),l.FluxDispatcher.unsubscribe(i.ActionTypes.CREATE_PENDING_REPLY,D),l.FluxDispatcher.unsubscribe(i.ActionTypes.DELETE_PENDING_REPLY,R),window.removeEventListener("keydown",b),S?.()}return c.onLoad=U,c.onUnload=B,c.settings=x,Object.defineProperty(c,"__esModule",{value:!0}),c})({},cumcord.pluginData,cumcord.modules.common.constants,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcord.utils,cumcord.plugins,cumcord.modules.common.React);
