(function(n,d,i,P){"use strict";const{getChannelId:l}=d.findByProps("getChannelId","getLastSelectedChannelId","getVoiceChannelId"),{getChannel:R}=d.findByProps("getChannel","getDMUserIds"),{getMessages:A}=d.findByProps("getRawMessages"),C=d.findByProps("setPendingReplyShouldMention"),o=new Set;let t=-1,y=l(),c,a=Symbol("quickreply_deletePendingReply_int");function I(){const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(s=>s.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:"smooth",block:"center"})}function L(){return R(l())}function N(e,u,s,r){typeof r=="undefined"&&(r=e.guild_id!==null),i.FluxDispatcher.dirtyDispatch({type:n.ActionTypes.CREATE_PENDING_REPLY,channel:e,message:u,shouldMention:s,showMentionToggle:r}),setTimeout(()=>{I()},100)}function p(e){i.FluxDispatcher.dirtyDispatch({type:n.ActionTypes.DELETE_PENDING_REPLY,channelId:l(),...e})}function g(e){y!==e.channelId&&(y=e.channelId,t=-1)}function E(e){c!==e.message.id&&(c=e.message.id)}function f(e){c=void 0,e[a]||(t=-1)}async function h(e){if(!e.ctrlKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;let s=(await A(l())).toArray().reverse(),r=s.findIndex(b=>b.id===c)||0;if(e.key==="ArrowUp"?t=r+1:e.key==="ArrowDown"&&(t=r-1),t>s.length&&(t=s.length),t<0)return p();let _=s[t];p({[a]:!0}),N(L(),_,!o.has(l()))}let D;var T={onLoad(){i.FluxDispatcher.subscribe(n.ActionTypes.CHANNEL_SELECT,g),i.FluxDispatcher.subscribe(n.ActionTypes.CREATE_PENDING_REPLY,E),i.FluxDispatcher.subscribe(n.ActionTypes.DELETE_PENDING_REPLY,f),window.addEventListener("keydown",h),D=P.before("setPendingReplyShouldMention",C,e=>{e[1]?o.delete(e[0]):o.add(e[0])})},onUnload(){i.FluxDispatcher.unsubscribe(n.ActionTypes.CHANNEL_SELECT,g),i.FluxDispatcher.unsubscribe(n.ActionTypes.CREATE_PENDING_REPLY,E),i.FluxDispatcher.unsubscribe(n.ActionTypes.DELETE_PENDING_REPLY,f),window.removeEventListener("keydown",h),D()}};return T})(cumcord.modules.common.constants,cumcord.modules.webpackModules,cumcord.modules.common,cumcord.patcher);
