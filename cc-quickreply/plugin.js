(function(d,s,o,p,i,P,u,A,D){"use strict";function L(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var l=L(A);const[T,I]=p.batchFind(({findByDisplayName:e})=>{e("FormText"),e("Switch")}),E=({k:e,depends:t,children:n})=>l.createElement("div",{style:{display:"flex",alignItems:"center",gap:".5rem",marginBottom:"1rem",marginLeft:t?"1rem":0}},l.createElement(I,{checked:s.persist.ghost[e],disabled:t&&!s.persist.ghost[t],onChange:r=>s.persist.store[e]=r}),l.createElement(T,null,n));var C=()=>(D.useNest(s.persist),l.createElement(l.Fragment,null,l.createElement(E,{k:"scroll"},"Scroll to keep the replying-to message on-screen"),l.createElement(E,{k:"scrollSmooth",depends:"scroll"},"Scroll smoothly")));const[{getChannel:R},{getMessages:S},v]=p.batchFind(({findByProps:e})=>{e("getDMUserIds"),e("getRawMessages"),e("setPendingReplyShouldMention")});s.persist.ghost.scroll??=!0,s.persist.ghost.scrollSmooth??=!0;const F=()=>R(u.getChannelId()),a=new Set;let c=-1,m=u.getChannelId(),h,y=Symbol("quickreply_deletePendingReply_int");function k(){if(!s.persist.ghost.scroll)return;const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(t=>t.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:s.persist.ghost.scrollSmooth?"smooth":void 0,block:"center"})}function M(e,t,n,r){typeof r=="undefined"&&(r=e.guild_id!==null),i.FluxDispatcher.dirtyDispatch({type:o.ActionTypes.CREATE_PENDING_REPLY,channel:e,message:t,shouldMention:n,showMentionToggle:r}),setTimeout(k,100)}function f(e){i.FluxDispatcher.dirtyDispatch({type:o.ActionTypes.DELETE_PENDING_REPLY,channelId:u.getChannelId(),...e})}function g(e){m!==e.channelId&&(m=e.channelId,c=-1)}function b(e){h=e.message.id}function _(e){h=void 0,e[y]||(c=-1)}async function N(e){if(!e.ctrlKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;const t=(await S(u.getChannelId())).toArray().reverse(),n=t.findIndex(r=>r.id===h)||0;if(e.key==="ArrowUp"?c=n+1:e.key==="ArrowDown"&&(c=n-1),c>t.length&&(c=t.length),c<0)return f();f({[y]:!0}),M(F(),t[c],!a.has(u.getChannelId()))}let w;function x(){i.FluxDispatcher.subscribe(o.ActionTypes.CHANNEL_SELECT,g),i.FluxDispatcher.subscribe(o.ActionTypes.CREATE_PENDING_REPLY,b),i.FluxDispatcher.subscribe(o.ActionTypes.DELETE_PENDING_REPLY,_),window.addEventListener("keydown",N),w=P.before("setPendingReplyShouldMention",v,e=>{e[1]?a.delete(e[0]):a.add(e[0])})}function O(){i.FluxDispatcher.unsubscribe(o.ActionTypes.CHANNEL_SELECT,g),i.FluxDispatcher.unsubscribe(o.ActionTypes.CREATE_PENDING_REPLY,b),i.FluxDispatcher.unsubscribe(o.ActionTypes.DELETE_PENDING_REPLY,_),window.removeEventListener("keydown",N),w?.()}return d.onLoad=x,d.onUnload=O,d.settings=C,Object.defineProperty(d,"__esModule",{value:!0}),d})({},cumcord.pluginData,cumcord.modules.common.constants,cumcord.modules.webpack,cumcord.modules.common,cumcord.patcher,cumcord.modules.common.channels,cumcord.modules.common.React,cumcord.utils);
