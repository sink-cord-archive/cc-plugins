(function(n,l,i,P){"use strict";const{getChannelId:s}=l.findByProps("getChannelId","getLastSelectedChannelId","getVoiceChannelId"),{getChannel:A}=l.findByProps("getChannel","getDMUserIds"),{getMessages:L}=l.findByProps("getRawMessages"),N=l.findByProps("setPendingReplyShouldMention"),u=new Set;let t=-1,a=s(),o,E=Symbol("quickreply_deletePendingReply_int");function T(){const e=document.querySelector('[data-list-id="chat-messages"]');Array.from(e.children).find(r=>r.firstChild?.className?.includes("replying-"))?.scrollIntoView({behavior:"smooth",block:"center"})}function _(){return A(s())}function I(e,r,c,d){typeof d=="undefined"&&(d=e.guild_id!==null),i.FluxDispatcher.dirtyDispatch({type:n.ActionTypes.CREATE_PENDING_REPLY,channel:e,message:r,shouldMention:c,showMentionToggle:d}),setTimeout(()=>{T()},100)}function y(e){i.FluxDispatcher.dirtyDispatch({type:n.ActionTypes.DELETE_PENDING_REPLY,channelId:s(),...e})}function h(e){a!==e.channelId&&(a=e.channelId,t=-1)}function p(e){o!==e.message.id&&(o=e.message.id)}function g(e){o=void 0,e[E]||(t=-1)}async function f(e){if(!e.ctrlKey||e.key!=="ArrowUp"&&e.key!=="ArrowDown")return;let r=(await L(s())).toArray().reverse(),c=r.findIndex(w=>w.id===o)||0;if(e.key==="ArrowUp"?t=c+1:e.key==="ArrowDown"&&(t=c-1),t>r.length&&(t=r.length),t<0)return y();let d=r[t];y({[E]:!0}),I(_(),d,!u.has(s()))}let D;var b={onLoad(){i.FluxDispatcher.subscribe(n.ActionTypes.CHANNEL_SELECT,h),i.FluxDispatcher.subscribe(n.ActionTypes.CREATE_PENDING_REPLY,p),i.FluxDispatcher.subscribe(n.ActionTypes.DELETE_PENDING_REPLY,g),window.addEventListener("keydown",f),D=P.before("setPendingReplyShouldMention",N,e=>{e[1]?u.delete(e[0]):u.add(e[0])})},onUnload(){i.FluxDispatcher.unsubscribe(n.ActionTypes.CHANNEL_SELECT,h),i.FluxDispatcher.unsubscribe(n.ActionTypes.CREATE_PENDING_REPLY,p),i.FluxDispatcher.unsubscribe(n.ActionTypes.DELETE_PENDING_REPLY,g),window.removeEventListener("keydown",f),D()}};return b})(cumcord.modules.common.constants,cumcord.modules.webpackModules,cumcord.modules.common,cumcord.patcher);
