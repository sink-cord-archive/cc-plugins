(function(s,c,u,g,o){"use strict";var h=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const M=s.findByProps("uploadEmoji"),{getGuildPermissions:_}=s.findByProps("getGuildPermissions"),C=s.findByProps("getFlattenedGuilds").getFlattenedGuilds,R=BigInt(1073741824),x=a=>{let t=_({id:a});return!!(t&&(t&R)!=0)},B=()=>C().filter(a=>x(a.id)),j=a=>new Promise((t,n)=>{let e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(a)}),N=async a=>await j(await(await fetch(a)).blob()),m=(a,t,n)=>{N(t).then(e=>M.uploadEmoji(a,e,n))},P=o.React.useState,{openModal:S}=s.findByProps("openModal"),i=s.findByProps("ModalCloseButton"),l=s.findByDisplayName("Flex"),p=s.findByDisplayName("Header"),I=s.findByDisplayName("FormSection"),w=s.findByDisplayName("FormText"),F=s.findByDisplayName("TextInput"),G=s.findByProps("Sizes","Colors","Looks","DropdownSizes"),T=({guildId:a,emoteUrl:t,e:n})=>{const[e,r]=P("");return o.React.createElement(g.ErrorBoundary,null,o.React.createElement(i.ModalRoot,{transitionState:n.transitionState,size:"small",className:"ysink_emote_modal"},o.React.createElement(i.ModalHeader,{separator:!1},o.React.createElement(l.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},o.React.createElement(p,{tag:"h2",size:p.Sizes.SIZE_20},"Create Emote")),o.React.createElement(l.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},o.React.createElement(i.ModalCloseButton,{onClick:n.onClose}))),o.React.createElement(i.ModalContent,null,o.React.createElement(I,null,o.React.createElement("div",{className:"ysink_emote_row"},o.React.createElement(w,null,"You are now creating an emote for the following image:"),o.React.createElement("img",{src:t,height:"70"})),o.React.createElement(l,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},o.React.createElement(F,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:e,onChange:d=>r(d)}),o.React.createElement(G,{className:"ysink_emote_button",onClick:()=>{m(a,t,e),u.showToast({title:`created emote ${e}`,duration:3e3}),n.onClose()}},"Create Emote!"))))))};var k=(a,t)=>S(n=>o.React.createElement(T,{guildId:a,emoteUrl:t,e:n}));const f=s.findByProps("MenuGroup","default");var y=({isEmote:a,emoteAlt:t,url:n})=>o.React.createElement(f.MenuItem,{id:"ysink_emoji_msgitem",label:a?`Clone Emote ${t}`:"Create Emote"},B().map(e=>o.React.createElement(f.MenuItem,{label:e.name,id:`ysink_emoji_server_${e.id}`,action:()=>{let r=t?.substring(1,t.length-1);a?(m(e.id,n,r),u.showToast({title:`cloned emote ${r}`,duration:3e3})):k(e.id,n)}})));const v=s.findByProps("MenuGroup","default");var $=()=>{const a=s.find(t=>t?.default?.displayName=="MessageContextMenu");return c.after("default",a,(t,n)=>{let e=t[0].target,r=!!e?.classList?.contains("emoji");if(!(!e||!n?.props?.children||!r&&e?.nodeName!="IMG"||e.alt.length<=2))return n.props.children.splice(3,0,o.React.createElement(v.MenuSeparator,null),y({isEmote:r,emoteAlt:e.alt,url:e.currentSrc})),n})};const D=s.findByProps("MenuGroup","default"),E=s.findByProps("openContextMenu");var z=()=>{const a=s.find(t=>t?.default?.displayName=="EmojiPickerListRow");return c.after("default",a,(t,n)=>{if(console.log(n),!Array.isArray(n?.props?.children))return n;for(const e of n.props.children){if(!e||!e?.props?.children)continue;let r=e.props.children.props.emoji;e.props.onContextMenu=d=>{let A=r.managed?`https://discord.com${r.url}`:r.url;E.openContextMenu(d,()=>o.React.createElement(D.default,{onClose:E.closeContextMenu},y({isEmote:!0,emoteAlt:`:${r.name}:`,url:A})))}}})},L=a=>{let t=[];return{onLoad:()=>t.push(h(),$(),z()),onUnload:()=>t.forEach(n=>n())}};return L})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.ui.components,cumcord.modules.common);
