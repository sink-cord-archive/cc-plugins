(function(r,a,m,i){"use strict";var c=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const p=r.findByProps("uploadEmoji"),{getGuildPermissions:f}=r.findByProps("getGuildPermissions"),M=r.findByProps("getFlattenedGuilds").getFlattenedGuilds,g=BigInt(1073741824),h=o=>{let t=f({id:o});return!!(t&&(t&g)!=0)},y=()=>M().filter(o=>h(o.id)),_=o=>new Promise((t,n)=>{let e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(o)}),E=async o=>await _(await(await fetch(o)).blob()),j=(o,t,n)=>{E(t).then(e=>p.uploadEmoji(o,e,n))},l=r.findByProps("MenuGroup","default");var d=({isEmote:o,emoteAlt:t,url:n})=>i.React.createElement(l.MenuItem,{id:"ysink_emoji_msgitem",label:o?`Clone Emote ${t}`:"Create Emote"},y().map(e=>i.React.createElement(l.MenuItem,{label:e.name,id:`ysink_emoji_server_${e.id}`,action:()=>{let s=t?.substring(1,t.length-1);o?(j(e.id,n,s),m.showToast({title:`cloned emote ${s}`,duration:3e3})):showCreateModal(e.id,n)}})));const C=r.findByProps("MenuGroup","default");var x=()=>{const o=r.find(t=>t?.default?.displayName=="MessageContextMenu");return a.after("default",o,(t,n)=>{let e=t[0].target,s=!!e?.classList?.contains("emoji");if(!(!e||!n?.props?.children||!s&&e?.nodeName!="IMG"||e.alt.length<=2))return n.props.children.splice(3,0,i.React.createElement(C.MenuSeparator,null),d({isEmote:s,emoteAlt:e.alt,url:e.sourceUrl})),n})};const P=r.findByProps("MenuGroup","default"),u=r.findByProps("openContextMenu");var G=()=>{const o=r.find(t=>t?.default?.displayName=="EmojiPickerListRow");return a.after("default",o,(t,n)=>{if(console.log(n),!Array.isArray(n?.props?.children))return n;for(const e of n.props.children){if(!e||!e?.props?.children)continue;let s=e.props.children.props.emoji;e.props.onContextMenu=B=>{let I=s.managed?`https://discord.com${s.url}`:s.url;u.openContextMenu(B,()=>i.React.createElement(P.default,{onClose:u.closeContextMenu},d({isEmote:!0,emoteAlt:`:${s.name}:`,url:I})))}}})},R=o=>{let t=[];return{onLoad:()=>t.push(c(),x(),G()),onUnload:()=>t.forEach(n=>n())}};return R})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.modules.common);
