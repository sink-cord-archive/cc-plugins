(function(l,P,i,f,x,S){"use strict";function v(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var o=v(P),$=()=>l.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const j=i.findByProps("uploadEmoji"),{getGuildPermissions:N}=i.findByProps("getGuildPermissions"),{getGuilds:z}=i.findByProps("getGuilds"),w=BigInt(1073741824),b=n=>{let e=N({id:n});return!!(e&&(e&w)!==0n)},D=()=>Object.values(z()).filter(n=>b(n.id)),I=n=>new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.readAsDataURL(n)}),R=async n=>await I(await(await fetch(n)).blob()),h=(n,e,t)=>{R(e).then(r=>j.uploadEmoji(n,r,t))},{openModal:k}=i.findByProps("openModalLazy"),s=i.findByProps("ModalCloseButton"),p=i.findByDisplayName("Flex"),g=i.findByProps("Sizes","Tags"),G=i.findByDisplayName("FormSection"),L=i.findByDisplayName("FormText"),O=i.findByDisplayName("TextInput"),T=i.findByProps("Sizes","Colors","Looks","DropdownSizes"),A=({guildId:n,emoteUrl:e,e:t})=>{const[r,a]=o.useState("");return o.createElement(S.ErrorBoundary,null,o.createElement(s.ModalRoot,{transitionState:t.transitionState,size:"small",className:"ysink_emote_modal"},o.createElement(s.ModalHeader,{separator:!1},o.createElement(p.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},o.createElement(g,{tag:"h2",size:g.Sizes.SIZE_20},"Create Emote")),o.createElement(p.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},o.createElement(s.ModalCloseButton,{onClick:t.onClose}))),o.createElement(s.ModalContent,null,o.createElement(G,null,o.createElement("div",{className:"ysink_emote_row"},o.createElement(L,null,"You are now creating an emote for the following image:"),o.createElement("img",{src:e,height:"70"})),o.createElement(p,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},o.createElement(O,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:r,onChange:c=>a(c)}),o.createElement(T,{className:"ysink_emote_button",onClick:()=>{h(n,e,r),f.showToast({title:`created emote ${r}`,duration:3e3}),t.onClose()}},"Create Emote!"))))))};var F=(n,e)=>k(t=>o.createElement(A,{guildId:n,emoteUrl:e,e:t}));const y=i.findByProps("MenuGroup","default");var E=({isEmote:n,emoteAlt:e,url:t})=>o.createElement(o.Fragment,null,o.createElement(y.MenuItem,{id:"ysink_emoji_msgitem",label:n?`Clone Emote ${e}`:"Create Emote"},D().map(r=>o.createElement(y.MenuItem,{label:r.name,id:`ysink_emoji_server_${r.id}`,action:()=>{let a=e?.substring(1,e.length-1);n?(h(r.id,t,a),f.showToast({title:`cloned emote ${a}`,duration:3e3})):F(r.id,t)}}))),o.createElement(y.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{let r=e?.substring(1,e.length-1);x.copyText(t),f.showToast({title:`Copied url for ${r}`,duration:3e3})}}));let m=[];const C=n=>(e,t)=>{const r=Symbol();let a=!1;const c=i.findByDisplayName(e,!1);if(c!=null)m.push([r,t(c)]);else{const u=l.before(n,i.findByProps(n),d=>{const J=d[1];return d[1]=async()=>{const K=await J(d[0]);return Q=>{const B=K(Q);return B?.type?.displayName===e&&t&&(u(),a||m.push([r,t(i.findByDisplayName(e,!1))]),t=!1),B}},d})}return()=>{m=m.filter(u=>u[0]===r?(u[1](),!1):!0),a=!0}},U=C("openContextMenuLazy");var M={patch:(n,e,t)=>C(n)(e,t),patchContextMenu:U};const H=i.findByProps("MenuGroup","default");var Y=()=>M.patchContextMenu("MessageContextMenu",n=>l.after("default",n,([{target:e}],t)=>{let r=!!e?.classList?.contains("emoji");if(!(!e||!t?.props?.children||!r&&e?.nodeName!="IMG"||r&&e.alt.length<=2))return t.props.children.splice(3,0,o.createElement(H.MenuSeparator,null),E({isEmote:r,emoteAlt:e.alt,url:e.currentSrc})),t})),Z=()=>M.patchContextMenu("ExpressionPickerContextMenu",n=>l.after("default",n,([{target:e}],t)=>(e.firstChild.currentSrc&&(Array.isArray(t.props.children.props.children)||(t.props.children.props.children=[t.props.children.props.children]),t.props.children.props.children.push(E({isEmote:!0,emoteAlt:`:${e.dataset.name}:`,url:e.firstChild.currentSrc}))),t))),q=n=>{let e=[$(),Y(),Z()];return{onUnload:()=>_.forEachRight(e,t=>t())}};return q})(cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
