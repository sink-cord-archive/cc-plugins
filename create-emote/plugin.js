(function(a,B,s,p,P,S){"use strict";function N(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var o=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,o.get?o:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,Object.freeze(e)}var r=N(B),j=()=>a.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const v=s.findByProps("uploadEmoji"),{getGuildPermissions:w}=s.findByProps("getGuildPermissions"),{getGuilds:I}=s.findByProps("getGuilds"),z=BigInt(1073741824),T=n=>{let e=w({id:n});return!!(e&&(e&z)!==0n)},R=()=>Object.values(I()).filter(n=>T(n.id)),b=n=>new Promise((e,t)=>{let o=new FileReader;o.onloadend=()=>e(o.result),o.readAsDataURL(n)}),D=async n=>await b(await(await fetch(n)).blob()),h=(n,e,t)=>{D(e).then(o=>v.uploadEmoji(n,o,t))},{openModal:F}=s.findByProps("openModalLazy"),l=s.findByProps("ModalCloseButton"),f=s.findByDisplayName("Flex"),E=s.findByProps("Sizes","Tags"),O=s.findByDisplayName("FormSection"),k=s.findByDisplayName("FormText"),G=s.findByDisplayName("TextInput"),$=s.findByProps("Sizes","Colors","Looks","DropdownSizes"),L=({guildId:n,emoteUrl:e,e:t})=>{const[o,i]=r.useState("");return r.createElement(S.ErrorBoundary,null,r.createElement(l.ModalRoot,{transitionState:t.transitionState,size:"small",className:"ysink_emote_modal"},r.createElement(l.ModalHeader,{separator:!1},r.createElement(f.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},r.createElement(E,{tag:"h2",size:E.Sizes.SIZE_20},"Create Emote")),r.createElement(f.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},r.createElement(l.ModalCloseButton,{onClick:t.onClose}))),r.createElement(l.ModalContent,null,r.createElement(O,null,r.createElement("div",{className:"ysink_emote_row"},r.createElement(k,null,"You are now creating an emote for the following image:"),r.createElement("img",{src:e,height:"70"})),r.createElement(f,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},r.createElement(G,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:o,onChange:m=>i(m)}),r.createElement($,{className:"ysink_emote_button",onClick:()=>{h(n,e,o),p.showToast({title:`created emote ${o}`,duration:3e3}),t.onClose()}},"Create Emote!"))))))};var A=(n,e)=>F(t=>r.createElement(L,{guildId:n,emoteUrl:e,e:t}));const y=s.findByProps("MenuGroup","default");var C=({isEmote:n,emoteAlt:e,url:t})=>r.createElement(r.Fragment,null,r.createElement(y.MenuItem,{id:"ysink_emoji_msgitem",label:n?`Clone Emote ${e}`:"Create Emote"},R().map(o=>r.createElement(y.MenuItem,{label:o.name,id:`ysink_emoji_server_${o.id}`,action:()=>{let i=e?.substring(1,e.length-1);n?(h(o.id,t,i),p.showToast({title:`cloned emote ${i}`,duration:3e3})):A(o.id,t)}}))),r.createElement(y.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{let o=e?.substring(1,e.length-1);P.copyText(t),p.showToast({title:`Copied url for ${o}`,duration:3e3})}}));let c=[];const M=n=>(e,t)=>{const o=Symbol();let i=!1;const m=s.findByDisplayName(e,!1);if(m!=null)c.push([o,t(m)]);else{const u=a.before(n,s.findByProps(n),d=>{const J=d[1];return d[1]=async()=>{const K=await J(d[0]);return Q=>{const x=K(Q);return x?.type?.displayName===e&&t&&(u(),i||c.push([o,t(s.findByDisplayName(e,!1))]),t=!1),x}},d})}return()=>{c=c.filter(u=>u[0]===o?(u[1](),!1):!0),i=!0}},U=M("openContextMenuLazy");var g={patch:(n,e,t)=>M(n)(e,t),patchContextMenu:U};const H=s.findByProps("MenuGroup","default");var Y=()=>g.patchContextMenu("MessageContextMenu",n=>a.after("default",n,([{target:e}],t)=>{let o=!!e?.classList?.contains("emoji");if(!(!e||!t?.props?.children||!o&&e?.nodeName!="IMG"||o&&e.alt.length<=2))return t.props.children.splice(3,0,r.createElement(H.MenuSeparator,null),C({isEmote:o,emoteAlt:e.alt,url:e.currentSrc})),t})),Z=()=>g.patchContextMenu("ExpressionPickerContextMenu",n=>a.after("default",n,([{target:e}],t)=>(e.firstChild.currentSrc&&(Array.isArray(t.props.children.props.children)||(t.props.children.props.children=[t.props.children.props.children]),t.props.children.props.children.push(C({isEmote:!0,emoteAlt:`:${e.dataset.name}:`,url:e.firstChild.currentSrc}))),t))),q=n=>{let e=[j(),Y(),Z()];return{onUnload:()=>_.forEachRight(e,t=>t())}};return q})(cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
