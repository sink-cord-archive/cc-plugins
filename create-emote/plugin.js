(function(r,m,p,x,B,s){"use strict";var P=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const S=r.findByProps("uploadEmoji"),{getGuildPermissions:N}=r.findByProps("getGuildPermissions"),{getGuilds:I}=r.findByProps("getGuilds"),j=BigInt(1073741824),w=n=>{let e=N({id:n});return!!(e&&(e&j)!==0n)},T=()=>Object.values(I()).filter(n=>w(n.id)),v=n=>new Promise((e,t)=>{let a=new FileReader;a.onloadend=()=>e(a.result),a.readAsDataURL(n)}),z=async n=>await v(await(await fetch(n)).blob()),h=(n,e,t)=>{z(e).then(a=>S.uploadEmoji(n,a,t))},{openModal:k}=r.findByProps("openModalLazy"),i=r.findByProps("ModalCloseButton"),f=r.findByDisplayName("Flex"),E=r.findByProps("Sizes","Tags"),F=r.findByDisplayName("FormSection"),D=r.findByDisplayName("FormText"),G=r.findByDisplayName("TextInput"),$=r.findByProps("Sizes","Colors","Looks","DropdownSizes"),L=({guildId:n,emoteUrl:e,e:t})=>{const[a,o]=s.React.useState("");return s.React.createElement(B.ErrorBoundary,null,s.React.createElement(i.ModalRoot,{transitionState:t.transitionState,size:"small",className:"ysink_emote_modal"},s.React.createElement(i.ModalHeader,{separator:!1},s.React.createElement(f.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},s.React.createElement(E,{tag:"h2",size:E.Sizes.SIZE_20},"Create Emote")),s.React.createElement(f.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},s.React.createElement(i.ModalCloseButton,{onClick:t.onClose}))),s.React.createElement(i.ModalContent,null,s.React.createElement(F,null,s.React.createElement("div",{className:"ysink_emote_row"},s.React.createElement(D,null,"You are now creating an emote for the following image:"),s.React.createElement("img",{src:e,height:"70"})),s.React.createElement(f,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},s.React.createElement(G,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:a,onChange:c=>o(c)}),s.React.createElement($,{className:"ysink_emote_button",onClick:()=>{h(n,e,a),p.showToast({title:`created emote ${a}`,duration:3e3}),t.onClose()}},"Create Emote!"))))))};var b=(n,e)=>k(t=>s.React.createElement(L,{guildId:n,emoteUrl:e,e:t}));const y=r.findByProps("MenuGroup","default");var C=({isEmote:n,emoteAlt:e,url:t})=>s.React.createElement(s.React.Fragment,null,s.React.createElement(y.MenuItem,{id:"ysink_emoji_msgitem",label:n?`Clone Emote ${e}`:"Create Emote"},T().map(a=>s.React.createElement(y.MenuItem,{label:a.name,id:`ysink_emoji_server_${a.id}`,action:()=>{let o=e?.substring(1,e.length-1);n?(h(a.id,t,o),p.showToast({title:`cloned emote ${o}`,duration:3e3})):b(a.id,t)}}))),s.React.createElement(y.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{let a=e?.substring(1,e.length-1);x.copyText(t),p.showToast({title:`Copied url for ${a}`,duration:3e3})}}));let l=[];const M=n=>(e,t)=>{const a=Symbol();let o=!1;const c=r.findByDisplayName(e,!1);if(c!=null)l.push([a,t(c)]);else{const d=m.before(n,r.findByProps(n),u=>{const Z=u[1];return u[1]=async()=>{const q=await Z(u[0]);return J=>{const g=q(J);return g?.type?.displayName===e&&t&&(d(),o||l.push([a,t(r.findByDisplayName(e,!1))]),t=!1),g}},u})}return()=>{l=l.filter(d=>d[0]===a?(d[1](),!1):!0),o=!0}},A=M("openContextMenuLazy");var R={patch:(n,e,t)=>M(n)(e,t),patchContextMenu:A};const O=r.findByProps("MenuGroup","default");var U=()=>R.patchContextMenu("MessageContextMenu",n=>m.after("default",n,([{target:e}],t)=>{let a=!!e?.classList?.contains("emoji");if(!(!e||!t?.props?.children||!a&&e?.nodeName!="IMG"||a&&e.alt.length<=2))return t.props.children.splice(3,0,s.React.createElement(O.MenuSeparator,null),C({isEmote:a,emoteAlt:e.alt,url:e.currentSrc})),t})),H=()=>R.patchContextMenu("ExpressionPickerContextMenu",n=>m.after("default",n,([{target:e}],t)=>(e.firstChild.currentSrc&&(Array.isArray(t.props.children.props.children)||(t.props.children.props.children=[t.props.children.props.children]),t.props.children.props.children.push(C({isEmote:!0,emoteAlt:`:${e.dataset.name}:`,url:e.firstChild.currentSrc}))),t))),Y=n=>{let e=[P(),U(),H()];return{onUnload:()=>_.forEachRight(e,t=>t())}};return Y})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components,cumcord.modules.common);
