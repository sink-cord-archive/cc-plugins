(function(i,a,h,s,m,p,E){"use strict";function C(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var o=C(h),b=()=>a.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row:last-child>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row:last-child>:last-child{flex:unset;margin-right:unset}");const[w,{getGuildPermissions:k},{getGuilds:M},{openModal:S},c,{ModalRoot:j,ModalHeader:x,ModalContent:v,ModalCloseButton:I},d,u,N,B,P,T]=s.batchFind(({findByProps:e,findByDisplayName:t})=>{e("uploadEmoji"),e("getGuildPermissions"),e("getGuilds"),e("openModalLazy"),e("MenuGroup","default"),e("ModalCloseButton"),t("Flex"),e("Sizes","Tags"),t("FormSection"),t("FormText"),t("TextInput"),e("BorderColors")}),$=BigInt(1073741824),F=e=>{let t=k({id:e});return!!(t&&(t&$)!==0n)},A=()=>Object.values(M()).filter(e=>F(e.id)),O=e=>new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}),z=async e=>await O(await(await fetch(e)).blob()),g=(e,t,r)=>{z(t).then(n=>w.uploadEmoji(e,n,r))},G=({guildId:e,emoteUrl:t,e:r})=>{const[n,l]=o.useState("");return o.createElement(E.ErrorBoundary,null,o.createElement(j,{transitionState:r.transitionState,size:"small",className:"ysink_emote_modal"},o.createElement(x,{separator:!1},o.createElement(d.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},o.createElement(u,{tag:"h2",size:u.Sizes.SIZE_20},"Create Emote")),o.createElement(d.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},o.createElement(I,{onClick:r.onClose}))),o.createElement(v,null,o.createElement(N,null,o.createElement("div",{className:"ysink_emote_row"},o.createElement(B,null,"You are now creating an emote for the following image:"),o.createElement("img",{src:t,height:"70"})),o.createElement(d,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},o.createElement(P,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:n,onChange:l}),o.createElement(T,{className:"ysink_emote_button",onClick:()=>{g(e,t,n),m.showToast({title:`created emote ${n}`,duration:3e3}),r.onClose()}},"Create Emote!"))))))};var R=(e,t)=>S(r=>o.createElement(G,{guildId:e,emoteUrl:t,e:r}));const f=e=>e?.substring(1,e.length-1);var y=({isEmote:e,emoteAlt:t,url:r})=>o.createElement(o.Fragment,null,o.createElement(c.MenuItem,{id:"ysink_emoji_msgitem",label:e?`Clone Emote ${t}`:"Create Emote"},A().map(n=>o.createElement(MenuItem,{label:n.name,id:`ysink_emoji_server_${n.id}`,action:()=>{if(e){const l=f(t);g(n.id,r,l),m.showToast({title:`cloned emote ${l}`,duration:3e3})}else R(n.id,r)}}))),o.createElement(c.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{p.copyText(r),m.showToast({title:`Copied url for ${f(t)}`,duration:3e3})}})),U=()=>a.findAndPatch(()=>s.findByDisplayName("MessageContextMenu",!1),e=>a.after("default",e,([{target:t}],r)=>{debugger;const n=t?.classList?.contains("emoji");if(!n&&t?.nodeName!=="IMG"&&(t=t?.nextSibling?.firstChild),!(!t||!r?.props?.children||!n&&t?.nodeName!="IMG"||n&&t.alt.length<=2))return r.props.children.splice(3,0,o.createElement(c.MenuSeparator,null),y({isEmote:n,emoteAlt:t.alt,url:t.currentSrc})),r})),D=()=>a.findAndPatch(()=>s.findByDisplayName("ExpressionPickerContextMenu",!1),e=>a.after("default",e,([{target:t}],r)=>{if(!t.firstChild.currentSrc)return;const n=r.props.children.props;return Array.isArray(n.children)||(n.children=[n.children]),n.children.push(y({isEmote:!0,emoteAlt:`:${t.dataset.name}:`,url:t.firstChild.currentSrc})),r}));const L=[b(),U(),D()],H=()=>_.forEachRight(L,e=>e());return i.onUnload=H,Object.defineProperty(i,"__esModule",{value:!0}),i})({},cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
