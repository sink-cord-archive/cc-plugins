(function(s,l,C,c,m,d,M){"use strict";function b(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(o){if(o!=="default"){var n=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(t,o,n.get?n:{enumerable:!0,get:function(){return e[o]}})}}),t.default=e,Object.freeze(t)}var a=b(C),g=()=>l.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row:last-child>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row:last-child>:last-child{flex:unset;margin-right:unset}");const[y,{getGuildPermissions:w},{getGuilds:k},{openModal:S},i,{ModalRoot:j,ModalHeader:x,ModalContent:I,ModalCloseButton:v},u,h,T,N,O,F]=c.batchFind(({findByProps:e,findByDisplayName:t})=>{e("uploadEmoji"),e("getGuildPermissions"),e("getGuilds"),e("openModalLazy"),e("MenuGroup","default"),e("ModalCloseButton"),t("Flex"),e("Sizes","Tags"),t("FormSection"),t("FormText"),t("TextInput"),e("BorderColors")}),R=1073741824n,A=e=>{const t=w({id:e});return t&&(t&R)!==0n},G=()=>Object.values(k()).filter(e=>A(e.id)),z=e=>new Promise(async t=>{const o=await(await fetch(e)).blob(),n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(o)}),E=(e,t,o)=>z(t.replace("media.discordapp.net","cdn.discordapp.com")).then(n=>y.uploadEmoji({guildId:e,image:n,name:o})),P=({guildId:e,emoteUrl:t,e:o})=>{const[n,r]=a.useState("");return a.createElement(M.ErrorBoundary,null,a.createElement(j,{transitionState:o.transitionState,size:"small",className:"ysink_emote_modal"},a.createElement(x,{separator:!1},a.createElement(u.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},a.createElement(h,{tag:"h2",size:h.Sizes.SIZE_20},"Create Emote")),a.createElement(u.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},a.createElement(v,{onClick:o.onClose}))),a.createElement(I,null,a.createElement(T,null,a.createElement("div",{className:"ysink_emote_row"},a.createElement(N,null,"You are now creating an emote for the following image:"),a.createElement("img",{src:t,height:"70"})),a.createElement(u,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},a.createElement(O,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:n,onChange:r}),a.createElement(F,{className:"ysink_emote_button",onClick:()=>{E(e,t,n),m.showToast({title:`created emote ${n}`,duration:3e3}),o.onClose()}},"Create Emote!"))))))};var $=(e,t)=>S(o=>a.createElement(P,{guildId:e,emoteUrl:t,e:o}));const f=e=>e?.substring(1,e.length-1);var p=({isEmote:e,emoteAlt:t,url:o})=>a.createElement(a.Fragment,null,a.createElement(i.MenuItem,{id:"ysink_emoji_msgitem",label:e?`Clone Emote ${t}`:"Create Emote"},G().map(n=>a.createElement(i.MenuItem,{label:n.name,id:`ysink_emoji_server_${n.id}`,action:()=>{if(e){const r=f(t);E(n.id,o,r),m.showToast({title:`cloned emote ${r}`,duration:3e3})}else $(n.id,o)}}))),a.createElement(i.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{d.copyText(o),m.showToast({title:`Copied url for ${f(t)}`,duration:3e3})}})),L=()=>l.findAndPatch(()=>c.findByDisplayName("MessageContextMenu",!1),e=>l.after("default",e,([{target:t}],o)=>{const n=d.findInReactTree(o,Y=>Array.isArray(Y?.children)),r=t?.classList?.contains("emoji");if(!r&&t?.nodeName!=="IMG"&&(t=t?.nextSibling?.firstChild),!(!t||!n||!r&&t?.nodeName!="IMG"||r&&t.alt.length<=2))return n.children.splice(3,0,a.createElement(i.MenuSeparator,null),p({isEmote:r,emoteAlt:t.alt,url:t.currentSrc})),o})),U=()=>l.findAndPatch(()=>c.findByDisplayName("ExpressionPickerContextMenu",!1),e=>l.after("default",e,([{target:t}],o)=>{if(!t.firstChild.currentSrc)return;const n=o.props.children.props;return Array.isArray(n.children)||(n.children=[n.children]),n.children.push(p({isEmote:!0,emoteAlt:`:${t.dataset.name}:`,url:t.firstChild.currentSrc})),o}));const H=[g(),L(),U()],D=()=>_.forEachRight(H,e=>e());return s.onUnload=D,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
