(function(s,a,u,i){"use strict";var c=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const p=s.findByProps("uploadEmoji");s.findByProps("getGuildPermissions");const f=s.findByProps("getFlattenedGuilds").getFlattenedGuilds,h=n=>new Promise((t,o)=>{let e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(n)}),y=async n=>await h(await(await fetch(n)).blob()),M=(n,t,o)=>{y(t).then(e=>p.uploadEmoji(n,e,o))},l=s.findByProps("MenuGroup","default");var d=({isEmote:n,emoteAlt:t,url:o})=>i.React.createElement(l.MenuItem,{id:"ysink_emoji_msgitem",label:n?`Clone Emote ${t}`:"Create Emote"},f().map(e=>i.React.createElement(l.MenuItem,{label:e.name,id:`ysink_emoji_server_${e.id}`,action:()=>{let r=t?.substring(1,t.length-1);n?(M(e.id,o,r),u.showToast({title:`cloned emote ${r}`,duration:3e3})):showCreateModal(e.id,o)}})));const _=s.findByProps("MenuGroup","default");var g=()=>{const n=s.find(t=>t?.default?.displayName=="MessageContextMenu");return a.after("default",n,(t,o)=>{let e=t[0].target,r=!!e?.classList?.contains("emoji");if(!(!e||!o?.props?.children||!r&&e?.nodeName!="IMG"||e.alt.length<=2))return o.props.children.splice(3,0,i.React.createElement(_.MenuSeparator,null),d({isEmote:r,emoteAlt:e.alt,url:e.sourceUrl})),o})};const j=s.findByProps("MenuGroup","default"),m=s.findByProps("openContextMenu");var x=()=>{const n=s.find(t=>t?.default?.displayName=="EmojiPickerListRow");return a.after("default",n,(t,o)=>{if(console.log(o),!Array.isArray(o?.props?.children))return o;for(const e of o.props.children){if(!e||!e?.props?.children)continue;let r=e.props.children.props.emoji;e.props.onContextMenu=E=>{let P=r.managed?`https://discord.com${r.url}`:r.url;m.openContextMenu(E,()=>i.React.createElement(j.default,{onClose:m.closeContextMenu},d({isEmote:!0,emoteAlt:`:${r.name}:`,url:P})))}}})},C=n=>{let t=[];return{onLoad:()=>t.push(c(),g(),x()),onUnload:()=>t.forEach(o=>o())}};return C})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.modules.common);
