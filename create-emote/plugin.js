(function(s,l,E,m,c,u,p){"use strict";function C(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if(a!=="default"){var n=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,n.get?n:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var r=C(E),b=()=>l.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row:last-child>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row:last-child>:last-child{flex:unset;margin-right:unset}");const[w,{getGuildPermissions:k},{getGuilds:M},{openModal:S},i,{ModalRoot:j,ModalHeader:x,ModalContent:v,ModalCloseButton:I},d,y,N,T,A,B]=m.batchFind(({findByProps:e,findByDisplayName:t})=>{e("uploadEmoji"),e("getGuildPermissions"),e("getGuilds"),e("openModalLazy"),e("MenuGroup","default"),e("ModalCloseButton"),t("Flex"),e("Sizes","Tags"),t("FormSection"),t("FormText"),t("TextInput"),e("BorderColors")}),P=BigInt(1073741824),$=e=>{let t=k({id:e});return!!(t&&(t&P)!==0n)},F=()=>Object.values(M()).filter(e=>$(e.id)),O=e=>new Promise((t,a)=>{let n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}),R=async e=>await O(await(await fetch(e)).blob()),f=(e,t,a)=>{R(t).then(n=>w.uploadEmoji(e,n,a))},z=({guildId:e,emoteUrl:t,e:a})=>{const[n,o]=r.useState("");return r.createElement(p.ErrorBoundary,null,r.createElement(j,{transitionState:a.transitionState,size:"small",className:"ysink_emote_modal"},r.createElement(x,{separator:!1},r.createElement(d.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},r.createElement(y,{tag:"h2",size:y.Sizes.SIZE_20},"Create Emote")),r.createElement(d.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},r.createElement(I,{onClick:a.onClose}))),r.createElement(v,null,r.createElement(N,null,r.createElement("div",{className:"ysink_emote_row"},r.createElement(T,null,"You are now creating an emote for the following image:"),r.createElement("img",{src:t,height:"70"})),r.createElement(d,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},r.createElement(A,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:n,onChange:o}),r.createElement(B,{className:"ysink_emote_button",onClick:()=>{f(e,t,n),c.showToast({title:`created emote ${n}`,duration:3e3}),a.onClose()}},"Create Emote!"))))))};var G=(e,t)=>S(a=>r.createElement(z,{guildId:e,emoteUrl:t,e:a}));const g=e=>e?.substring(1,e.length-1);var h=({isEmote:e,emoteAlt:t,url:a})=>r.createElement(r.Fragment,null,r.createElement(i.MenuItem,{id:"ysink_emoji_msgitem",label:e?`Clone Emote ${t}`:"Create Emote"},F().map(n=>r.createElement(i.MenuItem,{label:n.name,id:`ysink_emoji_server_${n.id}`,action:()=>{if(e){const o=g(t);f(n.id,a,o),c.showToast({title:`cloned emote ${o}`,duration:3e3})}else G(n.id,a)}}))),r.createElement(i.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{u.copyText(a),c.showToast({title:`Copied url for ${g(t)}`,duration:3e3})}})),U=()=>l.findAndPatch(()=>m.findByDisplayName("MessageContextMenu",!1),e=>l.after("default",e,([{target:t}],a)=>{const n=u.findInReactTree(a,Y=>Array.isArray(Y?.children)),o=t?.classList?.contains("emoji");if(!o&&t?.nodeName!=="IMG"&&(t=t?.nextSibling?.firstChild),!(!t||!n||!o&&t?.nodeName!="IMG"||o&&t.alt.length<=2))return n.children.splice(3,0,r.createElement(i.MenuSeparator,null),h({isEmote:o,emoteAlt:t.alt,url:t.currentSrc})),a})),D=()=>l.findAndPatch(()=>m.findByDisplayName("ExpressionPickerContextMenu",!1),e=>l.after("default",e,([{target:t}],a)=>{if(!t.firstChild.currentSrc)return;const n=a.props.children.props;return Array.isArray(n.children)||(n.children=[n.children]),n.children.push(h({isEmote:!0,emoteAlt:`:${t.dataset.name}:`,url:t.firstChild.currentSrc})),a}));const L=[b(),U(),D()],H=()=>_.forEachRight(L,e=>e());return s.onUnload=H,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
