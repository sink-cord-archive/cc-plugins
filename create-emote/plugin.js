(function(o,c,u,C,M,r){"use strict";var R=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const x=o.findByProps("uploadEmoji"),{getGuildPermissions:P}=o.findByProps("getGuildPermissions"),{getGuilds:B}=o.findByProps("getGuilds"),S=BigInt(1073741824),z=t=>{let e=P({id:t});return!!(e&&(e&S)!==0n)},N=()=>Object.values(B()).filter(t=>z(t.id)),I=t=>new Promise((e,n)=>{let a=new FileReader;a.onloadend=()=>e(a.result),a.readAsDataURL(t)}),j=async t=>await I(await(await fetch(t)).blob()),y=(t,e,n)=>{j(e).then(a=>x.uploadEmoji(t,a,n))},{openModal:w}=o.findByProps("openModalLazy"),l=o.findByProps("ModalCloseButton"),d=o.findByDisplayName("Flex"),h=o.findByProps("Sizes","Tags"),T=o.findByDisplayName("FormSection"),v=o.findByDisplayName("FormText"),k=o.findByDisplayName("TextInput"),F=o.findByProps("Sizes","Colors","Looks","DropdownSizes"),L=({guildId:t,emoteUrl:e,e:n})=>{const[a,s]=r.React.useState("");return r.React.createElement(M.ErrorBoundary,null,r.React.createElement(l.ModalRoot,{transitionState:n.transitionState,size:"small",className:"ysink_emote_modal"},r.React.createElement(l.ModalHeader,{separator:!1},r.React.createElement(d.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},r.React.createElement(h,{tag:"h2",size:h.Sizes.SIZE_20},"Create Emote")),r.React.createElement(d.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},r.React.createElement(l.ModalCloseButton,{onClick:n.onClose}))),r.React.createElement(l.ModalContent,null,r.React.createElement(T,null,r.React.createElement("div",{className:"ysink_emote_row"},r.React.createElement(v,null,"You are now creating an emote for the following image:"),r.React.createElement("img",{src:e,height:"70"})),r.React.createElement(d,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},r.React.createElement(k,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:a,onChange:p=>s(p)}),r.React.createElement(F,{className:"ysink_emote_button",onClick:()=>{y(t,e,a),u.showToast({title:`created emote ${a}`,duration:3e3}),n.onClose()}},"Create Emote!"))))))};var D=(t,e)=>w(n=>r.React.createElement(L,{guildId:t,emoteUrl:e,e:n}));const m=o.findByProps("MenuGroup","default");var f=({isEmote:t,emoteAlt:e,url:n})=>r.React.createElement(r.React.Fragment,null,r.React.createElement(m.MenuItem,{id:"ysink_emoji_msgitem",label:t?`Clone Emote ${e}`:"Create Emote"},N().map(a=>r.React.createElement(m.MenuItem,{label:a.name,id:`ysink_emoji_server_${a.id}`,action:()=>{let s=e?.substring(1,e.length-1);t?(y(a.id,n,s),u.showToast({title:`cloned emote ${s}`,duration:3e3})):D(a.id,n)}}))),r.React.createElement(m.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{let a=e?.substring(1,e.length-1);C.copyText(n),u.showToast({title:`Copied url for ${a}`,duration:3e3})}}));const G=o.findByProps("openContextMenuLazy"),E=[],$=t=>E.push(t),A=()=>_.forEachRight(E,t=>t());function O(t,e){const n=o.findByDisplayName(t,!1);if(n){e(n);return}let a=c.before("openContextMenuLazy",G,s=>{const p=s[1];return s[1]=async()=>{const Z=await p(s[0]);return q=>{const g=Z(q);return g?.type?.displayName===t&&e&&(a(),e(o.findByDisplayName(t,!1)),e=!1),g}},s})}var i={registerPatch:$,unpatchAll:A,lazyPatchContextMenu:O};const U=o.findByProps("MenuGroup","default");var b=()=>(i.lazyPatchContextMenu("MessageContextMenu",t=>{i.registerPatch(c.after("default",t,(e,n)=>{let a=e[0].target,s=!!a?.classList?.contains("emoji");if(!(!a||!n?.props?.children||!s&&a?.nodeName!="IMG"||s&&a.alt.length<=2))return n.props.children.splice(3,0,r.React.createElement(U.MenuSeparator,null),f({isEmote:s,emoteAlt:a.alt,url:a.currentSrc})),n}))}),i.unpatchAll),H=()=>(i.lazyPatchContextMenu("ExpressionPickerContextMenu",t=>{i.registerPatch(c.after("default",t,([{target:e}],n)=>(e.firstChild.currentSrc&&(Array.isArray(n.props.children.props.children)||(n.props.children.props.children=[n.props.children.props.children]),n.props.children.props.children.push(f({isEmote:!0,emoteAlt:`:${e.dataset.name}:`,url:e.firstChild.currentSrc}))),n)))}),i.unpatchAll),Y=t=>{let e=[R(),b(),H()];return{onUnload:()=>_.forEachRight(e,n=>n())}};return Y})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components,cumcord.modules.common);
