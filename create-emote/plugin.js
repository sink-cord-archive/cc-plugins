(function(s,c,u,g,n){"use strict";var h=()=>cumcord.patcher.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row>:last-child{flex:unset;margin-right:unset}");const M=s.findByProps("uploadEmoji"),{getGuildPermissions:_}=s.findByProps("getGuildPermissions"),C=s.findByProps("getFlattenedGuilds").getFlattenedGuilds,R=BigInt(1073741824),x=o=>{let t=_({id:o});return!!(t&&(t&R)!=0)},B=()=>C().filter(o=>x(o.id)),j=o=>new Promise((t,a)=>{let e=new FileReader;e.onloadend=()=>t(e.result),e.readAsDataURL(o)}),N=async o=>await j(await(await fetch(o)).blob()),m=(o,t,a)=>{N(t).then(e=>M.uploadEmoji(o,e,a))},P=n.React.useState,{openModal:S}=s.findByProps("openModalLazy"),i=s.findByProps("ModalCloseButton"),l=s.findByDisplayName("Flex"),p=s.findByDisplayName("Header"),I=s.findByDisplayName("FormSection"),w=s.findByDisplayName("FormText"),F=s.findByDisplayName("TextInput"),G=s.findByProps("Sizes","Colors","Looks","DropdownSizes"),T=({guildId:o,emoteUrl:t,e:a})=>{const[e,r]=P("");return n.React.createElement(g.ErrorBoundary,null,n.React.createElement(i.ModalRoot,{transitionState:a.transitionState,size:"small",className:"ysink_emote_modal"},n.React.createElement(i.ModalHeader,{separator:!1},n.React.createElement(l.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},n.React.createElement(p,{tag:"h2",size:p.Sizes.SIZE_20},"Create Emote")),n.React.createElement(l.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},n.React.createElement(i.ModalCloseButton,{onClick:a.onClose}))),n.React.createElement(i.ModalContent,null,n.React.createElement(I,null,n.React.createElement("div",{className:"ysink_emote_row"},n.React.createElement(w,null,"You are now creating an emote for the following image:"),n.React.createElement("img",{src:t,height:"70"})),n.React.createElement(l,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},n.React.createElement(F,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:e,onChange:d=>r(d)}),n.React.createElement(G,{className:"ysink_emote_button",onClick:()=>{m(o,t,e),u.showToast({title:`created emote ${e}`,duration:3e3}),a.onClose()}},"Create Emote!"))))))};var k=(o,t)=>S(a=>n.React.createElement(T,{guildId:o,emoteUrl:t,e:a}));const f=s.findByProps("MenuGroup","default");var y=({isEmote:o,emoteAlt:t,url:a})=>n.React.createElement(f.MenuItem,{id:"ysink_emoji_msgitem",label:o?`Clone Emote ${t}`:"Create Emote"},B().map(e=>n.React.createElement(f.MenuItem,{label:e.name,id:`ysink_emoji_server_${e.id}`,action:()=>{let r=t?.substring(1,t.length-1);o?(m(e.id,a,r),u.showToast({title:`cloned emote ${r}`,duration:3e3})):k(e.id,a)}})));const v=s.findByProps("MenuGroup","default");var $=()=>{const o=s.find(t=>t?.default?.displayName=="MessageContextMenu");return c.after("default",o,(t,a)=>{let e=t[0].target,r=!!e?.classList?.contains("emoji");if(!(!e||!a?.props?.children||!r&&e?.nodeName!="IMG"||e.alt.length<=2))return a.props.children.splice(3,0,n.React.createElement(v.MenuSeparator,null),y({isEmote:r,emoteAlt:e.alt,url:e.currentSrc})),a})};const z=s.findByProps("MenuGroup","default"),E=s.findByProps("openContextMenu");var D=()=>{const o=s.find(t=>t?.default?.displayName=="EmojiPickerListRow");return c.after("default",o,(t,a)=>{if(!Array.isArray(a?.props?.children))return a;for(const e of a.props.children){if(!e||!e?.props?.children)continue;let r=e.props.children.props.emoji;e.props.onContextMenu=d=>{let A=r.managed?`https://discord.com${r.url}`:r.url;E.openContextMenu(d,()=>n.React.createElement(z.default,{onClose:E.closeContextMenu},y({isEmote:!0,emoteAlt:`:${r.name}:`,url:A})))}}})},L=o=>{let t=[];return{onLoad:()=>t.push(h(),$(),D()),onUnload:()=>t.forEach(a=>a())}};return L})(cumcord.modules.webpack,cumcord.patcher,cumcord.ui.toasts,cumcord.ui.components,cumcord.modules.common);
