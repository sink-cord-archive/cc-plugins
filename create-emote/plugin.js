(function(s,i,p,m,c,u,E){"use strict";function C(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}var o=C(p),b=()=>i.injectCSS(".ysink_emote_modal .ysink_emote_row{display:flex;margin-bottom:1rem}.ysink_emote_modal .ysink_emote_row:last-child{margin-bottom:unset}.ysink_emote_modal .ysink_emote_row:last-child>*{flex:1;margin-right:1rem}.ysink_emote_modal .ysink_emote_row:last-child>:last-child{flex:unset;margin-right:unset}");const[k,{getGuildPermissions:w},{getGuilds:M},{openModal:S},l,{ModalRoot:j,ModalHeader:x,ModalContent:v,ModalCloseButton:I},d,y,N,T,A,P]=m.batchFind(({findByProps:e,findByDisplayName:t})=>{e("uploadEmoji"),e("getGuildPermissions"),e("getGuilds"),e("openModalLazy"),e("MenuGroup","default"),e("ModalCloseButton"),t("Flex"),e("Sizes","Tags"),t("FormSection"),t("FormText"),t("TextInput"),e("BorderColors")}),$=1073741824n,B=e=>{const t=w({id:e});return t&&(t&$)!==0n},F=()=>Object.values(M()).filter(e=>B(e.id)),O=e=>new Promise(async t=>{const r=await(await fetch(e)).blob(),n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(r)}),f=(e,t,r)=>O(t.replace("media.discordapp.net","cdn.discordapp.com")).then(n=>k.uploadEmoji({guildId:e,image:n,name:r})),R=({guildId:e,emoteUrl:t,e:r})=>{const[n,a]=o.useState("");return o.createElement(E.ErrorBoundary,null,o.createElement(j,{transitionState:r.transitionState,size:"small",className:"ysink_emote_modal"},o.createElement(x,{separator:!1},o.createElement(d.Child,{basis:"auto",grow:1,shrink:1,wrap:!1},o.createElement(y,{tag:"h2",size:y.Sizes.SIZE_20},"Create Emote")),o.createElement(d.Child,{basis:"auto",grow:0,shrink:1,wrap:!1},o.createElement(I,{onClick:r.onClose}))),o.createElement(v,null,o.createElement(N,null,o.createElement("div",{className:"ysink_emote_row"},o.createElement(T,null,"You are now creating an emote for the following image:"),o.createElement("img",{src:t,height:"70"})),o.createElement(d,{basis:"auto",grow:1,shrink:1,className:"ysink_emote_row",style:{"margin-bottom":"1rem"}},o.createElement(A,{className:"ysink_emote_input",placeholder:"myamazingemote",type:"text",value:n,onChange:a}),o.createElement(P,{className:"ysink_emote_button",onClick:()=>{f(e,t,n),c.showToast({title:`created emote ${n}`,duration:3e3}),r.onClose()}},"Create Emote!"))))))};var z=(e,t)=>S(r=>o.createElement(R,{guildId:e,emoteUrl:t,e:r}));const g=e=>e?.substring(1,e.length-1);var h=({isEmote:e,emoteAlt:t,url:r})=>o.createElement(o.Fragment,null,o.createElement(l.MenuItem,{id:"ysink_emoji_msgitem",label:e?`Clone Emote ${t}`:"Create Emote"},F().map(n=>o.createElement(l.MenuItem,{label:n.name,id:`ysink_emoji_server_${n.id}`,action:()=>{if(e){const a=g(t);f(n.id,r,a),c.showToast({title:`cloned emote ${a}`,duration:3e3})}else z(n.id,r)}}))),o.createElement(l.MenuItem,{label:"Copy URL",id:"ysink_emoji_copyitem",action:()=>{u.copyText(r),c.showToast({title:`Copied url for ${g(t)}`,duration:3e3})}})),G=()=>i.findAndPatch(()=>m.findByDisplayName("MessageContextMenu",!1),e=>i.after("default",e,([{target:t}],r)=>{const n=u.findInReactTree(r,H=>Array.isArray(H?.children)),a=t?.classList?.contains("emoji");if(!a&&t?.nodeName!=="IMG"&&(t=t?.nextSibling?.firstChild),!(!t||!n||!a&&t?.nodeName!="IMG"||a&&t.alt.length<=2))return n.children.splice(3,0,o.createElement(l.MenuSeparator,null),h({isEmote:a,emoteAlt:t.alt,url:t.currentSrc})),r})),U=()=>i.findAndPatch(()=>m.findByDisplayName("ExpressionPickerContextMenu",!1),e=>i.after("default",e,([{target:t}],r)=>{if(!t.firstChild.currentSrc)return;const n=r.props.children.props;return Array.isArray(n.children)||(n.children=[n.children]),n.children.push(h({isEmote:!0,emoteAlt:`:${t.dataset.name}:`,url:t.firstChild.currentSrc})),r}));const D=[b(),G(),U()],L=()=>_.forEachRight(D,e=>e());return s.onUnload=L,Object.defineProperty(s,"__esModule",{value:!0}),s})({},cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.ui.toasts,cumcord.utils,cumcord.ui.components);
