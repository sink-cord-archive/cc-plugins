(function(a,t,d,k,m,h,x){"use strict";function U(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(s){if(s!=="default"){var n=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,n.get?n:{enumerable:!0,get:function(){return e[s]}})}}),r.default=e,Object.freeze(r)}var o=U(k),S=()=>d.injectCSS(".ysink_reacted_grid{display:grid;gap:1rem;grid-template-columns:auto 1fr;align-items:center}.ysink_reacted_grid>div{font-weight:bold}.ysink_reacted_reactors{margin-left:6px}.ysink_reacted_reactors .more_reactors{background-color:var(--background-tertiary);color:var(--text-normal);font-weight:500}");const b=h.findByProps("reaction").reaction,v=e=>m.findInTree(m.getReactInstance(e),r=>r?.type?.displayName==="Reaction",{walkable:["return"]}),u=()=>{for(const e of document.getElementsByClassName(b))v(e).stateNode.forceUpdate()},[{Reaction:E},l,w,R,p,j,i]=h.batchFind(({findByProps:e,findByDisplayName:r})=>{e("Reaction"),e("getReactions","_dispatcher"),r("VoiceUserSummaryItem"),r("TextInput"),r("Slider"),r("Switch"),r("FormText")}),C=({count:e,max:r,users:s})=>o.createElement(w,{className:"ysink_reacted_reactors",max:r,users:s,renderMoreUsers:(n,c)=>o.createElement("div",{className:`${c} more_reactors`},"+",1+e-r)});var N=x.connectStores([l],({message:e,emoji:r})=>({users:Object.values(l.getReactions(e.getChannelId(),e.id,r)??{})}))(C);const M=({reactions:e})=>{const r=t.persist.ghost.reactionThreshold,s=t.persist.ghost.userThreshold;return!(r!==0&&e.length>r||s!==0&&(t.persist.ghost.useHighestUserCount?Math.max(...e.map(n=>n.count)):e.reduce((n,c)=>n+c.count,0))>s)};var O=()=>{const e=d.after("render",E.prototype,function(r,s){const{message:n,emoji:c,count:B}=this.props;if(M(n)){const F=s.props.children;s.props.children=H=>{const f=F(H),y=f.props.children.props.children,$=y.props.children;return y.props.children=q=>{const T=$(q);return T.props.children.push(o.createElement(N,{message:n,emoji:c,count:B,max:t.persist.ghost.maxUsersShown??6})),T},f}}return s});return u(),()=>{e(),u()}};const g=e=>e===0?"Off":e%1e3==0?`${e/1e3}k`:e;var V=()=>(m.useNest(t.persist),o.createElement("div",{className:"ysink_reacted_grid"},o.createElement(i,null,"Max Users Shown"),o.createElement(R,{note:"The maximum number of users shown per reaction between 0 and 99.",value:t.persist.ghost.maxUsersShown,type:"text",onChange:e=>{!isNaN(e)&&e>=0&&e<=99&&(t.persist.store.maxUsersShown=e)}}),o.createElement(i,null,"Reaction Threshold"),o.createElement(p,{maxValue:20,markers:_.range(21),stickToMarkers:!0,initialValue:t.persist.ghost.reactionThreshold,onValueChange:e=>{t.persist.store.reactionThreshold=e},onMarkerRender:g}),o.createElement(i,null,"User Threshold"),o.createElement(p,{maxValue:1e4,markers:[0,10,20,50,100,500,1e3,2e3,3e3,4e3,5e3,1e4],stickToMarkers:!0,initialValue:t.persist.ghost.userThreshold,onValueChange:e=>{t.persist.store.userThreshold=e},onMarkerRender:g,equidistant:!0}),o.createElement(i,null,"Use highest user count"),o.createElement(j,{checked:t.persist.ghost.useHighestUserCount,onChange:e=>{t.persist.store.useHighestUserCount=e}})));t.persist.ghost.maxUsersShown??=6,t.persist.ghost.reactionThreshold??=10,t.persist.ghost.userThreshold??=100,t.persist.ghost.useHighestUserCount??=!0;const I=[S(),O()],P=()=>_.forEachRight(I,e=>e?.());return a.onUnload=P,a.settings=V,Object.defineProperty(a,"__esModule",{value:!0}),a})({},cumcord.pluginData,cumcord.patcher,cumcord.modules.common.React,cumcord.utils,cumcord.modules.webpack,cumcord.modules.common.Flux);
