(function(u,m,a,t,i,T){"use strict";function U(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function k(e){if(e&&e.__esModule)return e;var r=Object.create(null);return e&&Object.keys(e).forEach(function(o){if(o!=="default"){var s=Object.getOwnPropertyDescriptor(e,o);Object.defineProperty(r,o,s.get?s:{enumerable:!0,get:function(){return e[o]}})}}),r.default=e,Object.freeze(r)}var n=k(m),j=U(m),w=()=>u.injectCSS(".ysink_reacted_grid{display:grid;gap:1rem;grid-template-columns:auto 1fr;align-items:center}.ysink_reacted_grid>div{font-weight:bold}.ysink_reacted_reactors{margin-left:6px}.ysink_reacted_reactors .more_reactors{background-color:var(--background-tertiary);color:var(--text-normal);font-weight:500}");const C=a.findByDisplayName("TextInput"),h=a.findByDisplayName("Slider"),R=a.findByDisplayName("Switch"),l=a.findByDisplayName("FormText"),p=e=>e===0?"Off":e%1e3==0?`${e/1e3}k`:e;var S=()=>(i.useNest(t.persist),n.createElement("div",{className:"ysink_reacted_grid"},n.createElement(l,null,"Max Users Shown"),n.createElement(C,{note:"The maximum number of users shown per reaction between 0 and 99.",value:t.persist.ghost.maxUsersShown??6,type:"text",onChange:e=>{!isNaN(e)&&e>=0&&e<=99&&(t.persist.store.maxUsersShown=e)}}),n.createElement(l,null,"Reaction Threshold"),n.createElement(h,{maxValue:20,markers:_.range(21),stickToMarkers:!0,initialValue:t.persist.ghost.reactionThreshold??10,onValueChange:e=>{t.persist.store.reactionThreshold=e},onMarkerRender:p}),n.createElement(l,null,"User Threshold"),n.createElement(h,{maxValue:1e4,markers:[0,10,20,50,100,500,1e3,2e3,3e3,4e3,5e3,1e4],stickToMarkers:!0,initialValue:t.persist.ghost.userThreshold??100,onValueChange:e=>{t.persist.store.userThreshold=e},onMarkerRender:p,equidistant:!0}),n.createElement(l,null,"Use highest user count"),n.createElement(R,{checked:t.persist.ghost.useHighestUserCount??!0,onChange:e=>{t.persist.store.useHighestUserCount=e}})));const f=a.findByProps("reaction").reaction,b=async e=>{let r;for(;!(r=document.getElementsByClassName(e)[0]);)await i.sleep(50);return r},y=e=>i.findInTree(i.getReactInstance(e),r=>r?.type?.displayName==="Reaction",{walkable:["return"]}),B=async()=>y(await b(f)).type,g=()=>{const e=document.getElementsByClassName(f);for(const r of e)y(r).stateNode.forceUpdate()},x=a.findByProps("getReactions","_dispatcher"),M=a.findByDisplayName("VoiceUserSummaryItem"),O=({count:e,max:r,users:o})=>{function s(c,d){return n.createElement("div",{className:`${d} more_reactors`},"+",1+e-r)}return n.createElement(M,{className:"ysink_reacted_reactors",max:r,users:o,renderMoreUsers:s})};var $=T.connectStores([x],({message:e,emoji:r})=>({users:Object.values(x.getReactions(e.getChannelId(),e.id,r)??{})}))(O);const V=({reactions:e})=>{const r=t.persist.ghost.reactionThreshold??10;if(r!==0&&e.length>r)return!1;const o=t.persist.ghost.userThreshold??100;return!(o!==0&&(t.persist.ghost.useHighestUserCount??!0?Math.max(...e.map(s=>s.count)):e.reduce((s,c)=>s+c.count,0))>o)};var I=async()=>{const e=await B(),r=u.after("render",e.prototype,function(o,s){const{message:c,emoji:d,count:H}=this.props;if(V(c)){const F=s.props.children;s.props.children=L=>{const v=F(L),E=v.props.children.props.children,q=E.props.children;return E.props.children=z=>{const N=q(z);return N.props.children.props.children.push(j.default.createElement($,{message:c,emoji:d,count:H,max:t.persist.ghost.maxUsersShown??6})),N},v}}return s});return g(),()=>{r(),g()}},P=()=>{let e=[];return{onLoad:async()=>{e=[w(),await I()]},onUnload:()=>_.forEachRight(e,r=>r?.()),settings:S}};return P})(cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.pluginData,cumcord.utils,cumcord.modules.common.Flux);
