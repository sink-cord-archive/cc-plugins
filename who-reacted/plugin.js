(function(u,m,c,r,l,N){"use strict";function S(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}function C(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var s=C(m),U=S(m),w=()=>u.injectCSS(".ysink_reacted_grid{display:grid;gap:1rem;grid-template-columns:auto 1fr;align-items:center}.ysink_reacted_grid>div{font-weight:bold}.ysink_reacted_reactors{margin-left:6px}.ysink_reacted_reactors .more_reactors{background-color:var(--background-tertiary);color:var(--text-normal);font-weight:500}");const k=c.findByDisplayName("TextInput"),h=c.findByDisplayName("Slider"),b=c.findByDisplayName("Switch"),d=c.findByDisplayName("FormText"),p=e=>e===0?"Off":e%1e3==0?`${e/1e3}k`:e;var j=()=>(l.useNest(r.persist),s.createElement("div",{className:"ysink_reacted_grid"},s.createElement(d,null,"Max Users Shown"),s.createElement(k,{note:"The maximum number of users shown per reaction between 0 and 99.",value:r.persist.ghost.maxUsersShown??6,type:"text",onChange:e=>{!isNaN(e)&&e>=0&&e<=99&&(r.persist.store.maxUsersShown=e)}}),s.createElement(d,null,"Reaction Threshold"),s.createElement(h,{maxValue:20,markers:_.range(21),stickToMarkers:!0,initialValue:r.persist.ghost.reactionThreshold??10,onValueChange:e=>{r.persist.store.reactionThreshold=e},onMarkerRender:p}),s.createElement(d,null,"User Threshold"),s.createElement(h,{maxValue:1e4,markers:[0,10,20,50,100,500,1e3,2e3,3e3,4e3,5e3,1e4],stickToMarkers:!0,initialValue:r.persist.ghost.userThreshold??100,onValueChange:e=>{r.persist.store.userThreshold=e},onMarkerRender:p,equidistant:!0}),s.createElement(d,null,"Use highest user count"),s.createElement(b,{checked:r.persist.ghost.useHighestUserCount??!0,onChange:e=>{r.persist.store.useHighestUserCount=e}})));const f=c.findByProps("reaction").reaction,v=async e=>{let t;for(;!(t=document.getElementsByClassName(e)[0]);)await l.sleep(50);return t},y=e=>l.findInTree(l.getReactInstance(e),t=>t?.type?.displayName==="Reaction",{walkable:["return"]}),B=async()=>y(await v(f)).type,g=()=>{const e=document.getElementsByClassName(f);for(const t of e)y(t).stateNode.forceUpdate()},R=c.findByProps("getReactions","_dispatcher"),I=c.findByDisplayName("VoiceUserSummaryItem"),M=({count:e,max:t,users:n})=>{function o(a,i){return s.createElement("div",{className:`${i} more_reactors`},"+",1+e-t)}return s.createElement(I,{className:"ysink_reacted_reactors",max:t,users:n,renderMoreUsers:o})};var O=N.connectStores([R],({message:e,emoji:t})=>({users:Object.values(R.getReactions(e.getChannelId(),e.id,t)??{})}))(M);const V=({reactions:e})=>{const t=r.persist.ghost.reactionThreshold??10;if(t!==0&&e.length>t)return!1;const n=r.persist.ghost.userThreshold??100;return!(n!==0&&(r.persist.ghost.useHighestUserCount??!0?Math.max(...e.map(a=>a.count)):e.reduce((a,i)=>a+i.count,0))>n)};var F=async()=>{const e=await B(),t=u.after("render",e.prototype,function(n,o){const{message:a,emoji:i,count:H}=this.props;if(V(a)){const L=o.props.children;o.props.children=$=>{const T=L($),x=T.props.children.props.children,q=x.props.children;return x.props.children=z=>{const E=q(z);return E.props.children.props.children.push(U.default.createElement(O,{message:a,emoji:i,count:H,max:r.persist.ghost.maxUsersShown??6})),E},T}}return o});return g(),()=>{t(),g()}},P=()=>{let e=[];return{onLoad:async()=>{e=[w(),await F()]},onUnload:()=>_.forEachRight(e,t=>t?.()),settings:j}};return P})(cumcord.patcher,cumcord.modules.common.React,cumcord.modules.webpack,cumcord.pluginData,cumcord.utils,cumcord.modules.common.Flux);
